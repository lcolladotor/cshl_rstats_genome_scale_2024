<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 scRNA-seq data analysis overview | Statistical Analysis of Genome Scale Data 2024</title>
  <meta name="description" content="11 scRNA-seq data analysis overview | Statistical Analysis of Genome Scale Data 2024" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="11 scRNA-seq data analysis overview | Statistical Analysis of Genome Scale Data 2024" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="lcolladotor/cshl_rstats_genome_scale_2024" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 scRNA-seq data analysis overview | Statistical Analysis of Genome Scale Data 2024" />
  
  
  

<meta name="author" content="Leonardo Collado-Torres" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="icon_32.png" type="image/x-icon" />
<link rel="prev" href="biocthis-introduction.html"/>
<link rel="next" href="introduction-to-spatial-transcriptomics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-course-materials"><i class="fa fa-check"></i>Download course materials</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-of-conduct"><i class="fa fa-check"></i>Code of Conduct</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-schedule"><i class="fa fa-check"></i>Course Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#external-links"><i class="fa fa-check"></i>External links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-prerequisites"><i class="fa fa-check"></i>Course Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session-information"><i class="fa fa-check"></i>R session information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="summarizedexperiment-overview.html"><a href="summarizedexperiment-overview.html"><i class="fa fa-check"></i><b>1</b> SummarizedExperiment overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="summarizedexperiment-overview.html"><a href="summarizedexperiment-overview.html#overview-1"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="summarizedexperiment-overview.html"><a href="summarizedexperiment-overview.html#exercises"><i class="fa fa-check"></i><b>1.2</b> Exercises</a></li>
<li class="chapter" data-level="1.3" data-path="summarizedexperiment-overview.html"><a href="summarizedexperiment-overview.html#solutions"><i class="fa fa-check"></i><b>1.3</b> Solutions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html"><i class="fa fa-check"></i><b>2</b> Interactive SummarizedExperiment visualizations</a>
<ul>
<li class="chapter" data-level="2.1" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#classes-for-isee"><i class="fa fa-check"></i><b>2.1</b> Classes for iSEE</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#summarizedexperiment-class"><i class="fa fa-check"></i><b>2.1.1</b> SummarizedExperiment class</a></li>
<li class="chapter" data-level="2.1.2" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#singlecellexperiment"><i class="fa fa-check"></i><b>2.1.2</b> SingleCellExperiment</a></li>
<li class="chapter" data-level="2.1.3" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#spatialexperiment"><i class="fa fa-check"></i><b>2.1.3</b> SpatialExperiment</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#getting-started-with-isee"><i class="fa fa-check"></i><b>2.2</b> Getting Started with iSEE</a></li>
<li class="chapter" data-level="2.3" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#description-of-the-user-interface"><i class="fa fa-check"></i><b>2.3</b> Description of the user interface</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#header"><i class="fa fa-check"></i><b>2.3.1</b> Header</a></li>
<li class="chapter" data-level="2.3.2" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#panel-types"><i class="fa fa-check"></i><b>2.3.2</b> Panel types</a></li>
<li class="chapter" data-level="2.3.3" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#parameter-sets"><i class="fa fa-check"></i><b>2.3.3</b> Parameter sets</a></li>
<li class="chapter" data-level="2.3.4" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#reduced-dimension-plots"><i class="fa fa-check"></i><b>2.3.4</b> Reduced dimension plots</a></li>
<li class="chapter" data-level="2.3.5" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#column-data-plots"><i class="fa fa-check"></i><b>2.3.5</b> Column data plots</a></li>
<li class="chapter" data-level="2.3.6" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#feature-assay-plots"><i class="fa fa-check"></i><b>2.3.6</b> Feature assay plots</a></li>
<li class="chapter" data-level="2.3.7" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#row-data-plots"><i class="fa fa-check"></i><b>2.3.7</b> Row data plots</a></li>
<li class="chapter" data-level="2.3.8" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#sample-assay-plots"><i class="fa fa-check"></i><b>2.3.8</b> Sample assay plots</a></li>
<li class="chapter" data-level="2.3.9" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#row-data-tables"><i class="fa fa-check"></i><b>2.3.9</b> Row data tables</a></li>
<li class="chapter" data-level="2.3.10" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#column-data-tables"><i class="fa fa-check"></i><b>2.3.10</b> Column data tables</a></li>
<li class="chapter" data-level="2.3.11" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#heat-maps"><i class="fa fa-check"></i><b>2.3.11</b> Heat maps</a></li>
<li class="chapter" data-level="2.3.12" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#description-of-isee-functionality"><i class="fa fa-check"></i><b>2.3.12</b> Description of iSEE functionality</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#lets-practice"><i class="fa fa-check"></i><b>2.4</b> Let’s practice!</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#setting-up-the-data"><i class="fa fa-check"></i><b>2.4.1</b> Setting up the data</a></li>
<li class="chapter" data-level="2.4.2" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#explore-the-data"><i class="fa fa-check"></i><b>2.4.2</b> Explore the Data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#introduction-to-advanced-isee-features"><i class="fa fa-check"></i><b>2.5</b> Introduction to Advanced iSEE Features</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#selecting-cells-based-on-a-single-gene-expression"><i class="fa fa-check"></i><b>2.5.1</b> Selecting Cells Based on a Single Gene Expression</a></li>
<li class="chapter" data-level="2.5.2" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#using-a-single-plot-for-two-gene-co-expression"><i class="fa fa-check"></i><b>2.5.2</b> Using a Single Plot for Two Gene Co-Expression</a></li>
<li class="chapter" data-level="2.5.3" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#selecting-cells-based-on-the-co-expression-of-two-or-more-genes"><i class="fa fa-check"></i><b>2.5.3</b> Selecting Cells Based on the Co-Expression of Two or more Genes</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#references"><i class="fa fa-check"></i><b>2.6</b> References</a></li>
<li class="chapter" data-level="2.7" data-path="interactive-summarizedexperiment-visualizations.html"><a href="interactive-summarizedexperiment-visualizations.html#community"><i class="fa fa-check"></i><b>2.7</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="recount3-introduction.html"><a href="recount3-introduction.html"><i class="fa fa-check"></i><b>3</b> recount3 introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="recount3-introduction.html"><a href="recount3-introduction.html#recount-projects"><i class="fa fa-check"></i><b>3.1</b> recount projects</a></li>
<li class="chapter" data-level="3.2" data-path="recount3-introduction.html"><a href="recount3-introduction.html#using-recount3"><i class="fa fa-check"></i><b>3.2</b> Using recount3</a></li>
<li class="chapter" data-level="3.3" data-path="recount3-introduction.html"><a href="recount3-introduction.html#exercise"><i class="fa fa-check"></i><b>3.3</b> Exercise</a></li>
<li class="chapter" data-level="3.4" data-path="recount3-introduction.html"><a href="recount3-introduction.html#community-1"><i class="fa fa-check"></i><b>3.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html"><i class="fa fa-check"></i><b>4</b> Differential Gene Expression analysis overview</a>
<ul>
<li class="chapter" data-level="4.1" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html#preliminary-steps"><i class="fa fa-check"></i><b>4.1</b> Preliminary steps</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html#rna-seq-data-processing"><i class="fa fa-check"></i><b>4.1.1</b> RNA-seq data processing</a></li>
<li class="chapter" data-level="4.1.2" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>4.1.2</b> Exploratory Data Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html#differential-gene-expression"><i class="fa fa-check"></i><b>4.2</b> Differential Gene Expression</a></li>
<li class="chapter" data-level="4.3" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html#downstream-analyses"><i class="fa fa-check"></i><b>4.3</b> Downstream analyses</a></li>
<li class="chapter" data-level="" data-path="differential-gene-expression-analysis-overview.html"><a href="differential-gene-expression-analysis-overview.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html"><i class="fa fa-check"></i><b>5</b> Differential Gene Expression analysis with <em>limma</em>-<em>voom</em></a>
<ul>
<li class="chapter" data-level="5.1" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#nb-based-dge-methods"><i class="fa fa-check"></i><b>5.1</b> NB-based DGE methods?</a></li>
<li class="chapter" data-level="5.2" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#limma-voom-pipeline"><i class="fa fa-check"></i><b>5.2</b> <em>limma</em>-<em>voom</em> pipeline</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#model.matrix"><i class="fa fa-check"></i><b>5.2.1</b> <code>model.matrix()</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#voom"><i class="fa fa-check"></i><b>5.2.2</b> <code>voom()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#lmfit"><i class="fa fa-check"></i><b>5.2.3</b> <code>lmFit()</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#ebayes"><i class="fa fa-check"></i><b>5.2.4</b> <code>eBayes()</code></a></li>
<li class="chapter" data-level="5.2.5" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#toptable"><i class="fa fa-check"></i><b>5.2.5</b> <code>topTable()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#de-visualization"><i class="fa fa-check"></i><b>5.3</b> DE visualization</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#volcano-plots"><i class="fa fa-check"></i><b>5.3.1</b> Volcano plots</a></li>
<li class="chapter" data-level="5.3.2" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#heat-maps-1"><i class="fa fa-check"></i><b>5.3.2</b> Heat maps</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="differential-gene-expression-analysis-with-limma-voom.html"><a href="differential-gene-expression-analysis-with-limma-voom.html#references-2"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html"><i class="fa fa-check"></i><b>6</b> Interpreting model coefficients with ExploreModelMatrix</a>
<ul>
<li class="chapter" data-level="6.1" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#model-objects-in-r"><i class="fa fa-check"></i><b>6.1</b> Model objects in R</a></li>
<li class="chapter" data-level="6.2" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exploremodelmatrix"><i class="fa fa-check"></i><b>6.2</b> ExploreModelMatrix</a></li>
<li class="chapter" data-level="6.3" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-1"><i class="fa fa-check"></i><b>6.3</b> Example 1</a></li>
<li class="chapter" data-level="6.4" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-2"><i class="fa fa-check"></i><b>6.4</b> Example 2</a></li>
<li class="chapter" data-level="6.5" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#example-3"><i class="fa fa-check"></i><b>6.5</b> Example 3</a></li>
<li class="chapter" data-level="6.6" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#exercise-1"><i class="fa fa-check"></i><b>6.6</b> Exercise</a></li>
<li class="chapter" data-level="6.7" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#to-learn-more"><i class="fa fa-check"></i><b>6.7</b> To learn more</a></li>
<li class="chapter" data-level="6.8" data-path="interpreting-model-coefficients-with-exploremodelmatrix.html"><a href="interpreting-model-coefficients-with-exploremodelmatrix.html#community-2"><i class="fa fa-check"></i><b>6.8</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dge-model-building-with-variancepartition.html"><a href="dge-model-building-with-variancepartition.html"><i class="fa fa-check"></i><b>7</b> DGE model building with <em>variancePartition</em></a>
<ul>
<li class="chapter" data-level="7.1" data-path="dge-model-building-with-variancepartition.html"><a href="dge-model-building-with-variancepartition.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>7.1</b> Canonical Correlation Analysis</a></li>
<li class="chapter" data-level="7.2" data-path="dge-model-building-with-variancepartition.html"><a href="dge-model-building-with-variancepartition.html#fit-model-and-extract-fraction-of-variance-explained"><i class="fa fa-check"></i><b>7.2</b> Fit model and extract fraction of variance explained</a></li>
<li class="chapter" data-level="7.3" data-path="dge-model-building-with-variancepartition.html"><a href="dge-model-building-with-variancepartition.html#examine-the-expression-of-most-affected-genes-by-each-sample-variable"><i class="fa fa-check"></i><b>7.3</b> Examine the expression of most affected genes by each sample variable</a></li>
<li class="chapter" data-level="" data-path="dge-model-building-with-variancepartition.html"><a href="dge-model-building-with-variancepartition.html#references-3"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html"><i class="fa fa-check"></i><b>8</b> Differential gene expression exercise</a>
<ul>
<li class="chapter" data-level="8.1" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#recap"><i class="fa fa-check"></i><b>8.1</b> Recap</a></li>
<li class="chapter" data-level="8.2" data-path="differential-gene-expression-exercise.html"><a href="differential-gene-expression-exercise.html#exercise-2"><i class="fa fa-check"></i><b>8.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="research-talks.html"><a href="research-talks.html"><i class="fa fa-check"></i><b>9</b> Research talks</a>
<ul>
<li class="chapter" data-level="9.1" data-path="research-talks.html"><a href="research-talks.html#fentanyl-rat-study"><i class="fa fa-check"></i><b>9.1</b> Fentanyl rat study</a></li>
<li class="chapter" data-level="9.2" data-path="research-talks.html"><a href="research-talks.html#cg-hb-cell-projectors-study"><i class="fa fa-check"></i><b>9.2</b> Cg Hb cell projectors study</a></li>
<li class="chapter" data-level="9.3" data-path="research-talks.html"><a href="research-talks.html#deconvolution-benchmark"><i class="fa fa-check"></i><b>9.3</b> deconvolution-benchmark</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html"><i class="fa fa-check"></i><b>10</b> biocthis introduction</a>
<ul>
<li class="chapter" data-level="10.1" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#related-past-materials"><i class="fa fa-check"></i><b>10.1</b> Related past materials</a></li>
<li class="chapter" data-level="10.2" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#biocthis-main-commands"><i class="fa fa-check"></i><b>10.2</b> biocthis main commands</a></li>
<li class="chapter" data-level="10.3" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#live-demo"><i class="fa fa-check"></i><b>10.3</b> Live demo</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#example-function"><i class="fa fa-check"></i><b>10.3.1</b> Example function</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="biocthis-introduction.html"><a href="biocthis-introduction.html#community-3"><i class="fa fa-check"></i><b>10.4</b> Community</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html"><i class="fa fa-check"></i><b>11</b> scRNA-seq data analysis overview</a>
<ul>
<li class="chapter" data-level="11.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#single-cell-rna-sequencing"><i class="fa fa-check"></i><b>11.1</b> Single cell RNA sequencing</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#pre-processing-of-scrna-seq-data-before-r"><i class="fa fa-check"></i><b>11.1.1</b> Pre-processing of scRNA-seq Data (Before R)</a></li>
<li class="chapter" data-level="11.1.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#different-technologies"><i class="fa fa-check"></i><b>11.1.2</b> Different Technologies</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#basic-workflow"><i class="fa fa-check"></i><b>11.2</b> Basic Workflow</a></li>
<li class="chapter" data-level="11.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#the-singlecellexperiment-class"><i class="fa fa-check"></i><b>11.3</b> The SingleCellExperiment class</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#data-loading"><i class="fa fa-check"></i><b>11.3.1</b> Data Loading</a></li>
<li class="chapter" data-level="11.3.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#basics-of-your-sce"><i class="fa fa-check"></i><b>11.3.2</b> Basics of your SCE</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#quality-control"><i class="fa fa-check"></i><b>11.4</b> Quality Control</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#common-choices-of-qc-metrics"><i class="fa fa-check"></i><b>11.4.1</b> Common choices of QC metrics</a></li>
<li class="chapter" data-level="11.4.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#identifying-low-quality-cells"><i class="fa fa-check"></i><b>11.4.2</b> Identifying low-quality cells</a></li>
<li class="chapter" data-level="11.4.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#checking-diagnostic-plots"><i class="fa fa-check"></i><b>11.4.3</b> Checking diagnostic plots</a></li>
<li class="chapter" data-level="11.4.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#removing-low-quality-cells"><i class="fa fa-check"></i><b>11.4.4</b> Removing low-quality cells</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#normalization"><i class="fa fa-check"></i><b>11.5</b> Normalization</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#library-size-normalization"><i class="fa fa-check"></i><b>11.5.1</b> Library size normalization</a></li>
<li class="chapter" data-level="11.5.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#normalization-by-deconvolution"><i class="fa fa-check"></i><b>11.5.2</b> Normalization by deconvolution</a></li>
<li class="chapter" data-level="11.5.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#normalization-by-spike-ins"><i class="fa fa-check"></i><b>11.5.3</b> Normalization by spike-ins</a></li>
<li class="chapter" data-level="11.5.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#scaling-and-log-transforming"><i class="fa fa-check"></i><b>11.5.4</b> Scaling and log-transforming</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#feature-selection"><i class="fa fa-check"></i><b>11.6</b> Feature selection</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#quantifying-per-gene-variation"><i class="fa fa-check"></i><b>11.6.1</b> Quantifying per-gene variation</a></li>
<li class="chapter" data-level="11.6.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#quantifying-technical-noise-spike-ins"><i class="fa fa-check"></i><b>11.6.2</b> Quantifying technical noise (spike-ins)</a></li>
<li class="chapter" data-level="11.6.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#quantifying-technical-noise-mean-variance-trend"><i class="fa fa-check"></i><b>11.6.3</b> Quantifying technical noise (mean-variance trend)</a></li>
<li class="chapter" data-level="11.6.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#handling-batch-effects"><i class="fa fa-check"></i><b>11.6.4</b> Handling batch effects</a></li>
<li class="chapter" data-level="11.6.5" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#selecting-highly-variable-genes"><i class="fa fa-check"></i><b>11.6.5</b> Selecting highly variable genes</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#dimensionality-reduction"><i class="fa fa-check"></i><b>11.7</b> Dimensionality reduction</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#principal-components-analysis"><i class="fa fa-check"></i><b>11.7.1</b> Principal components analysis</a></li>
<li class="chapter" data-level="11.7.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#choosing-the-number-of-pcs"><i class="fa fa-check"></i><b>11.7.2</b> Choosing the number of PCs</a></li>
<li class="chapter" data-level="11.7.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#visualizing-the-pcs"><i class="fa fa-check"></i><b>11.7.3</b> Visualizing the PCs</a></li>
<li class="chapter" data-level="11.7.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#non-linear-methods-for-visualization"><i class="fa fa-check"></i><b>11.7.4</b> Non-linear methods for visualization</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#clustering"><i class="fa fa-check"></i><b>11.8</b> Clustering</a>
<ul>
<li class="chapter" data-level="11.8.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#graph-based-clustering"><i class="fa fa-check"></i><b>11.8.1</b> Graph-based clustering</a></li>
<li class="chapter" data-level="11.8.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#adjusting-the-parameters"><i class="fa fa-check"></i><b>11.8.2</b> Adjusting the parameters</a></li>
<li class="chapter" data-level="11.8.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#hierarchical-clustering"><i class="fa fa-check"></i><b>11.8.3</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="11.8.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#subclustering"><i class="fa fa-check"></i><b>11.8.4</b> Subclustering</a></li>
</ul></li>
<li class="chapter" data-level="11.9" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#marker-gene-detection"><i class="fa fa-check"></i><b>11.9</b> Marker gene detection</a>
<ul>
<li class="chapter" data-level="11.9.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#scoring-markers-by-pairwise-comparisons"><i class="fa fa-check"></i><b>11.9.1</b> Scoring markers by pairwise comparisons</a></li>
<li class="chapter" data-level="11.9.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#effect-sizes-for-pairwise-comparisons"><i class="fa fa-check"></i><b>11.9.2</b> Effect sizes for pairwise comparisons</a></li>
<li class="chapter" data-level="11.9.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#summaries-of-pairwise-effects"><i class="fa fa-check"></i><b>11.9.3</b> Summaries of pairwise effects</a></li>
<li class="chapter" data-level="11.9.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#choose-top-markers"><i class="fa fa-check"></i><b>11.9.4</b> Choose top markers</a></li>
<li class="chapter" data-level="11.9.5" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#using-a-log-fold-change-threshold"><i class="fa fa-check"></i><b>11.9.5</b> Using a log-fold change threshold</a></li>
<li class="chapter" data-level="11.9.6" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#handling-blocking-factors"><i class="fa fa-check"></i><b>11.9.6</b> Handling blocking factors</a></li>
<li class="chapter" data-level="11.9.7" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#deconvobuddies"><i class="fa fa-check"></i><b>11.9.7</b> Deconvobuddies</a></li>
</ul></li>
<li class="chapter" data-level="11.10" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#cell-type-annotation"><i class="fa fa-check"></i><b>11.10</b> Cell type annotation</a>
<ul>
<li class="chapter" data-level="11.10.1" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#assigning-cell-labels-from-reference-data"><i class="fa fa-check"></i><b>11.10.1</b> Assigning cell labels from reference data</a></li>
<li class="chapter" data-level="11.10.2" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#getting-ready-again"><i class="fa fa-check"></i><b>11.10.2</b> Getting ready again</a></li>
<li class="chapter" data-level="11.10.3" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#using-existing-references"><i class="fa fa-check"></i><b>11.10.3</b> Using existing references</a></li>
<li class="chapter" data-level="11.10.4" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#assigning-cell-labels-from-gene-sets"><i class="fa fa-check"></i><b>11.10.4</b> Assigning cell labels from gene sets</a></li>
</ul></li>
<li class="chapter" data-level="11.11" data-path="scrna-seq-data-analysis-overview.html"><a href="scrna-seq-data-analysis-overview.html#references-4"><i class="fa fa-check"></i><b>11.11</b> References</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="introduction-to-spatial-transcriptomics.html"><a href="introduction-to-spatial-transcriptomics.html"><i class="fa fa-check"></i><b>12</b> Introduction to spatial transcriptomics</a>
<ul>
<li class="chapter" data-level="12.1" data-path="introduction-to-spatial-transcriptomics.html"><a href="introduction-to-spatial-transcriptomics.html#visium-spatial-technology"><i class="fa fa-check"></i><b>12.1</b> 3’ Visium spatial technology</a></li>
<li class="chapter" data-level="12.2" data-path="introduction-to-spatial-transcriptomics.html"><a href="introduction-to-spatial-transcriptomics.html#spatial-data-visualization"><i class="fa fa-check"></i><b>12.2</b> Spatial data visualization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="introduction-to-spatial-transcriptomics.html"><a href="introduction-to-spatial-transcriptomics.html#spot-level-data-exploration"><i class="fa fa-check"></i><b>12.2.1</b> Spot-level data exploration</a></li>
<li class="chapter" data-level="12.2.2" data-path="introduction-to-spatial-transcriptomics.html"><a href="introduction-to-spatial-transcriptomics.html#layer-level-data-exploration"><i class="fa fa-check"></i><b>12.2.2</b> Layer-level data exploration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction-to-spatial-transcriptomics.html"><a href="introduction-to-spatial-transcriptomics.html#bibliography"><i class="fa fa-check"></i>Bibliography</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><i class="fa fa-check"></i><b>13</b> Re-use of bulk RNA-seq methods for spatial data exercise</a>
<ul>
<li class="chapter" data-level="13.1" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#spatial-registration"><i class="fa fa-check"></i><b>13.1</b> Spatial registration</a></li>
<li class="chapter" data-level="13.2" data-path="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html"><a href="re-use-of-bulk-rna-seq-methods-for-spatial-data-exercise.html#exercise-3"><i class="fa fa-check"></i><b>13.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html"><i class="fa fa-check"></i><b>14</b> Making your own website with postcards</a>
<ul>
<li class="chapter" data-level="14.1" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#here"><i class="fa fa-check"></i><b>14.1</b> here</a></li>
<li class="chapter" data-level="14.2" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#usethis"><i class="fa fa-check"></i><b>14.2</b> Usethis</a></li>
<li class="chapter" data-level="14.3" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#git-github"><i class="fa fa-check"></i><b>14.3</b> Git + GitHub</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#prerequisites"><i class="fa fa-check"></i><b>14.3.1</b> Prerequisites</a></li>
<li class="chapter" data-level="14.3.2" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#creating-a-personal-access-token-pat"><i class="fa fa-check"></i><b>14.3.2</b> Creating a personal access token (PAT)</a></li>
<li class="chapter" data-level="14.3.3" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#initialize-git-and-github-repository"><i class="fa fa-check"></i><b>14.3.3</b> Initialize Git and GitHub repository</a></li>
<li class="chapter" data-level="14.3.4" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#some-other-gert-commands"><i class="fa fa-check"></i><b>14.3.4</b> Some other gert commands</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#r-websites"><i class="fa fa-check"></i><b>14.4</b> R websites</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#set-up-_site.yml"><i class="fa fa-check"></i><b>14.4.1</b> 1. Set Up _site.yml</a></li>
<li class="chapter" data-level="14.4.2" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#create-index.rmd-for-the-homepage"><i class="fa fa-check"></i><b>14.4.2</b> 2. Create index.Rmd for the Homepage</a></li>
<li class="chapter" data-level="14.4.3" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#render-the-site"><i class="fa fa-check"></i><b>14.4.3</b> 3. Render the Site</a></li>
<li class="chapter" data-level="14.4.4" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#publish-the-website"><i class="fa fa-check"></i><b>14.4.4</b> 4. Publish the Website</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#postcards"><i class="fa fa-check"></i><b>14.5</b> postcards</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#installation"><i class="fa fa-check"></i><b>14.5.1</b> Installation</a></li>
<li class="chapter" data-level="14.5.2" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#templates"><i class="fa fa-check"></i><b>14.5.2</b> Templates</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#create-your-own-website-with-postcards"><i class="fa fa-check"></i><b>14.6</b> Create your own website with postcards!</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#create-a-new-project-in-rstudio-interactive-selection"><i class="fa fa-check"></i><b>14.6.1</b> Create a New Project in RStudio (Interactive Selection)</a></li>
<li class="chapter" data-level="14.6.2" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#set-up-git-and-github"><i class="fa fa-check"></i><b>14.6.2</b> Set Up Git and GitHub</a></li>
<li class="chapter" data-level="14.6.3" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#choose-a-template"><i class="fa fa-check"></i><b>14.6.3</b> Choose a Template</a></li>
<li class="chapter" data-level="14.6.4" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#edit-with-your-information"><i class="fa fa-check"></i><b>14.6.4</b> Edit with Your Information</a></li>
<li class="chapter" data-level="14.6.5" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#deploy-the-page"><i class="fa fa-check"></i><b>14.6.5</b> Deploy the Page</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="making-your-own-website-with-postcards.html"><a href="making-your-own-website-with-postcards.html#references-5"><i class="fa fa-check"></i><b>14.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="final-r-session.html"><a href="final-r-session.html"><i class="fa fa-check"></i>Final R Session</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Analysis of Genome Scale Data 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scrna-seq-data-analysis-overview" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> scRNA-seq data analysis overview<a href="scrna-seq-data-analysis-overview.html#scrna-seq-data-analysis-overview" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Instructor: Melissa Mayén Quiroz</p>
<p>Adapted from: <a href="https://bioconductor.org/books/3.19/OSCA.basic/">OSCA: Basics of Single-Cell Analysis with Bioconductor</a></p>
<div id="single-cell-rna-sequencing" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Single cell RNA sequencing<a href="scrna-seq-data-analysis-overview.html#single-cell-rna-sequencing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Single-cell RNA sequencing (scRNA-seq) is a cutting-edge technology used to analyze the gene expression profiles of individual cells. Unlike traditional bulk RNA sequencing, which provides an average expression profile of a population of cells, scRNA-seq allows researchers to study the gene expression patterns of single cells.</p>
<ul>
<li>Cell heterogeneity</li>
<li>Cell type identification</li>
<li>Cell state dynamics</li>
</ul>
<p><a href="https://bioconductor.org/books/release/OSCA/">Orchestrating Single-Cell Analysis with Bioconductor</a></p>
<p><img src="https://raw.githubusercontent.com/lcolladotor/cshl_rstats_genome_scale_2024/devel/Figures/OSCA.PNG" /></p>
<p><em>Authors: Robert Amezquita [aut], Aaron Lun [aut], Stephanie Hicks [aut], Raphael Gottardo [aut], Alan O’Callaghan [cre]</em></p>
<div id="pre-processing-of-scrna-seq-data-before-r" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Pre-processing of scRNA-seq Data (Before R)<a href="scrna-seq-data-analysis-overview.html#pre-processing-of-scrna-seq-data-before-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Quality Control of the reads (FastQC):</li>
</ul>
<p>Assess the quality of raw sequencing reads. Check GC content, overrepresented sequences, presence of N bases, and other quality metrics.</p>
<ul>
<li>Alignment to Reference Transcriptome:</li>
</ul>
<p>Align sequencing reads to a reference transcriptome. Generate aligned read files.</p>
<ul>
<li>Generation of Expression Count Matrix:</li>
</ul>
<p>Quantify gene expression levels by counting the number of reads mapped to each gene.
Create a matrix with genes as rows and cells as columns, where each entry represents the count of reads for a specific gene in a specific cell.
For 10x Genomics data, the Cellranger software suite (Zheng et al. 2017) provides a custom pipeline to obtain a count matrix. This uses STAR to align reads to the reference genome and then counts the number of unique UMIs mapped to each gene.</p>
</div>
<div id="different-technologies" class="section level3 hasAnchor" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Different Technologies<a href="scrna-seq-data-analysis-overview.html#different-technologies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Droplet-based: 10x Genomics, inDrop, Drop-seq</li>
<li>Plate-based with unique molecular identifiers (UMIs): CEL-seq, MARS-seq</li>
<li>Plate-based with reads: Smart-seq2</li>
<li>Other: sci-RNA-seq, Seq-Well</li>
</ul>
<p>In practical terms, droplet-based technologies are the current de facto standard due to their throughput and low cost per cell. Plate-based methods can capture other phenotypic information (e.g., morphology) and are more amenable to customization. Read-based methods provide whole-transcript coverage, which is useful in some applications (e.g., splicing, exome mutations); otherwise, UMI-based methods are more popular as they mitigate the effects of PCR amplification noise.</p>
</div>
</div>
<div id="basic-workflow" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Basic Workflow<a href="scrna-seq-data-analysis-overview.html#basic-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the simplest case, the workflow has the following form:</p>
<p><img src="https://raw.githubusercontent.com/lcolladotor/cshl_rstats_genome_scale_2024/devel/Figures/scRNAseq_workflow.PNG" /></p>
<ul>
<li><p>We compute quality control metrics to remove low-quality cells that would interfere with downstream analyses. These cells may have been damaged during processing or may not have been fully captured by the sequencing protocol. Common metrics includes the total counts per cell, the proportion of spike-in or mitochondrial reads and the number of detected features.</p></li>
<li><p>We convert the counts into normalized expression values to eliminate cell-specific biases (e.g., in capture efficiency). This allows us to perform explicit comparisons across cells in downstream steps like clustering. We also apply a transformation, typically log, to adjust for the mean-variance relationship.</p></li>
<li><p>We perform feature selection to pick a subset of interesting features for downstream analysis. This is done by modelling the variance across cells for each gene and retaining genes that are highly variable. The aim is to reduce computational overhead and noise from uninteresting genes.</p></li>
<li><p>We apply dimensionality reduction to compact the data and further reduce noise. Principal components analysis is typically used to obtain an initial low-rank representation for more computational work, followed by more aggressive methods like<br />
t-stochastic neighbor embedding for visualization purposes.</p></li>
<li><p>We cluster cells into groups according to similarities in their (normalized) expression profiles. This aims to obtain groupings that serve as empirical proxies for distinct biological states. We typically interpret these groupings by identifying differentially expressed marker genes between clusters.</p></li>
</ul>
</div>
<div id="the-singlecellexperiment-class" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> The SingleCellExperiment class<a href="scrna-seq-data-analysis-overview.html#the-singlecellexperiment-class" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This object is specifically designed to store and analyze single-cell RNA sequencing (scRNA-seq) data. It extends the <code>SummarizedExperiment</code> class to include specialized features for single-cell data, such as cell identifiers, dimensionality reduction results, and methods for quality control and normalization.</p>
<p><img src="https://raw.githubusercontent.com/lcolladotor/cshl_rstats_genome_scale_2024/devel/Figures/sce_structure.PNG" /></p>
<ul>
<li><p>Assay Data: The primary data matrix containing gene expression values or other measurements. Rows represent genes and columns represent cells.</p></li>
<li><p><code>colData</code> (Column Metadata): Additional information about each cell, such as cell type, experimental condition, or any other relevant metadata.</p></li>
<li><p><code>rowData</code> (Row Metadata): Additional information about each gene, such as gene symbols, genomic coordinates, or functional annotations.</p></li>
<li><p><code>reducedDims</code>: Dimensionality reduction results, such as “principal component analysis” (PCA), “t-distributed stochastic neighbor embedding” (t-SNE), and
“Uniform Manifold Approximation and Projection” (UMAP), used for visualizing and clustering cells.</p></li>
<li><p><code>altExpNames</code> and <code>altExps</code>: Names of alternative experiments (such as spike-in control genes used for normalization) and alternative experiment counts matrices.</p></li>
<li><p><code>metadata</code>: Additional metadata about the experiment.</p></li>
</ul>
<div id="data-loading" class="section level3 hasAnchor" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Data Loading<a href="scrna-seq-data-analysis-overview.html#data-loading" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Lun et al. (2017) dataset contains two 96-well plates of 416B cells (an immortalized mouse myeloid progenitor cell line), processed using the Smart-seq2 protocol (Picelli et al. 2014). A constant amount of spike-in RNA from the External RNA Controls Consortium (ERCC) was also added to each cell’s lysate prior to library preparation.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="scrna-seq-data-analysis-overview.html#cb123-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scRNAseq&quot;</span>)</span>
<span id="cb123-2"><a href="scrna-seq-data-analysis-overview.html#cb123-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;SingleCellExperiment&quot;</span>)</span>
<span id="cb123-3"><a href="scrna-seq-data-analysis-overview.html#cb123-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;AnnotationHub&quot;</span>)</span>
<span id="cb123-4"><a href="scrna-seq-data-analysis-overview.html#cb123-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb123-5"><a href="scrna-seq-data-analysis-overview.html#cb123-5" tabindex="-1"></a></span>
<span id="cb123-6"><a href="scrna-seq-data-analysis-overview.html#cb123-6" tabindex="-1"></a><span class="do">## Load the data set</span></span>
<span id="cb123-7"><a href="scrna-seq-data-analysis-overview.html#cb123-7" tabindex="-1"></a>sce<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">LunSpikeInData</span>(<span class="at">which =</span> <span class="st">&quot;416b&quot;</span>)</span>
<span id="cb123-8"><a href="scrna-seq-data-analysis-overview.html#cb123-8" tabindex="-1"></a><span class="co">#&gt; downloading 1 resources</span></span>
<span id="cb123-9"><a href="scrna-seq-data-analysis-overview.html#cb123-9" tabindex="-1"></a><span class="co">#&gt; retrieving 1 resource</span></span>
<span id="cb123-10"><a href="scrna-seq-data-analysis-overview.html#cb123-10" tabindex="-1"></a><span class="co">#&gt; loading from cache</span></span>
<span id="cb123-11"><a href="scrna-seq-data-analysis-overview.html#cb123-11" tabindex="-1"></a><span class="co">#&gt; require(&quot;ensembldb&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="scrna-seq-data-analysis-overview.html#cb124-1" tabindex="-1"></a></span>
<span id="cb124-2"><a href="scrna-seq-data-analysis-overview.html#cb124-2" tabindex="-1"></a><span class="do">## We convert the blocking factor to a factor so that downstream steps do not treat it as an integer.</span></span>
<span id="cb124-3"><a href="scrna-seq-data-analysis-overview.html#cb124-3" tabindex="-1"></a>sce<span class="fl">.416</span>b<span class="sc">$</span>block <span class="ot">&lt;-</span> <span class="fu">factor</span>(sce<span class="fl">.416</span>b<span class="sc">$</span>block)</span>
<span id="cb124-4"><a href="scrna-seq-data-analysis-overview.html#cb124-4" tabindex="-1"></a></span>
<span id="cb124-5"><a href="scrna-seq-data-analysis-overview.html#cb124-5" tabindex="-1"></a><span class="do">## rename the rows with the symbols, reverting to Ensembl identifiers</span></span>
<span id="cb124-6"><a href="scrna-seq-data-analysis-overview.html#cb124-6" tabindex="-1"></a>ens.mm.v97 <span class="ot">&lt;-</span> <span class="fu">AnnotationHub</span>()[[<span class="st">&quot;AH73905&quot;</span>]]</span>
<span id="cb124-7"><a href="scrna-seq-data-analysis-overview.html#cb124-7" tabindex="-1"></a><span class="co">#&gt; loading from cache</span></span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="scrna-seq-data-analysis-overview.html#cb125-1" tabindex="-1"></a><span class="fu">rowData</span>(sce<span class="fl">.416</span>b)<span class="sc">$</span>ENSEMBL <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sce<span class="fl">.416</span>b)</span>
<span id="cb125-2"><a href="scrna-seq-data-analysis-overview.html#cb125-2" tabindex="-1"></a><span class="fu">rowData</span>(sce<span class="fl">.416</span>b)<span class="sc">$</span>SYMBOL <span class="ot">&lt;-</span> <span class="fu">mapIds</span>(ens.mm.v97,</span>
<span id="cb125-3"><a href="scrna-seq-data-analysis-overview.html#cb125-3" tabindex="-1"></a>    <span class="at">keys =</span> <span class="fu">rownames</span>(sce<span class="fl">.416</span>b),</span>
<span id="cb125-4"><a href="scrna-seq-data-analysis-overview.html#cb125-4" tabindex="-1"></a>    <span class="at">keytype =</span> <span class="st">&quot;GENEID&quot;</span>, <span class="at">column =</span> <span class="st">&quot;SYMBOL&quot;</span></span>
<span id="cb125-5"><a href="scrna-seq-data-analysis-overview.html#cb125-5" tabindex="-1"></a>)</span>
<span id="cb125-6"><a href="scrna-seq-data-analysis-overview.html#cb125-6" tabindex="-1"></a><span class="co">#&gt; Warning: Unable to map 563 of 46604 requested IDs.</span></span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="scrna-seq-data-analysis-overview.html#cb126-1" tabindex="-1"></a><span class="fu">rowData</span>(sce<span class="fl">.416</span>b)<span class="sc">$</span>SEQNAME <span class="ot">&lt;-</span> <span class="fu">mapIds</span>(ens.mm.v97,</span>
<span id="cb126-2"><a href="scrna-seq-data-analysis-overview.html#cb126-2" tabindex="-1"></a>    <span class="at">keys =</span> <span class="fu">rownames</span>(sce<span class="fl">.416</span>b),</span>
<span id="cb126-3"><a href="scrna-seq-data-analysis-overview.html#cb126-3" tabindex="-1"></a>    <span class="at">keytype =</span> <span class="st">&quot;GENEID&quot;</span>, <span class="at">column =</span> <span class="st">&quot;SEQNAME&quot;</span></span>
<span id="cb126-4"><a href="scrna-seq-data-analysis-overview.html#cb126-4" tabindex="-1"></a>)</span>
<span id="cb126-5"><a href="scrna-seq-data-analysis-overview.html#cb126-5" tabindex="-1"></a><span class="co">#&gt; Warning: Unable to map 563 of 46604 requested IDs.</span></span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="scrna-seq-data-analysis-overview.html#cb127-1" tabindex="-1"></a></span>
<span id="cb127-2"><a href="scrna-seq-data-analysis-overview.html#cb127-2" tabindex="-1"></a><span class="fu">rownames</span>(sce<span class="fl">.416</span>b) <span class="ot">&lt;-</span> <span class="fu">uniquifyFeatureNames</span>(</span>
<span id="cb127-3"><a href="scrna-seq-data-analysis-overview.html#cb127-3" tabindex="-1"></a>    <span class="fu">rowData</span>(sce<span class="fl">.416</span>b)<span class="sc">$</span>ENSEMBL,</span>
<span id="cb127-4"><a href="scrna-seq-data-analysis-overview.html#cb127-4" tabindex="-1"></a>    <span class="fu">rowData</span>(sce<span class="fl">.416</span>b)<span class="sc">$</span>SYMBOL</span>
<span id="cb127-5"><a href="scrna-seq-data-analysis-overview.html#cb127-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="basics-of-your-sce" class="section level3 hasAnchor" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> Basics of your SCE<a href="scrna-seq-data-analysis-overview.html#basics-of-your-sce" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="scrna-seq-data-analysis-overview.html#cb128-1" tabindex="-1"></a><span class="do">## Look at your SCE</span></span>
<span id="cb128-2"><a href="scrna-seq-data-analysis-overview.html#cb128-2" tabindex="-1"></a>sce<span class="fl">.416</span>b</span>
<span id="cb128-3"><a href="scrna-seq-data-analysis-overview.html#cb128-3" tabindex="-1"></a><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span id="cb128-4"><a href="scrna-seq-data-analysis-overview.html#cb128-4" tabindex="-1"></a><span class="co">#&gt; dim: 46604 192 </span></span>
<span id="cb128-5"><a href="scrna-seq-data-analysis-overview.html#cb128-5" tabindex="-1"></a><span class="co">#&gt; metadata(0):</span></span>
<span id="cb128-6"><a href="scrna-seq-data-analysis-overview.html#cb128-6" tabindex="-1"></a><span class="co">#&gt; assays(1): counts</span></span>
<span id="cb128-7"><a href="scrna-seq-data-analysis-overview.html#cb128-7" tabindex="-1"></a><span class="co">#&gt; rownames(46604): 4933401J01Rik Gm26206 ... CAAA01147332.1 CBFB-MYH11-mcherry</span></span>
<span id="cb128-8"><a href="scrna-seq-data-analysis-overview.html#cb128-8" tabindex="-1"></a><span class="co">#&gt; rowData names(4): Length ENSEMBL SYMBOL SEQNAME</span></span>
<span id="cb128-9"><a href="scrna-seq-data-analysis-overview.html#cb128-9" tabindex="-1"></a><span class="co">#&gt; colnames(192): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...</span></span>
<span id="cb128-10"><a href="scrna-seq-data-analysis-overview.html#cb128-10" tabindex="-1"></a><span class="co">#&gt;   SLX-11312.N712_S508.H5H5YBBXX.s_8.r_1 SLX-11312.N712_S517.H5H5YBBXX.s_8.r_1</span></span>
<span id="cb128-11"><a href="scrna-seq-data-analysis-overview.html#cb128-11" tabindex="-1"></a><span class="co">#&gt; colData names(8): cell line cell type ... spike-in addition block</span></span>
<span id="cb128-12"><a href="scrna-seq-data-analysis-overview.html#cb128-12" tabindex="-1"></a><span class="co">#&gt; reducedDimNames(0):</span></span>
<span id="cb128-13"><a href="scrna-seq-data-analysis-overview.html#cb128-13" tabindex="-1"></a><span class="co">#&gt; mainExpName: endogenous</span></span>
<span id="cb128-14"><a href="scrna-seq-data-analysis-overview.html#cb128-14" tabindex="-1"></a><span class="co">#&gt; altExpNames(2): ERCC SIRV</span></span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="scrna-seq-data-analysis-overview.html#cb129-1" tabindex="-1"></a></span>
<span id="cb129-2"><a href="scrna-seq-data-analysis-overview.html#cb129-2" tabindex="-1"></a><span class="do">## Get in the slot &quot;assay&quot;, in the count matrix</span></span>
<span id="cb129-3"><a href="scrna-seq-data-analysis-overview.html#cb129-3" tabindex="-1"></a><span class="do">## [genes, cells]</span></span>
<span id="cb129-4"><a href="scrna-seq-data-analysis-overview.html#cb129-4" tabindex="-1"></a><span class="fu">assay</span>(sce<span class="fl">.416</span>b, <span class="st">&quot;counts&quot;</span>)[<span class="dv">110</span><span class="sc">:</span><span class="dv">113</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># gene, cell</span></span>
<span id="cb129-5"><a href="scrna-seq-data-analysis-overview.html#cb129-5" tabindex="-1"></a><span class="co">#&gt; 4 x 2 sparse Matrix of class &quot;dgCMatrix&quot;</span></span>
<span id="cb129-6"><a href="scrna-seq-data-analysis-overview.html#cb129-6" tabindex="-1"></a><span class="co">#&gt;               SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 SLX-9555.N701_S503.C89V9ANXX.s_1.r_1</span></span>
<span id="cb129-7"><a href="scrna-seq-data-analysis-overview.html#cb129-7" tabindex="-1"></a><span class="co">#&gt; 1700034P13Rik                                    .                                    .</span></span>
<span id="cb129-8"><a href="scrna-seq-data-analysis-overview.html#cb129-8" tabindex="-1"></a><span class="co">#&gt; Sgk3                                             8                                    .</span></span>
<span id="cb129-9"><a href="scrna-seq-data-analysis-overview.html#cb129-9" tabindex="-1"></a><span class="co">#&gt; Gm6195                                           2                                    3</span></span>
<span id="cb129-10"><a href="scrna-seq-data-analysis-overview.html#cb129-10" tabindex="-1"></a><span class="co">#&gt; Gm22607                                          .                                    .</span></span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="scrna-seq-data-analysis-overview.html#cb130-1" tabindex="-1"></a></span>
<span id="cb130-2"><a href="scrna-seq-data-analysis-overview.html#cb130-2" tabindex="-1"></a><span class="do">## We can do it like this too</span></span>
<span id="cb130-3"><a href="scrna-seq-data-analysis-overview.html#cb130-3" tabindex="-1"></a><span class="fu">counts</span>(sce<span class="fl">.416</span>b)[<span class="dv">110</span><span class="sc">:</span><span class="dv">113</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb130-4"><a href="scrna-seq-data-analysis-overview.html#cb130-4" tabindex="-1"></a><span class="co">#&gt; 4 x 2 sparse Matrix of class &quot;dgCMatrix&quot;</span></span>
<span id="cb130-5"><a href="scrna-seq-data-analysis-overview.html#cb130-5" tabindex="-1"></a><span class="co">#&gt;               SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 SLX-9555.N701_S503.C89V9ANXX.s_1.r_1</span></span>
<span id="cb130-6"><a href="scrna-seq-data-analysis-overview.html#cb130-6" tabindex="-1"></a><span class="co">#&gt; 1700034P13Rik                                    .                                    .</span></span>
<span id="cb130-7"><a href="scrna-seq-data-analysis-overview.html#cb130-7" tabindex="-1"></a><span class="co">#&gt; Sgk3                                             8                                    .</span></span>
<span id="cb130-8"><a href="scrna-seq-data-analysis-overview.html#cb130-8" tabindex="-1"></a><span class="co">#&gt; Gm6195                                           2                                    3</span></span>
<span id="cb130-9"><a href="scrna-seq-data-analysis-overview.html#cb130-9" tabindex="-1"></a><span class="co">#&gt; Gm22607                                          .                                    .</span></span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="scrna-seq-data-analysis-overview.html#cb131-1" tabindex="-1"></a></span>
<span id="cb131-2"><a href="scrna-seq-data-analysis-overview.html#cb131-2" tabindex="-1"></a><span class="do">## We could add more assays to our SCE</span></span>
<span id="cb131-3"><a href="scrna-seq-data-analysis-overview.html#cb131-3" tabindex="-1"></a>sce<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">logNormCounts</span>(sce<span class="fl">.416</span>b)</span>
<span id="cb131-4"><a href="scrna-seq-data-analysis-overview.html#cb131-4" tabindex="-1"></a>sce<span class="fl">.416</span>b</span>
<span id="cb131-5"><a href="scrna-seq-data-analysis-overview.html#cb131-5" tabindex="-1"></a><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span id="cb131-6"><a href="scrna-seq-data-analysis-overview.html#cb131-6" tabindex="-1"></a><span class="co">#&gt; dim: 46604 192 </span></span>
<span id="cb131-7"><a href="scrna-seq-data-analysis-overview.html#cb131-7" tabindex="-1"></a><span class="co">#&gt; metadata(0):</span></span>
<span id="cb131-8"><a href="scrna-seq-data-analysis-overview.html#cb131-8" tabindex="-1"></a><span class="co">#&gt; assays(2): counts logcounts</span></span>
<span id="cb131-9"><a href="scrna-seq-data-analysis-overview.html#cb131-9" tabindex="-1"></a><span class="co">#&gt; rownames(46604): 4933401J01Rik Gm26206 ... CAAA01147332.1 CBFB-MYH11-mcherry</span></span>
<span id="cb131-10"><a href="scrna-seq-data-analysis-overview.html#cb131-10" tabindex="-1"></a><span class="co">#&gt; rowData names(4): Length ENSEMBL SYMBOL SEQNAME</span></span>
<span id="cb131-11"><a href="scrna-seq-data-analysis-overview.html#cb131-11" tabindex="-1"></a><span class="co">#&gt; colnames(192): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...</span></span>
<span id="cb131-12"><a href="scrna-seq-data-analysis-overview.html#cb131-12" tabindex="-1"></a><span class="co">#&gt;   SLX-11312.N712_S508.H5H5YBBXX.s_8.r_1 SLX-11312.N712_S517.H5H5YBBXX.s_8.r_1</span></span>
<span id="cb131-13"><a href="scrna-seq-data-analysis-overview.html#cb131-13" tabindex="-1"></a><span class="co">#&gt; colData names(9): cell line cell type ... block sizeFactor</span></span>
<span id="cb131-14"><a href="scrna-seq-data-analysis-overview.html#cb131-14" tabindex="-1"></a><span class="co">#&gt; reducedDimNames(0):</span></span>
<span id="cb131-15"><a href="scrna-seq-data-analysis-overview.html#cb131-15" tabindex="-1"></a><span class="co">#&gt; mainExpName: endogenous</span></span>
<span id="cb131-16"><a href="scrna-seq-data-analysis-overview.html#cb131-16" tabindex="-1"></a><span class="co">#&gt; altExpNames(2): ERCC SIRV</span></span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="scrna-seq-data-analysis-overview.html#cb132-1" tabindex="-1"></a></span>
<span id="cb132-2"><a href="scrna-seq-data-analysis-overview.html#cb132-2" tabindex="-1"></a><span class="do">## Acces to the column names (cell identifyers)</span></span>
<span id="cb132-3"><a href="scrna-seq-data-analysis-overview.html#cb132-3" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">colnames</span>(sce<span class="fl">.416</span>b))</span>
<span id="cb132-4"><a href="scrna-seq-data-analysis-overview.html#cb132-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SLX-9555.N701_S502.C89V9ANXX.s_1.r_1&quot; &quot;SLX-9555.N701_S503.C89V9ANXX.s_1.r_1&quot; &quot;SLX-9555.N701_S504.C89V9ANXX.s_1.r_1&quot;</span></span>
<span id="cb132-5"><a href="scrna-seq-data-analysis-overview.html#cb132-5" tabindex="-1"></a><span class="co">#&gt; [4] &quot;SLX-9555.N701_S505.C89V9ANXX.s_1.r_1&quot; &quot;SLX-9555.N701_S506.C89V9ANXX.s_1.r_1&quot; &quot;SLX-9555.N701_S507.C89V9ANXX.s_1.r_1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="scrna-seq-data-analysis-overview.html#cb133-1" tabindex="-1"></a></span>
<span id="cb133-2"><a href="scrna-seq-data-analysis-overview.html#cb133-2" tabindex="-1"></a><span class="do">## Acces to the column data (cell information)</span></span>
<span id="cb133-3"><a href="scrna-seq-data-analysis-overview.html#cb133-3" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">colData</span>(sce<span class="fl">.416</span>b))</span>
<span id="cb133-4"><a href="scrna-seq-data-analysis-overview.html#cb133-4" tabindex="-1"></a><span class="co">#&gt; DataFrame with 6 rows and 9 columns</span></span>
<span id="cb133-5"><a href="scrna-seq-data-analysis-overview.html#cb133-5" tabindex="-1"></a><span class="co">#&gt;                                        cell line           cell type single cell well quality               genotype</span></span>
<span id="cb133-6"><a href="scrna-seq-data-analysis-overview.html#cb133-6" tabindex="-1"></a><span class="co">#&gt;                                      &lt;character&gt;         &lt;character&gt;              &lt;character&gt;            &lt;character&gt;</span></span>
<span id="cb133-7"><a href="scrna-seq-data-analysis-overview.html#cb133-7" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1        416B embryonic stem cell                       OK Doxycycline-inducibl..</span></span>
<span id="cb133-8"><a href="scrna-seq-data-analysis-overview.html#cb133-8" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1        416B embryonic stem cell                       OK Doxycycline-inducibl..</span></span>
<span id="cb133-9"><a href="scrna-seq-data-analysis-overview.html#cb133-9" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1        416B embryonic stem cell                       OK Doxycycline-inducibl..</span></span>
<span id="cb133-10"><a href="scrna-seq-data-analysis-overview.html#cb133-10" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1        416B embryonic stem cell                       OK Doxycycline-inducibl..</span></span>
<span id="cb133-11"><a href="scrna-seq-data-analysis-overview.html#cb133-11" tabindex="-1"></a><span class="co">#&gt;                                                   phenotype      strain spike-in addition    block sizeFactor</span></span>
<span id="cb133-12"><a href="scrna-seq-data-analysis-overview.html#cb133-12" tabindex="-1"></a><span class="co">#&gt;                                                 &lt;character&gt; &lt;character&gt;       &lt;character&gt; &lt;factor&gt;  &lt;numeric&gt;</span></span>
<span id="cb133-13"><a href="scrna-seq-data-analysis-overview.html#cb133-13" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype    B6D2F1-J         ERCC+SIRV 20160113   0.742741</span></span>
<span id="cb133-14"><a href="scrna-seq-data-analysis-overview.html#cb133-14" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype    B6D2F1-J         ERCC+SIRV 20160113   0.923157</span></span>
<span id="cb133-15"><a href="scrna-seq-data-analysis-overview.html#cb133-15" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype    B6D2F1-J         ERCC+SIRV 20160113   1.012242</span></span>
<span id="cb133-16"><a href="scrna-seq-data-analysis-overview.html#cb133-16" tabindex="-1"></a><span class="co">#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    B6D2F1-J         ERCC+SIRV 20160113   1.151585</span></span>
<span id="cb133-17"><a href="scrna-seq-data-analysis-overview.html#cb133-17" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 2 rows ]</span></span></code></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="scrna-seq-data-analysis-overview.html#cb134-1" tabindex="-1"></a></span>
<span id="cb134-2"><a href="scrna-seq-data-analysis-overview.html#cb134-2" tabindex="-1"></a><span class="do">## Acces to the row names (gene names)</span></span>
<span id="cb134-3"><a href="scrna-seq-data-analysis-overview.html#cb134-3" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rownames</span>(sce<span class="fl">.416</span>b))</span>
<span id="cb134-4"><a href="scrna-seq-data-analysis-overview.html#cb134-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;4933401J01Rik&quot; &quot;Gm26206&quot;       &quot;Xkr4&quot;          &quot;Gm18956&quot;       &quot;Gm37180&quot;       &quot;Gm37363&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="scrna-seq-data-analysis-overview.html#cb135-1" tabindex="-1"></a></span>
<span id="cb135-2"><a href="scrna-seq-data-analysis-overview.html#cb135-2" tabindex="-1"></a><span class="do">## Acces to the row data (gene information)</span></span>
<span id="cb135-3"><a href="scrna-seq-data-analysis-overview.html#cb135-3" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rowData</span>(sce<span class="fl">.416</span>b))</span>
<span id="cb135-4"><a href="scrna-seq-data-analysis-overview.html#cb135-4" tabindex="-1"></a><span class="co">#&gt; DataFrame with 6 rows and 4 columns</span></span>
<span id="cb135-5"><a href="scrna-seq-data-analysis-overview.html#cb135-5" tabindex="-1"></a><span class="co">#&gt;                  Length            ENSEMBL        SYMBOL     SEQNAME</span></span>
<span id="cb135-6"><a href="scrna-seq-data-analysis-overview.html#cb135-6" tabindex="-1"></a><span class="co">#&gt;               &lt;integer&gt;        &lt;character&gt;   &lt;character&gt; &lt;character&gt;</span></span>
<span id="cb135-7"><a href="scrna-seq-data-analysis-overview.html#cb135-7" tabindex="-1"></a><span class="co">#&gt; 4933401J01Rik      1070 ENSMUSG00000102693 4933401J01Rik           1</span></span>
<span id="cb135-8"><a href="scrna-seq-data-analysis-overview.html#cb135-8" tabindex="-1"></a><span class="co">#&gt; Gm26206             110 ENSMUSG00000064842       Gm26206           1</span></span>
<span id="cb135-9"><a href="scrna-seq-data-analysis-overview.html#cb135-9" tabindex="-1"></a><span class="co">#&gt; Xkr4               6094 ENSMUSG00000051951          Xkr4           1</span></span>
<span id="cb135-10"><a href="scrna-seq-data-analysis-overview.html#cb135-10" tabindex="-1"></a><span class="co">#&gt; Gm18956             480 ENSMUSG00000102851       Gm18956           1</span></span>
<span id="cb135-11"><a href="scrna-seq-data-analysis-overview.html#cb135-11" tabindex="-1"></a><span class="co">#&gt; Gm37180            2819 ENSMUSG00000103377       Gm37180           1</span></span>
<span id="cb135-12"><a href="scrna-seq-data-analysis-overview.html#cb135-12" tabindex="-1"></a><span class="co">#&gt; Gm37363            2233 ENSMUSG00000104017       Gm37363           1</span></span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="scrna-seq-data-analysis-overview.html#cb136-1" tabindex="-1"></a></span>
<span id="cb136-2"><a href="scrna-seq-data-analysis-overview.html#cb136-2" tabindex="-1"></a><span class="do">## We can create another SCE subsetitng the first one</span></span>
<span id="cb136-3"><a href="scrna-seq-data-analysis-overview.html#cb136-3" tabindex="-1"></a>sce_2 <span class="ot">&lt;-</span> sce<span class="fl">.416</span>b[<span class="dv">110</span><span class="sc">:</span><span class="dv">130</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb136-4"><a href="scrna-seq-data-analysis-overview.html#cb136-4" tabindex="-1"></a>sce_2</span>
<span id="cb136-5"><a href="scrna-seq-data-analysis-overview.html#cb136-5" tabindex="-1"></a><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span id="cb136-6"><a href="scrna-seq-data-analysis-overview.html#cb136-6" tabindex="-1"></a><span class="co">#&gt; dim: 21 2 </span></span>
<span id="cb136-7"><a href="scrna-seq-data-analysis-overview.html#cb136-7" tabindex="-1"></a><span class="co">#&gt; metadata(0):</span></span>
<span id="cb136-8"><a href="scrna-seq-data-analysis-overview.html#cb136-8" tabindex="-1"></a><span class="co">#&gt; assays(2): counts logcounts</span></span>
<span id="cb136-9"><a href="scrna-seq-data-analysis-overview.html#cb136-9" tabindex="-1"></a><span class="co">#&gt; rownames(21): 1700034P13Rik Sgk3 ... Gm38005 Gm15604</span></span>
<span id="cb136-10"><a href="scrna-seq-data-analysis-overview.html#cb136-10" tabindex="-1"></a><span class="co">#&gt; rowData names(4): Length ENSEMBL SYMBOL SEQNAME</span></span>
<span id="cb136-11"><a href="scrna-seq-data-analysis-overview.html#cb136-11" tabindex="-1"></a><span class="co">#&gt; colnames(2): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 SLX-9555.N701_S503.C89V9ANXX.s_1.r_1</span></span>
<span id="cb136-12"><a href="scrna-seq-data-analysis-overview.html#cb136-12" tabindex="-1"></a><span class="co">#&gt; colData names(9): cell line cell type ... block sizeFactor</span></span>
<span id="cb136-13"><a href="scrna-seq-data-analysis-overview.html#cb136-13" tabindex="-1"></a><span class="co">#&gt; reducedDimNames(0):</span></span>
<span id="cb136-14"><a href="scrna-seq-data-analysis-overview.html#cb136-14" tabindex="-1"></a><span class="co">#&gt; mainExpName: endogenous</span></span>
<span id="cb136-15"><a href="scrna-seq-data-analysis-overview.html#cb136-15" tabindex="-1"></a><span class="co">#&gt; altExpNames(2): ERCC SIRV</span></span></code></pre></div>
<p>As in the <code>SummarizedExperiment</code>, <code>$</code> is the operator used to access a specific column within the cell metadata. That is, it’s a shortcut for <code>colData(obj)$</code>.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="scrna-seq-data-analysis-overview.html#cb137-1" tabindex="-1"></a><span class="fu">head</span>(sce<span class="fl">.416</span>b<span class="sc">$</span><span class="st">`</span><span class="at">cell type</span><span class="st">`</span>)</span>
<span id="cb137-2"><a href="scrna-seq-data-analysis-overview.html#cb137-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;embryonic stem cell&quot; &quot;embryonic stem cell&quot; &quot;embryonic stem cell&quot; &quot;embryonic stem cell&quot; &quot;embryonic stem cell&quot;</span></span>
<span id="cb137-3"><a href="scrna-seq-data-analysis-overview.html#cb137-3" tabindex="-1"></a><span class="co">#&gt; [6] &quot;embryonic stem cell&quot;</span></span></code></pre></div>
<p>Now, we will look at the dimension reductions</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="scrna-seq-data-analysis-overview.html#cb138-1" tabindex="-1"></a><span class="do">## This is empty</span></span>
<span id="cb138-2"><a href="scrna-seq-data-analysis-overview.html#cb138-2" tabindex="-1"></a><span class="fu">reducedDimNames</span>(sce_2)</span>
<span id="cb138-3"><a href="scrna-seq-data-analysis-overview.html#cb138-3" tabindex="-1"></a><span class="co">#&gt; character(0)</span></span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="scrna-seq-data-analysis-overview.html#cb139-1" tabindex="-1"></a><span class="do">## Compute PCA</span></span>
<span id="cb139-2"><a href="scrna-seq-data-analysis-overview.html#cb139-2" tabindex="-1"></a>sce_2 <span class="ot">&lt;-</span> <span class="fu">runPCA</span>(sce_2)</span>
<span id="cb139-3"><a href="scrna-seq-data-analysis-overview.html#cb139-3" tabindex="-1"></a><span class="co">#&gt; Warning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more singular values/vectors requested than</span></span>
<span id="cb139-4"><a href="scrna-seq-data-analysis-overview.html#cb139-4" tabindex="-1"></a><span class="co">#&gt; available</span></span>
<span id="cb139-5"><a href="scrna-seq-data-analysis-overview.html#cb139-5" tabindex="-1"></a><span class="co">#&gt; Warning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth = TRUE, : You&#39;re computing too large a</span></span>
<span id="cb139-6"><a href="scrna-seq-data-analysis-overview.html#cb139-6" tabindex="-1"></a><span class="co">#&gt; percentage of total singular values, use a standard svd instead.</span></span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="scrna-seq-data-analysis-overview.html#cb140-1" tabindex="-1"></a><span class="do">## Check again</span></span>
<span id="cb140-2"><a href="scrna-seq-data-analysis-overview.html#cb140-2" tabindex="-1"></a><span class="fu">reducedDimNames</span>(sce_2)</span>
<span id="cb140-3"><a href="scrna-seq-data-analysis-overview.html#cb140-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;PCA&quot;</span></span></code></pre></div>
</div>
</div>
<div id="quality-control" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Quality Control<a href="scrna-seq-data-analysis-overview.html#quality-control" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Low-quality libraries in scRNA-seq data can arise from a variety of sources such as cell damage during dissociation or failure in library preparation (e.g., inefficient reverse transcription or PCR amplification). These usually manifest as “cells” with low total counts, few expressed genes and high mitochondrial or spike-in proportions. These low-quality libraries are problematic as they can contribute to misleading results in downstream analyses.</p>
<div id="common-choices-of-qc-metrics" class="section level3 hasAnchor" number="11.4.1">
<h3><span class="header-section-number">11.4.1</span> Common choices of QC metrics<a href="scrna-seq-data-analysis-overview.html#common-choices-of-qc-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For each cell, we calculate these QC metrics using the <code>perCellQCMetrics()</code> function from the <code>scater</code> package (McCarthy et al. 2017). The sum column contains the total count for each cell and the detected column contains the number of detected genes. The <code>subsets_Mito_percent</code> column contains the percentage of reads mapped to mitochondrial transcripts. Finally, the <code>altexps_ERCC_percent</code> column contains the percentage of reads mapped to ERCC transcripts.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="scrna-seq-data-analysis-overview.html#cb141-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scuttle&quot;</span>)</span>
<span id="cb141-2"><a href="scrna-seq-data-analysis-overview.html#cb141-2" tabindex="-1"></a></span>
<span id="cb141-3"><a href="scrna-seq-data-analysis-overview.html#cb141-3" tabindex="-1"></a><span class="do">## Identify mitochondrial genes (those with SEQNAME equal to &quot;MT&quot;) in the row data</span></span>
<span id="cb141-4"><a href="scrna-seq-data-analysis-overview.html#cb141-4" tabindex="-1"></a>mito <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rowData</span>(sce<span class="fl">.416</span>b)<span class="sc">$</span>SEQNAME <span class="sc">==</span> <span class="st">&quot;MT&quot;</span>)</span>
<span id="cb141-5"><a href="scrna-seq-data-analysis-overview.html#cb141-5" tabindex="-1"></a></span>
<span id="cb141-6"><a href="scrna-seq-data-analysis-overview.html#cb141-6" tabindex="-1"></a><span class="do">## Compute per-cell QC metrics, including a subset for mitochondrial genes</span></span>
<span id="cb141-7"><a href="scrna-seq-data-analysis-overview.html#cb141-7" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">perCellQCMetrics</span>(sce<span class="fl">.416</span>b, <span class="at">subsets =</span> <span class="fu">list</span>(<span class="at">Mt =</span> mito))</span>
<span id="cb141-8"><a href="scrna-seq-data-analysis-overview.html#cb141-8" tabindex="-1"></a></span>
<span id="cb141-9"><a href="scrna-seq-data-analysis-overview.html#cb141-9" tabindex="-1"></a><span class="fu">summary</span>(stats<span class="sc">$</span>sum) <span class="co"># total library sizes for all cells</span></span>
<span id="cb141-10"><a href="scrna-seq-data-analysis-overview.html#cb141-10" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb141-11"><a href="scrna-seq-data-analysis-overview.html#cb141-11" tabindex="-1"></a><span class="co">#&gt;   27084  856350 1111252 1165865 1328301 4398883</span></span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="scrna-seq-data-analysis-overview.html#cb142-1" tabindex="-1"></a><span class="fu">summary</span>(stats<span class="sc">$</span>detected) <span class="co"># detected features (genes)</span></span>
<span id="cb142-2"><a href="scrna-seq-data-analysis-overview.html#cb142-2" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb142-3"><a href="scrna-seq-data-analysis-overview.html#cb142-3" tabindex="-1"></a><span class="co">#&gt;    5609    7502    8341    8397    9208   11380</span></span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="scrna-seq-data-analysis-overview.html#cb143-1" tabindex="-1"></a><span class="fu">summary</span>(stats<span class="sc">$</span>subsets_Mt_percent) <span class="co"># percentage of reads mapping to mitochondrial genes</span></span>
<span id="cb143-2"><a href="scrna-seq-data-analysis-overview.html#cb143-2" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb143-3"><a href="scrna-seq-data-analysis-overview.html#cb143-3" tabindex="-1"></a><span class="co">#&gt;   4.593   7.294   8.139   8.146   9.035  15.617</span></span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="scrna-seq-data-analysis-overview.html#cb144-1" tabindex="-1"></a><span class="fu">summary</span>(stats<span class="sc">$</span>altexps_ERCC_percent) <span class="co"># percentage of reads mapping to spike-in controls</span></span>
<span id="cb144-2"><a href="scrna-seq-data-analysis-overview.html#cb144-2" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb144-3"><a href="scrna-seq-data-analysis-overview.html#cb144-3" tabindex="-1"></a><span class="co">#&gt;   2.242   4.291   6.031   6.412   8.126  19.429</span></span></code></pre></div>
<p>Alternatively, users may prefer to use the <code>addPerCellQC()</code> function. This computes and appends the per-cell QC statistics to the colData of the <code>SingleCellExperiment</code> object, allowing us to retain all relevant information in a single object for later manipulation.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="scrna-seq-data-analysis-overview.html#cb145-1" tabindex="-1"></a><span class="do">## Compute addPerCellQCMetrics, including a subset for mitochondrial genes</span></span>
<span id="cb145-2"><a href="scrna-seq-data-analysis-overview.html#cb145-2" tabindex="-1"></a>sce<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">addPerCellQCMetrics</span>(sce<span class="fl">.416</span>b, <span class="at">subsets =</span> <span class="fu">list</span>(<span class="at">Mito =</span> mito))</span>
<span id="cb145-3"><a href="scrna-seq-data-analysis-overview.html#cb145-3" tabindex="-1"></a><span class="fu">colnames</span>(<span class="fu">colData</span>(sce<span class="fl">.416</span>b))</span>
<span id="cb145-4"><a href="scrna-seq-data-analysis-overview.html#cb145-4" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;cell line&quot;                &quot;cell type&quot;                &quot;single cell well quality&quot; &quot;genotype&quot;                </span></span>
<span id="cb145-5"><a href="scrna-seq-data-analysis-overview.html#cb145-5" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;phenotype&quot;                &quot;strain&quot;                   &quot;spike-in addition&quot;        &quot;block&quot;                   </span></span>
<span id="cb145-6"><a href="scrna-seq-data-analysis-overview.html#cb145-6" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;sizeFactor&quot;               &quot;sum&quot;                      &quot;detected&quot;                 &quot;subsets_Mito_sum&quot;        </span></span>
<span id="cb145-7"><a href="scrna-seq-data-analysis-overview.html#cb145-7" tabindex="-1"></a><span class="co">#&gt; [13] &quot;subsets_Mito_detected&quot;    &quot;subsets_Mito_percent&quot;     &quot;altexps_ERCC_sum&quot;         &quot;altexps_ERCC_detected&quot;   </span></span>
<span id="cb145-8"><a href="scrna-seq-data-analysis-overview.html#cb145-8" tabindex="-1"></a><span class="co">#&gt; [17] &quot;altexps_ERCC_percent&quot;     &quot;altexps_SIRV_sum&quot;         &quot;altexps_SIRV_detected&quot;    &quot;altexps_SIRV_percent&quot;    </span></span>
<span id="cb145-9"><a href="scrna-seq-data-analysis-overview.html#cb145-9" tabindex="-1"></a><span class="co">#&gt; [21] &quot;total&quot;</span></span></code></pre></div>
<p>A key assumption here is that the QC metrics are independent of the biological state of each cell. Poor values (e.g., low library sizes, high mitochondrial proportions) are presumed to be driven by technical factors rather than biological processes, meaning that the subsequent removal of cells will not misrepresent the biology in downstream analyses.</p>
</div>
<div id="identifying-low-quality-cells" class="section level3 hasAnchor" number="11.4.2">
<h3><span class="header-section-number">11.4.2</span> Identifying low-quality cells<a href="scrna-seq-data-analysis-overview.html#identifying-low-quality-cells" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="with-fixed-thresholds" class="section level4 hasAnchor" number="11.4.2.1">
<h4><span class="header-section-number">11.4.2.1</span> With fixed thresholds<a href="scrna-seq-data-analysis-overview.html#with-fixed-thresholds" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The simplest approach to identifying low-quality cells involves applying fixed thresholds to the QC metrics. For example, we might consider cells to be low quality if they have library sizes below 100,000 reads; express fewer than 5,000 genes; have spike-in proportions above 10%; or have mitochondrial proportions above 10%.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="scrna-seq-data-analysis-overview.html#cb146-1" tabindex="-1"></a><span class="do">## Using our previous perCellQCMetrics data:</span></span>
<span id="cb146-2"><a href="scrna-seq-data-analysis-overview.html#cb146-2" tabindex="-1"></a></span>
<span id="cb146-3"><a href="scrna-seq-data-analysis-overview.html#cb146-3" tabindex="-1"></a><span class="do">## Identify cells with a total library size (sum of counts) less than 100,000</span></span>
<span id="cb146-4"><a href="scrna-seq-data-analysis-overview.html#cb146-4" tabindex="-1"></a>c.lib <span class="ot">&lt;-</span> stats<span class="sc">$</span>sum <span class="sc">&lt;</span> <span class="fl">1e5</span></span>
<span id="cb146-5"><a href="scrna-seq-data-analysis-overview.html#cb146-5" tabindex="-1"></a><span class="do">## Identify cells with fewer than 5,000 detected features (genes)</span></span>
<span id="cb146-6"><a href="scrna-seq-data-analysis-overview.html#cb146-6" tabindex="-1"></a>qc.nexprs <span class="ot">&lt;-</span> stats<span class="sc">$</span>detected <span class="sc">&lt;</span> <span class="fl">5e3</span></span>
<span id="cb146-7"><a href="scrna-seq-data-analysis-overview.html#cb146-7" tabindex="-1"></a><span class="do">## Identify cells with more than 10% of reads mapping to spike-in controls (e.g., ERCC)</span></span>
<span id="cb146-8"><a href="scrna-seq-data-analysis-overview.html#cb146-8" tabindex="-1"></a>qc.spike <span class="ot">&lt;-</span> stats<span class="sc">$</span>altexps_ERCC_percent <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb146-9"><a href="scrna-seq-data-analysis-overview.html#cb146-9" tabindex="-1"></a><span class="do">## Identify cells with more than 10% of reads mapping to mitochondrial genes</span></span>
<span id="cb146-10"><a href="scrna-seq-data-analysis-overview.html#cb146-10" tabindex="-1"></a>qc.mito <span class="ot">&lt;-</span> stats<span class="sc">$</span>subsets_Mt_percent <span class="sc">&gt;</span> <span class="dv">10</span></span>
<span id="cb146-11"><a href="scrna-seq-data-analysis-overview.html#cb146-11" tabindex="-1"></a></span>
<span id="cb146-12"><a href="scrna-seq-data-analysis-overview.html#cb146-12" tabindex="-1"></a><span class="do">## Create a combined logical vector that marks cells to discard if they meet any of the above criteria</span></span>
<span id="cb146-13"><a href="scrna-seq-data-analysis-overview.html#cb146-13" tabindex="-1"></a>discard <span class="ot">&lt;-</span> c.lib <span class="sc">|</span> qc.nexprs <span class="sc">|</span> qc.spike <span class="sc">|</span> qc.mito</span>
<span id="cb146-14"><a href="scrna-seq-data-analysis-overview.html#cb146-14" tabindex="-1"></a></span>
<span id="cb146-15"><a href="scrna-seq-data-analysis-overview.html#cb146-15" tabindex="-1"></a><span class="do">## Summarize the number of cells removed for each reason.</span></span>
<span id="cb146-16"><a href="scrna-seq-data-analysis-overview.html#cb146-16" tabindex="-1"></a><span class="fu">DataFrame</span>(</span>
<span id="cb146-17"><a href="scrna-seq-data-analysis-overview.html#cb146-17" tabindex="-1"></a>    <span class="at">LibSize =</span> <span class="fu">sum</span>(c.lib), <span class="co"># Number of cells removed due to low library size</span></span>
<span id="cb146-18"><a href="scrna-seq-data-analysis-overview.html#cb146-18" tabindex="-1"></a>    <span class="at">NExprs =</span> <span class="fu">sum</span>(qc.nexprs), <span class="co"># Number of cells removed due to low number of detected features</span></span>
<span id="cb146-19"><a href="scrna-seq-data-analysis-overview.html#cb146-19" tabindex="-1"></a>    <span class="at">SpikeProp =</span> <span class="fu">sum</span>(qc.spike), <span class="co"># Number of cells removed due to high spike-in proportion</span></span>
<span id="cb146-20"><a href="scrna-seq-data-analysis-overview.html#cb146-20" tabindex="-1"></a>    <span class="at">MitoProp =</span> <span class="fu">sum</span>(qc.mito), <span class="co"># Number of cells removed due to high mitochondrial proportion</span></span>
<span id="cb146-21"><a href="scrna-seq-data-analysis-overview.html#cb146-21" tabindex="-1"></a>    <span class="at">Total =</span> <span class="fu">sum</span>(discard) <span class="co"># Total number of cells removed</span></span>
<span id="cb146-22"><a href="scrna-seq-data-analysis-overview.html#cb146-22" tabindex="-1"></a>)</span>
<span id="cb146-23"><a href="scrna-seq-data-analysis-overview.html#cb146-23" tabindex="-1"></a><span class="co">#&gt; DataFrame with 1 row and 5 columns</span></span>
<span id="cb146-24"><a href="scrna-seq-data-analysis-overview.html#cb146-24" tabindex="-1"></a><span class="co">#&gt;     LibSize    NExprs SpikeProp  MitoProp     Total</span></span>
<span id="cb146-25"><a href="scrna-seq-data-analysis-overview.html#cb146-25" tabindex="-1"></a><span class="co">#&gt;   &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;</span></span>
<span id="cb146-26"><a href="scrna-seq-data-analysis-overview.html#cb146-26" tabindex="-1"></a><span class="co">#&gt; 1         3         0        19        14        33</span></span></code></pre></div>
<p>While simple, this strategy requires considerable experience to determine appropriate thresholds for each experimental protocol and biological system. Thresholds for read count-based data are not applicable for UMI-based data, and vice versa. Differences in mitochondrial activity or total RNA content require constant adjustment of the mitochondrial and spike-in thresholds, respectively, for different biological systems. Indeed, even with the same protocol and system, the appropriate threshold can vary from run to run due to the vagaries of cDNA capture efficiency and sequencing depth per cell.</p>
</div>
<div id="with-adaptive-threshold" class="section level4 hasAnchor" number="11.4.2.2">
<h4><span class="header-section-number">11.4.2.2</span> With adaptive threshold<a href="scrna-seq-data-analysis-overview.html#with-adaptive-threshold" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here, we assume that most of the dataset consists of high-quality cells. We then identify cells that are outliers for the various QC metrics, based on the <strong>median absolute deviation</strong> (MAD) from the median value of each metric across all cells.</p>
<p>By default, we consider a value to be an outlier if it is more than 3 MADs from the median in the “problematic” direction.</p>
<p>We can do that using the <code>perCellQCFilters()</code> function. It will allow to identify cells with log-transformed library sizes that are more than 3 MADs below the median. A log-transformation is used to improve resolution at small values when <code>type = "lower"</code> and to avoid negative thresholds that would be meaningless for a non-negative metric.</p>
<p><code>perCellQCFilters()</code> will also identify outliers for the proportion-based metrics specified in the sub.fields= arguments. These distributions frequently exhibit a heavy right tail, but unlike the two previous metrics, it is the right tail itself that contains the putative low-quality cells. Thus, we do not perform any transformation to shrink the tail - rather, our hope is that the cells in the tail are identified as large outliers.</p>
<p>A cell that is an outlier for any of these metrics is considered to be of low quality and discarded. This is captured in the discard column, which can be used for later filtering</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="scrna-seq-data-analysis-overview.html#cb147-1" tabindex="-1"></a><span class="do">## Identify cells that are outlier</span></span>
<span id="cb147-2"><a href="scrna-seq-data-analysis-overview.html#cb147-2" tabindex="-1"></a>reasons <span class="ot">&lt;-</span> <span class="fu">perCellQCFilters</span>(stats,</span>
<span id="cb147-3"><a href="scrna-seq-data-analysis-overview.html#cb147-3" tabindex="-1"></a>    <span class="at">sub.fields =</span> <span class="fu">c</span>(<span class="st">&quot;subsets_Mt_percent&quot;</span>, <span class="st">&quot;altexps_ERCC_percent&quot;</span>)</span>
<span id="cb147-4"><a href="scrna-seq-data-analysis-overview.html#cb147-4" tabindex="-1"></a>) <span class="co"># No transformation</span></span>
<span id="cb147-5"><a href="scrna-seq-data-analysis-overview.html#cb147-5" tabindex="-1"></a></span>
<span id="cb147-6"><a href="scrna-seq-data-analysis-overview.html#cb147-6" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">as.matrix</span>(reasons))</span>
<span id="cb147-7"><a href="scrna-seq-data-analysis-overview.html#cb147-7" tabindex="-1"></a><span class="co">#&gt;              low_lib_size            low_n_features   high_subsets_Mt_percent high_altexps_ERCC_percent </span></span>
<span id="cb147-8"><a href="scrna-seq-data-analysis-overview.html#cb147-8" tabindex="-1"></a><span class="co">#&gt;                         4                         0                         2                         1 </span></span>
<span id="cb147-9"><a href="scrna-seq-data-analysis-overview.html#cb147-9" tabindex="-1"></a><span class="co">#&gt;                   discard </span></span>
<span id="cb147-10"><a href="scrna-seq-data-analysis-overview.html#cb147-10" tabindex="-1"></a><span class="co">#&gt;                         6</span></span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="scrna-seq-data-analysis-overview.html#cb148-1" tabindex="-1"></a></span>
<span id="cb148-2"><a href="scrna-seq-data-analysis-overview.html#cb148-2" tabindex="-1"></a><span class="do">## Extract the exact filter thresholds</span></span>
<span id="cb148-3"><a href="scrna-seq-data-analysis-overview.html#cb148-3" tabindex="-1"></a><span class="fu">attr</span>(reasons<span class="sc">$</span>low_lib_size, <span class="st">&quot;thresholds&quot;</span>)</span>
<span id="cb148-4"><a href="scrna-seq-data-analysis-overview.html#cb148-4" tabindex="-1"></a><span class="co">#&gt;    lower   higher </span></span>
<span id="cb148-5"><a href="scrna-seq-data-analysis-overview.html#cb148-5" tabindex="-1"></a><span class="co">#&gt; 434082.9      Inf</span></span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="scrna-seq-data-analysis-overview.html#cb149-1" tabindex="-1"></a><span class="fu">attr</span>(reasons<span class="sc">$</span>low_n_features, <span class="st">&quot;thresholds&quot;</span>)</span>
<span id="cb149-2"><a href="scrna-seq-data-analysis-overview.html#cb149-2" tabindex="-1"></a><span class="co">#&gt;    lower   higher </span></span>
<span id="cb149-3"><a href="scrna-seq-data-analysis-overview.html#cb149-3" tabindex="-1"></a><span class="co">#&gt; 5231.468      Inf</span></span></code></pre></div>
<p>With this strategy, the thresholds adapt to both the location and spread of the distribution of values for a given metric. This allows the QC procedure to adjust to changes in sequencing depth, cDNA capture efficiency, mitochondrial content, etc. without requiring any user intervention or prior experience.
<strong>However, the underlying assumption of a high-quality majority may not always be appropriate</strong></p>
</div>
</div>
<div id="checking-diagnostic-plots" class="section level3 hasAnchor" number="11.4.3">
<h3><span class="header-section-number">11.4.3</span> Checking diagnostic plots<a href="scrna-seq-data-analysis-overview.html#checking-diagnostic-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is good practice to inspect the distributions of QC metrics to identify possible problems. In the most ideal case, we would see normal distributions that would justify the 3 MAD threshold used in outlier detection. A large proportion of cells in another mode suggests that the QC metrics might be correlated with some biological state, potentially leading to the loss of distinct cell types during filtering; or that there were inconsistencies with library preparation for a subset of cells, a not-uncommon phenomenon in plate-based protocols.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="scrna-seq-data-analysis-overview.html#cb150-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb150-2"><a href="scrna-seq-data-analysis-overview.html#cb150-2" tabindex="-1"></a></span>
<span id="cb150-3"><a href="scrna-seq-data-analysis-overview.html#cb150-3" tabindex="-1"></a><span class="do">## Add the information to the SCE columns</span></span>
<span id="cb150-4"><a href="scrna-seq-data-analysis-overview.html#cb150-4" tabindex="-1"></a><span class="fu">colData</span>(sce<span class="fl">.416</span>b) <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">colData</span>(sce<span class="fl">.416</span>b), stats)</span>
<span id="cb150-5"><a href="scrna-seq-data-analysis-overview.html#cb150-5" tabindex="-1"></a>sce<span class="fl">.416</span>b<span class="sc">$</span>block <span class="ot">&lt;-</span> <span class="fu">factor</span>(sce<span class="fl">.416</span>b<span class="sc">$</span>block)</span>
<span id="cb150-6"><a href="scrna-seq-data-analysis-overview.html#cb150-6" tabindex="-1"></a>sce<span class="fl">.416</span>b<span class="sc">$</span>phenotype <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;induced&quot;</span>, sce<span class="fl">.416</span>b<span class="sc">$</span>phenotype), <span class="st">&quot;induced&quot;</span>, <span class="st">&quot;wild type&quot;</span>)</span>
<span id="cb150-7"><a href="scrna-seq-data-analysis-overview.html#cb150-7" tabindex="-1"></a>sce<span class="fl">.416</span>b<span class="sc">$</span>discard <span class="ot">&lt;-</span> reasons<span class="sc">$</span>discard</span>
<span id="cb150-8"><a href="scrna-seq-data-analysis-overview.html#cb150-8" tabindex="-1"></a></span>
<span id="cb150-9"><a href="scrna-seq-data-analysis-overview.html#cb150-9" tabindex="-1"></a><span class="do">## Plot</span></span>
<span id="cb150-10"><a href="scrna-seq-data-analysis-overview.html#cb150-10" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb150-11"><a href="scrna-seq-data-analysis-overview.html#cb150-11" tabindex="-1"></a>    <span class="do">## Diccard low total counts</span></span>
<span id="cb150-12"><a href="scrna-seq-data-analysis-overview.html#cb150-12" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce<span class="fl">.416</span>b,</span>
<span id="cb150-13"><a href="scrna-seq-data-analysis-overview.html#cb150-13" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;block&quot;</span>, <span class="at">y =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;discard&quot;</span>,</span>
<span id="cb150-14"><a href="scrna-seq-data-analysis-overview.html#cb150-14" tabindex="-1"></a>        <span class="at">other_fields =</span> <span class="st">&quot;phenotype&quot;</span></span>
<span id="cb150-15"><a href="scrna-seq-data-analysis-overview.html#cb150-15" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>phenotype) <span class="sc">+</span></span>
<span id="cb150-16"><a href="scrna-seq-data-analysis-overview.html#cb150-16" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Total count&quot;</span>),</span>
<span id="cb150-17"><a href="scrna-seq-data-analysis-overview.html#cb150-17" tabindex="-1"></a>    <span class="do">## Discard low detected genes</span></span>
<span id="cb150-18"><a href="scrna-seq-data-analysis-overview.html#cb150-18" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce<span class="fl">.416</span>b,</span>
<span id="cb150-19"><a href="scrna-seq-data-analysis-overview.html#cb150-19" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;block&quot;</span>, <span class="at">y =</span> <span class="st">&quot;detected&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;discard&quot;</span>,</span>
<span id="cb150-20"><a href="scrna-seq-data-analysis-overview.html#cb150-20" tabindex="-1"></a>        <span class="at">other_fields =</span> <span class="st">&quot;phenotype&quot;</span></span>
<span id="cb150-21"><a href="scrna-seq-data-analysis-overview.html#cb150-21" tabindex="-1"></a>    ) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>phenotype) <span class="sc">+</span></span>
<span id="cb150-22"><a href="scrna-seq-data-analysis-overview.html#cb150-22" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Detected features&quot;</span>),</span>
<span id="cb150-23"><a href="scrna-seq-data-analysis-overview.html#cb150-23" tabindex="-1"></a>    <span class="do">## Discard high mitocondrial percentage</span></span>
<span id="cb150-24"><a href="scrna-seq-data-analysis-overview.html#cb150-24" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce<span class="fl">.416</span>b,</span>
<span id="cb150-25"><a href="scrna-seq-data-analysis-overview.html#cb150-25" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;block&quot;</span>, <span class="at">y =</span> <span class="st">&quot;subsets_Mito_percent&quot;</span>,</span>
<span id="cb150-26"><a href="scrna-seq-data-analysis-overview.html#cb150-26" tabindex="-1"></a>        <span class="at">colour_by =</span> <span class="st">&quot;discard&quot;</span>, <span class="at">other_fields =</span> <span class="st">&quot;phenotype&quot;</span></span>
<span id="cb150-27"><a href="scrna-seq-data-analysis-overview.html#cb150-27" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb150-28"><a href="scrna-seq-data-analysis-overview.html#cb150-28" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span>phenotype) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Mito percent&quot;</span>),</span>
<span id="cb150-29"><a href="scrna-seq-data-analysis-overview.html#cb150-29" tabindex="-1"></a>    <span class="do">## Discard high</span></span>
<span id="cb150-30"><a href="scrna-seq-data-analysis-overview.html#cb150-30" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce<span class="fl">.416</span>b,</span>
<span id="cb150-31"><a href="scrna-seq-data-analysis-overview.html#cb150-31" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;block&quot;</span>, <span class="at">y =</span> <span class="st">&quot;altexps_ERCC_percent&quot;</span>,</span>
<span id="cb150-32"><a href="scrna-seq-data-analysis-overview.html#cb150-32" tabindex="-1"></a>        <span class="at">colour_by =</span> <span class="st">&quot;discard&quot;</span>, <span class="at">other_fields =</span> <span class="st">&quot;phenotype&quot;</span></span>
<span id="cb150-33"><a href="scrna-seq-data-analysis-overview.html#cb150-33" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb150-34"><a href="scrna-seq-data-analysis-overview.html#cb150-34" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span>phenotype) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;ERCC percent&quot;</span>),</span>
<span id="cb150-35"><a href="scrna-seq-data-analysis-overview.html#cb150-35" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span></span>
<span id="cb150-36"><a href="scrna-seq-data-analysis-overview.html#cb150-36" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/QC_sce416b_plots-1.png" width="672" /></p>
<p>You can also create some plots via <code>iSEE</code> :)</p>
<style>
p.exercise  {
background-color: #E4EDE2;
padding: 9px;
border: 1px solid black;
border-radius: 10px;
font-family: sans-serif;
}
</style>
<p class="exercise">
<strong>Optional:</strong> Create at least 1 QC plot using iSEE. <em>Clue: Use the Column Data Plot 1 panel</em>
</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="scrna-seq-data-analysis-overview.html#cb151-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;iSEE&quot;</span>)</span>
<span id="cb151-2"><a href="scrna-seq-data-analysis-overview.html#cb151-2" tabindex="-1"></a><span class="fu">iSEE</span>(sce<span class="fl">.416</span>b)</span></code></pre></div>
</div>
<div id="removing-low-quality-cells" class="section level3 hasAnchor" number="11.4.4">
<h3><span class="header-section-number">11.4.4</span> Removing low-quality cells<a href="scrna-seq-data-analysis-overview.html#removing-low-quality-cells" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once low-quality cells have been identified, we can choose to either remove them or mark them. Removal is the most straightforward option and is achieved by subsetting the <code>SingleCellExperiment</code> by column. In this case, we use the previous low-quality calls to generate a subsetted <code>SingleCellExperiment</code> that we would use for downstream analyses.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="scrna-seq-data-analysis-overview.html#cb152-1" tabindex="-1"></a><span class="do">## Keep the columns we DON&#39;T want to discard.</span></span>
<span id="cb152-2"><a href="scrna-seq-data-analysis-overview.html#cb152-2" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> sce<span class="fl">.416</span>b[, <span class="sc">!</span>reasons<span class="sc">$</span>discard]</span></code></pre></div>
<p>Other option is to simply mark the low-quality cells as such and retain them in the downstream analysis.</p>
</div>
</div>
<div id="normalization" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Normalization<a href="scrna-seq-data-analysis-overview.html#normalization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Systematic differences in sequencing coverage between libraries are often observed in single-cell RNA sequencing data which typically arise from technical differences in cDNA capture or PCR amplification efficiency across cells, attributable to the difficulty of achieving consistent library preparation. Normalization aims to remove these differences such that they do not interfere with comparisons of the expression profiles between cells. This will ensure that any observed heterogeneity or differential expression within the cell population are driven by biology and not technical biases.</p>
<p>Let´s load before another dataset and review quickly what we have learned.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="scrna-seq-data-analysis-overview.html#cb153-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scRNAseq&quot;</span>)</span>
<span id="cb153-2"><a href="scrna-seq-data-analysis-overview.html#cb153-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb153-3"><a href="scrna-seq-data-analysis-overview.html#cb153-3" tabindex="-1"></a></span>
<span id="cb153-4"><a href="scrna-seq-data-analysis-overview.html#cb153-4" tabindex="-1"></a><span class="do">## Load dataset</span></span>
<span id="cb153-5"><a href="scrna-seq-data-analysis-overview.html#cb153-5" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">ZeiselBrainData</span>()</span>
<span id="cb153-6"><a href="scrna-seq-data-analysis-overview.html#cb153-6" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">aggregateAcrossFeatures</span>(sce.zeisel,</span>
<span id="cb153-7"><a href="scrna-seq-data-analysis-overview.html#cb153-7" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">sub</span>(<span class="st">&quot;_loc[0-9]+$&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">rownames</span>(sce.zeisel))</span>
<span id="cb153-8"><a href="scrna-seq-data-analysis-overview.html#cb153-8" tabindex="-1"></a>)</span>
<span id="cb153-9"><a href="scrna-seq-data-analysis-overview.html#cb153-9" tabindex="-1"></a><span class="do">## Compute perCellQCMetrics</span></span>
<span id="cb153-10"><a href="scrna-seq-data-analysis-overview.html#cb153-10" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">perCellQCMetrics</span>(sce.zeisel, <span class="at">subsets =</span> <span class="fu">list</span>(</span>
<span id="cb153-11"><a href="scrna-seq-data-analysis-overview.html#cb153-11" tabindex="-1"></a>    <span class="at">Mt =</span> <span class="fu">rowData</span>(sce.zeisel)<span class="sc">$</span>featureType <span class="sc">==</span> <span class="st">&quot;mito&quot;</span></span>
<span id="cb153-12"><a href="scrna-seq-data-analysis-overview.html#cb153-12" tabindex="-1"></a>))</span>
<span id="cb153-13"><a href="scrna-seq-data-analysis-overview.html#cb153-13" tabindex="-1"></a><span class="do">## Compute quickPerCellQC</span></span>
<span id="cb153-14"><a href="scrna-seq-data-analysis-overview.html#cb153-14" tabindex="-1"></a>qc <span class="ot">&lt;-</span> <span class="fu">quickPerCellQC</span>(stats, <span class="at">percent_subsets =</span> <span class="fu">c</span>(</span>
<span id="cb153-15"><a href="scrna-seq-data-analysis-overview.html#cb153-15" tabindex="-1"></a>    <span class="st">&quot;altexps_ERCC_percent&quot;</span>,</span>
<span id="cb153-16"><a href="scrna-seq-data-analysis-overview.html#cb153-16" tabindex="-1"></a>    <span class="st">&quot;subsets_Mt_percent&quot;</span></span>
<span id="cb153-17"><a href="scrna-seq-data-analysis-overview.html#cb153-17" tabindex="-1"></a>))</span>
<span id="cb153-18"><a href="scrna-seq-data-analysis-overview.html#cb153-18" tabindex="-1"></a><span class="do">## Discard low quality cells</span></span>
<span id="cb153-19"><a href="scrna-seq-data-analysis-overview.html#cb153-19" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> sce.zeisel[, <span class="sc">!</span>qc<span class="sc">$</span>discard]</span></code></pre></div>
<p><strong>Scaling normalization</strong></p>
<p>Scaling normalization is the simplest and most commonly used class of normalization strategies. This involves dividing all counts for each cell by a cell-specific scaling factor, often called a “size factor” (Anders and Huber 2010). The assumption here is that any cell-specific bias (e.g., in capture or amplification efficiency) affects all genes equally via scaling of the expected mean count for that cell. The size factor for each cell represents the estimate of the relative bias in that cell, so division of its counts by its size factor should remove that bias.</p>
<div id="library-size-normalization" class="section level3 hasAnchor" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> Library size normalization<a href="scrna-seq-data-analysis-overview.html#library-size-normalization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Library size normalization is the simplest strategy for performing scaling normalization. We define the library size as the total sum of counts across all genes for each cell, the expected value of which is assumed to scale with any cell-specific biases. The “library size factor” for each cell is then directly proportional to its library size where the proportionality constant is defined such that the mean size factor across all cells is equal to 1. This definition ensures that the normalized expression values are on the same scale as the original counts, which is useful for interpretation (especially when dealing with transformed data).</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="scrna-seq-data-analysis-overview.html#cb154-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb154-2"><a href="scrna-seq-data-analysis-overview.html#cb154-2" tabindex="-1"></a></span>
<span id="cb154-3"><a href="scrna-seq-data-analysis-overview.html#cb154-3" tabindex="-1"></a><span class="do">## Compute librarySizeFactors</span></span>
<span id="cb154-4"><a href="scrna-seq-data-analysis-overview.html#cb154-4" tabindex="-1"></a>lib.sf.zeisel <span class="ot">&lt;-</span> <span class="fu">librarySizeFactors</span>(sce.zeisel)</span>
<span id="cb154-5"><a href="scrna-seq-data-analysis-overview.html#cb154-5" tabindex="-1"></a><span class="fu">summary</span>(lib.sf.zeisel)</span>
<span id="cb154-6"><a href="scrna-seq-data-analysis-overview.html#cb154-6" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb154-7"><a href="scrna-seq-data-analysis-overview.html#cb154-7" tabindex="-1"></a><span class="co">#&gt;  0.1757  0.5680  0.8680  1.0000  1.2783  4.0839</span></span></code></pre></div>
<p>In the Zeisel brain data, the library size factors differ by up to 10-fold across cells. This is typical of the variability in coverage in scRNA-seq data.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="scrna-seq-data-analysis-overview.html#cb155-1" tabindex="-1"></a><span class="do">## Plot the library size factors differences</span></span>
<span id="cb155-2"><a href="scrna-seq-data-analysis-overview.html#cb155-2" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log10</span>(lib.sf.zeisel), <span class="at">xlab =</span> <span class="st">&quot;Log10[Size factor]&quot;</span>, <span class="at">col =</span> <span class="st">&quot;grey80&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/hist_libSizeFactors-1.png" width="672" /></p>
<p>Strictly speaking, the use of library size factors assumes that there is no “imbalance” in the differentially expressed (DE) genes between any pair of cells.</p>
<p>Although, in practice, normalization accuracy is not a major consideration for exploratory scRNA-seq data analyses. Composition biases do not usually affect the separation of clusters, only the magnitude - and to a lesser extent, direction - of the log-fold changes between clusters or cell types</p>
</div>
<div id="normalization-by-deconvolution" class="section level3 hasAnchor" number="11.5.2">
<h3><span class="header-section-number">11.5.2</span> Normalization by deconvolution<a href="scrna-seq-data-analysis-overview.html#normalization-by-deconvolution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>composition biases will be present when any unbalanced differential expression exists between samples. Consider the simple example of two cells where a single gene “X” is upregulated in one cell “A” compared to the other cell “B”. This upregulation means that either more sequencing resources are devoted to “X in”A”, thus decreasing coverage of all other non-DE genes when the total library size of each cell is experimentally fixed; or the library size of “A” increases when “X” is assigned more reads or UMIs.</p>
<p>The removal of composition biases is a well-studied problem for bulk RNA sequencing data analysis.
- <code>estimateSizeFactorsFromMatrix()</code> function in the <code>DESeq2</code> package (Anders and Huber 2010; Love, Huber, and Anders 2014)
- <code>calcNormFactors()</code>function in the <code>edgeR</code> package (Robinson and Oshlack 2010).</p>
<p>Single-cell data can be problematic for these bulk normalization methods due to the dominance of low and zero counts. To overcome this, we pool counts from many cells to increase the size of the counts for accurate size factor estimation (Lun, Bach, and Marioni 2016). Pool-based size factors are then “deconvolved” into cell-based factors for normalization of each cell’s expression profile. This is performed using the <code>calculateSumFactors()</code> function from <code>scran</code>.</p>
<p>First we have a pre-clustering step with <code>quickCluster()</code> where cells in each cluster are normalized separately and the size factors are rescaled to be comparable across clusters. This avoids the assumption that most genes are non-DE across the entire population - only a non-DE majority is required between pairs of clusters, which is a weaker assumption for highly heterogeneous populations.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="scrna-seq-data-analysis-overview.html#cb156-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb156-2"><a href="scrna-seq-data-analysis-overview.html#cb156-2" tabindex="-1"></a></span>
<span id="cb156-3"><a href="scrna-seq-data-analysis-overview.html#cb156-3" tabindex="-1"></a><span class="do">## Compute quickCluster + calculateSumFactor for deconvolution normalization</span></span>
<span id="cb156-4"><a href="scrna-seq-data-analysis-overview.html#cb156-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb156-5"><a href="scrna-seq-data-analysis-overview.html#cb156-5" tabindex="-1"></a>clust.zeisel <span class="ot">&lt;-</span> <span class="fu">quickCluster</span>(sce.zeisel)</span>
<span id="cb156-6"><a href="scrna-seq-data-analysis-overview.html#cb156-6" tabindex="-1"></a><span class="fu">table</span>(clust.zeisel)</span>
<span id="cb156-7"><a href="scrna-seq-data-analysis-overview.html#cb156-7" tabindex="-1"></a><span class="co">#&gt; clust.zeisel</span></span>
<span id="cb156-8"><a href="scrna-seq-data-analysis-overview.html#cb156-8" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14 </span></span>
<span id="cb156-9"><a href="scrna-seq-data-analysis-overview.html#cb156-9" tabindex="-1"></a><span class="co">#&gt; 170 254 441 178 393 148 219 240 189 123 112 103 135 111</span></span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="scrna-seq-data-analysis-overview.html#cb157-1" tabindex="-1"></a></span>
<span id="cb157-2"><a href="scrna-seq-data-analysis-overview.html#cb157-2" tabindex="-1"></a>deconv.sf.zeisel <span class="ot">&lt;-</span> <span class="fu">calculateSumFactors</span>(sce.zeisel, <span class="at">clusters =</span> clust.zeisel)</span>
<span id="cb157-3"><a href="scrna-seq-data-analysis-overview.html#cb157-3" tabindex="-1"></a><span class="fu">summary</span>(deconv.sf.zeisel)</span>
<span id="cb157-4"><a href="scrna-seq-data-analysis-overview.html#cb157-4" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb157-5"><a href="scrna-seq-data-analysis-overview.html#cb157-5" tabindex="-1"></a><span class="co">#&gt;  0.1186  0.4860  0.8314  1.0000  1.3209  4.5090</span></span></code></pre></div>
</div>
<div id="normalization-by-spike-ins" class="section level3 hasAnchor" number="11.5.3">
<h3><span class="header-section-number">11.5.3</span> Normalization by spike-ins<a href="scrna-seq-data-analysis-overview.html#normalization-by-spike-ins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Spike-in normalization is based on the assumption that the same amount of spike-in RNA was added to each cell, so, systematic differences in the coverage of the spike-in transcripts can only be due to cell-specific biases, e.g., in capture efficiency or sequencing depth. To remove these biases, we equalize spike-in coverage across cells by scaling with “spike-in size factors”.</p>
<p>Compared to the previous methods, <strong>spike-in normalization requires no assumption about the biology of the system.</strong> Practically, spike-in normalization should be used if differences in the total RNA content of individual cells are of interest and must be preserved in downstream analyses.</p>
<p>To demonstrate the use of spike-in normalization on a different dataset involving T cell activation after stimulation with T cell receptor ligands of varying affinity (Richard et al. 2018).</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="scrna-seq-data-analysis-overview.html#cb158-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scRNAseq&quot;</span>)</span>
<span id="cb158-2"><a href="scrna-seq-data-analysis-overview.html#cb158-2" tabindex="-1"></a>sce.richard <span class="ot">&lt;-</span> <span class="fu">RichardTCellData</span>()</span>
<span id="cb158-3"><a href="scrna-seq-data-analysis-overview.html#cb158-3" tabindex="-1"></a><span class="co">#&gt; loading from cache</span></span></code></pre></div>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="scrna-seq-data-analysis-overview.html#cb159-1" tabindex="-1"></a>sce.richard <span class="ot">&lt;-</span> sce.richard[, sce.richard<span class="sc">$</span><span class="st">`</span><span class="at">single cell quality</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;OK&quot;</span>]</span>
<span id="cb159-2"><a href="scrna-seq-data-analysis-overview.html#cb159-2" tabindex="-1"></a>sce.richard</span>
<span id="cb159-3"><a href="scrna-seq-data-analysis-overview.html#cb159-3" tabindex="-1"></a><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span id="cb159-4"><a href="scrna-seq-data-analysis-overview.html#cb159-4" tabindex="-1"></a><span class="co">#&gt; dim: 46603 528 </span></span>
<span id="cb159-5"><a href="scrna-seq-data-analysis-overview.html#cb159-5" tabindex="-1"></a><span class="co">#&gt; metadata(0):</span></span>
<span id="cb159-6"><a href="scrna-seq-data-analysis-overview.html#cb159-6" tabindex="-1"></a><span class="co">#&gt; assays(1): counts</span></span>
<span id="cb159-7"><a href="scrna-seq-data-analysis-overview.html#cb159-7" tabindex="-1"></a><span class="co">#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ... ENSMUSG00000096730 ENSMUSG00000095742</span></span>
<span id="cb159-8"><a href="scrna-seq-data-analysis-overview.html#cb159-8" tabindex="-1"></a><span class="co">#&gt; rowData names(0):</span></span>
<span id="cb159-9"><a href="scrna-seq-data-analysis-overview.html#cb159-9" tabindex="-1"></a><span class="co">#&gt; colnames(528): SLX-12611.N701_S502. SLX-12611.N702_S502. ... SLX-12612.i712_i522. SLX-12612.i714_i522.</span></span>
<span id="cb159-10"><a href="scrna-seq-data-analysis-overview.html#cb159-10" tabindex="-1"></a><span class="co">#&gt; colData names(13): age individual ... stimulus time</span></span>
<span id="cb159-11"><a href="scrna-seq-data-analysis-overview.html#cb159-11" tabindex="-1"></a><span class="co">#&gt; reducedDimNames(0):</span></span>
<span id="cb159-12"><a href="scrna-seq-data-analysis-overview.html#cb159-12" tabindex="-1"></a><span class="co">#&gt; mainExpName: endogenous</span></span>
<span id="cb159-13"><a href="scrna-seq-data-analysis-overview.html#cb159-13" tabindex="-1"></a><span class="co">#&gt; altExpNames(1): ERCC</span></span></code></pre></div>
<p>We apply the <code>computeSpikeFactors()</code> method to estimate spike-in size factors for all cells. This is defined by converting the total spike-in count per cell into a size factor, using the same reasoning as in <code>librarySizeFactors()</code>.
(Scaling will subsequently remove any differences in spike-in coverage across cells).</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="scrna-seq-data-analysis-overview.html#cb160-1" tabindex="-1"></a><span class="do">## computeSpikeFactors() to estimate spike-in size factors</span></span>
<span id="cb160-2"><a href="scrna-seq-data-analysis-overview.html#cb160-2" tabindex="-1"></a>sce.richard <span class="ot">&lt;-</span> <span class="fu">computeSpikeFactors</span>(sce.richard, <span class="st">&quot;ERCC&quot;</span>)</span>
<span id="cb160-3"><a href="scrna-seq-data-analysis-overview.html#cb160-3" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sizeFactors</span>(sce.richard))</span>
<span id="cb160-4"><a href="scrna-seq-data-analysis-overview.html#cb160-4" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb160-5"><a href="scrna-seq-data-analysis-overview.html#cb160-5" tabindex="-1"></a><span class="co">#&gt;  0.1247  0.4282  0.6274  1.0000  1.0699 23.3161</span></span></code></pre></div>
</div>
<div id="scaling-and-log-transforming" class="section level3 hasAnchor" number="11.5.4">
<h3><span class="header-section-number">11.5.4</span> Scaling and log-transforming<a href="scrna-seq-data-analysis-overview.html#scaling-and-log-transforming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once we have computed the size factors, we use the <code>logNormCounts()</code> function from <code>scater</code> to compute normalized expression values for each cell. This is done by dividing the count for each gene/spike-in transcript with the appropriate size factor for that cell. The function also log-transforms the normalized values, creating a new assay called <code>"logcounts"</code>. (Technically, these are “log-transformed normalized expression values”).</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="scrna-seq-data-analysis-overview.html#cb161-1" tabindex="-1"></a><span class="do">## Compute normalized expression values and log-transformation</span></span>
<span id="cb161-2"><a href="scrna-seq-data-analysis-overview.html#cb161-2" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">logNormCounts</span>(sce.zeisel)</span>
<span id="cb161-3"><a href="scrna-seq-data-analysis-overview.html#cb161-3" tabindex="-1"></a></span>
<span id="cb161-4"><a href="scrna-seq-data-analysis-overview.html#cb161-4" tabindex="-1"></a><span class="fu">assayNames</span>(sce.zeisel)</span>
<span id="cb161-5"><a href="scrna-seq-data-analysis-overview.html#cb161-5" tabindex="-1"></a><span class="co">#&gt; [1] &quot;counts&quot;    &quot;logcounts&quot;</span></span></code></pre></div>
<p>The log-transformation is useful as differences in the log-values represent log-fold changes in expression.</p>
<p>By operating on log-transformed data, we ensure that these procedures are measuring distances between cells based on log-fold changes in expression. Log-transformation focuses on the former by promoting contributions from genes with strong relative differences.</p>
</div>
</div>
<div id="feature-selection" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Feature selection<a href="scrna-seq-data-analysis-overview.html#feature-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>highly variable genes (HVGs)</strong></p>
<p>We often use scRNA-seq data in exploratory analyses to characterize heterogeneity across cells. Procedures like clustering and dimensionality reduction compare cells based on their gene expression profiles, which involves aggregating per-gene differences into a single (dis)similarity metric between a pair of cells. The choice of genes to use in this calculation has a major impact on the behavior of the metric and the performance of downstream methods. We want to select genes that contain useful information about the biology of the system while removing genes that contain random noise. This aims to preserve interesting biological structure without the variance that obscures that structure, and to reduce the size of the data to improve computational efficiency of later steps.</p>
<p>The simplest approach to feature selection is to <strong>select the most variable genes based on their expression across the population</strong>. This assumes that genuine biological differences will manifest as increased variation in the affected genes, compared to other genes that are only affected by technical noise or a baseline level of “uninteresting” biological variation.</p>
<div id="quantifying-per-gene-variation" class="section level3 hasAnchor" number="11.6.1">
<h3><span class="header-section-number">11.6.1</span> Quantifying per-gene variation<a href="scrna-seq-data-analysis-overview.html#quantifying-per-gene-variation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest approach to quantifying per-gene variation is to compute the variance of the log-normalized expression values (“log-counts”) for each gene across all cells (A. T. L. Lun, McCarthy, and Marioni 2016). The advantage of this approach is that the feature selection is based on the same log-values that are used for later downstream steps. In particular, genes with the largest variances in log-values will contribute most to the Euclidean distances between cells during procedures like clustering and dimensionality reduction. By using log-values here, we ensure that our quantitative definition of heterogeneity is consistent throughout the entire analysis.</p>
<p>Calculation of the per-gene variance is simple, but feature selection requires modelling of the mean-variance relationship. The log-transformation is not a variance stabilizing transformation in most cases, which means that the total variance of a gene is driven more by its abundance than its underlying biological heterogeneity. To account for this effect, we use the <code>modelGeneVar()</code> function to fit a trend to the variance with respect to abundance across all genes (Figure 3.1).</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="scrna-seq-data-analysis-overview.html#cb162-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb162-2"><a href="scrna-seq-data-analysis-overview.html#cb162-2" tabindex="-1"></a></span>
<span id="cb162-3"><a href="scrna-seq-data-analysis-overview.html#cb162-3" tabindex="-1"></a><span class="do">## Model the mean-variance relationship</span></span>
<span id="cb162-4"><a href="scrna-seq-data-analysis-overview.html#cb162-4" tabindex="-1"></a>dec.zeisel <span class="ot">&lt;-</span> <span class="fu">modelGeneVar</span>(sce.zeisel)</span>
<span id="cb162-5"><a href="scrna-seq-data-analysis-overview.html#cb162-5" tabindex="-1"></a></span>
<span id="cb162-6"><a href="scrna-seq-data-analysis-overview.html#cb162-6" tabindex="-1"></a><span class="do">## Plot the fit</span></span>
<span id="cb162-7"><a href="scrna-seq-data-analysis-overview.html#cb162-7" tabindex="-1"></a>fit.zeisel <span class="ot">&lt;-</span> <span class="fu">metadata</span>(dec.zeisel)</span>
<span id="cb162-8"><a href="scrna-seq-data-analysis-overview.html#cb162-8" tabindex="-1"></a><span class="fu">plot</span>(fit.zeisel<span class="sc">$</span>mean, fit.zeisel<span class="sc">$</span>var,</span>
<span id="cb162-9"><a href="scrna-seq-data-analysis-overview.html#cb162-9" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb162-10"><a href="scrna-seq-data-analysis-overview.html#cb162-10" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Variance of log-expression&quot;</span></span>
<span id="cb162-11"><a href="scrna-seq-data-analysis-overview.html#cb162-11" tabindex="-1"></a>)</span>
<span id="cb162-12"><a href="scrna-seq-data-analysis-overview.html#cb162-12" tabindex="-1"></a><span class="fu">curve</span>(fit.zeisel<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/modelGeneVar_zeisel-1.png" width="672" /></p>
<p><em>At any given abundance, we assume that the variation in expression for most genes is driven by uninteresting processes like sampling noise. Under this assumption, the fitted value of the trend at any given gene’s abundance represents an estimate of its uninteresting variation, which we call the technical component. We then define the biological component for each gene as the difference between its total variance and the technical component. This biological component represents the “interesting” variation for each gene and can be used as the metric for HVG selection.</em></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="scrna-seq-data-analysis-overview.html#cb163-1" tabindex="-1"></a><span class="do">## Order by most interesting genes for inspection</span></span>
<span id="cb163-2"><a href="scrna-seq-data-analysis-overview.html#cb163-2" tabindex="-1"></a>dec.zeisel[<span class="fu">order</span>(dec.zeisel<span class="sc">$</span>bio, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb163-3"><a href="scrna-seq-data-analysis-overview.html#cb163-3" tabindex="-1"></a><span class="co">#&gt; DataFrame with 19839 rows and 6 columns</span></span>
<span id="cb163-4"><a href="scrna-seq-data-analysis-overview.html#cb163-4" tabindex="-1"></a><span class="co">#&gt;               mean     total      tech       bio      p.value          FDR</span></span>
<span id="cb163-5"><a href="scrna-seq-data-analysis-overview.html#cb163-5" tabindex="-1"></a><span class="co">#&gt;          &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;</span></span>
<span id="cb163-6"><a href="scrna-seq-data-analysis-overview.html#cb163-6" tabindex="-1"></a><span class="co">#&gt; Plp1       3.86637  15.44422   1.52686  13.91736  0.00000e+00  0.00000e+00</span></span>
<span id="cb163-7"><a href="scrna-seq-data-analysis-overview.html#cb163-7" tabindex="-1"></a><span class="co">#&gt; Trf        2.27790   9.95350   1.42611   8.52739 7.65644e-200 7.59060e-196</span></span>
<span id="cb163-8"><a href="scrna-seq-data-analysis-overview.html#cb163-8" tabindex="-1"></a><span class="co">#&gt; Mal        2.30761   9.19548   1.42963   7.76586 2.43043e-165 1.60635e-161</span></span>
<span id="cb163-9"><a href="scrna-seq-data-analysis-overview.html#cb163-9" tabindex="-1"></a><span class="co">#&gt; Apod       1.89630   7.78119   1.36339   6.41780 9.80407e-125 4.85988e-121</span></span>
<span id="cb163-10"><a href="scrna-seq-data-analysis-overview.html#cb163-10" tabindex="-1"></a><span class="co">#&gt; Mog        1.84701   7.30188   1.35204   5.94985 2.65362e-109 8.76934e-106</span></span>
<span id="cb163-11"><a href="scrna-seq-data-analysis-overview.html#cb163-11" tabindex="-1"></a><span class="co">#&gt; ...            ...       ...       ...       ...          ...          ...</span></span>
<span id="cb163-12"><a href="scrna-seq-data-analysis-overview.html#cb163-12" tabindex="-1"></a><span class="co">#&gt; Ddx5       3.71905  0.762844   1.54756 -0.784711     0.994702     0.997822</span></span>
<span id="cb163-13"><a href="scrna-seq-data-analysis-overview.html#cb163-13" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 4 rows ]</span></span></code></pre></div>
</div>
<div id="quantifying-technical-noise-spike-ins" class="section level3 hasAnchor" number="11.6.2">
<h3><span class="header-section-number">11.6.2</span> Quantifying technical noise (spike-ins)<a href="scrna-seq-data-analysis-overview.html#quantifying-technical-noise-spike-ins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The assumptions made by quantifying per-gene variation may be problematic in rare scenarios where many genes at a particular abundance are affected by a biological process. For example, strong upregulation of cell type-specific genes may result in an enrichment of HVGs at high abundances. This would inflate the fitted trend in that abundance interval and compromise the detection of the relevant genes.</p>
<p>We can avoid this problem by fitting a mean-dependent trend to the variance of the spike-in transcripts, if they are available. The premise here is that spike-ins should not be affected by biological variation, so the fitted value of the spike-in trend should represent a better estimate of the technical component for each gene.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="scrna-seq-data-analysis-overview.html#cb164-1" tabindex="-1"></a><span class="do">## Fit a mean-dependent trend to the variance of the spike-in transcripts</span></span>
<span id="cb164-2"><a href="scrna-seq-data-analysis-overview.html#cb164-2" tabindex="-1"></a>dec.spike<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">modelGeneVarWithSpikes</span>(sce<span class="fl">.416</span>b, <span class="st">&quot;ERCC&quot;</span>)</span>
<span id="cb164-3"><a href="scrna-seq-data-analysis-overview.html#cb164-3" tabindex="-1"></a><span class="do">## Order by most interesting genes for inspection</span></span>
<span id="cb164-4"><a href="scrna-seq-data-analysis-overview.html#cb164-4" tabindex="-1"></a>dec.spike<span class="fl">.416</span>b[<span class="fu">order</span>(dec.spike<span class="fl">.416</span>b<span class="sc">$</span>bio, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb164-5"><a href="scrna-seq-data-analysis-overview.html#cb164-5" tabindex="-1"></a><span class="co">#&gt; DataFrame with 46604 rows and 6 columns</span></span>
<span id="cb164-6"><a href="scrna-seq-data-analysis-overview.html#cb164-6" tabindex="-1"></a><span class="co">#&gt;               mean     total      tech       bio      p.value          FDR</span></span>
<span id="cb164-7"><a href="scrna-seq-data-analysis-overview.html#cb164-7" tabindex="-1"></a><span class="co">#&gt;          &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;</span></span>
<span id="cb164-8"><a href="scrna-seq-data-analysis-overview.html#cb164-8" tabindex="-1"></a><span class="co">#&gt; Lyz2       6.53871   13.5804   1.61389   11.9665 3.42011e-189 2.91162e-186</span></span>
<span id="cb164-9"><a href="scrna-seq-data-analysis-overview.html#cb164-9" tabindex="-1"></a><span class="co">#&gt; Top2a      5.78145   14.2104   2.56868   11.6418  4.26367e-72  1.20992e-69</span></span>
<span id="cb164-10"><a href="scrna-seq-data-analysis-overview.html#cb164-10" tabindex="-1"></a><span class="co">#&gt; Ccnb2      5.89731   13.6178   2.39162   11.2262  3.53970e-77  1.09579e-74</span></span>
<span id="cb164-11"><a href="scrna-seq-data-analysis-overview.html#cb164-11" tabindex="-1"></a><span class="co">#&gt; Ccl9       6.70039   12.4793   1.44789   11.0314 1.27204e-199 1.26341e-196</span></span>
<span id="cb164-12"><a href="scrna-seq-data-analysis-overview.html#cb164-12" tabindex="-1"></a><span class="co">#&gt; Hbb-bt     4.95051   15.0336   4.02525   11.0083  1.50804e-27  1.03594e-25</span></span>
<span id="cb164-13"><a href="scrna-seq-data-analysis-overview.html#cb164-13" tabindex="-1"></a><span class="co">#&gt; ...            ...       ...       ...       ...          ...          ...</span></span>
<span id="cb164-14"><a href="scrna-seq-data-analysis-overview.html#cb164-14" tabindex="-1"></a><span class="co">#&gt; Rpl5-ps2   3.50523  0.831793   6.43592  -5.60413     0.999712     0.999857</span></span>
<span id="cb164-15"><a href="scrna-seq-data-analysis-overview.html#cb164-15" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 4 rows ]</span></span></code></pre></div>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="scrna-seq-data-analysis-overview.html#cb165-1" tabindex="-1"></a></span>
<span id="cb165-2"><a href="scrna-seq-data-analysis-overview.html#cb165-2" tabindex="-1"></a><span class="do">## Plot the fit</span></span>
<span id="cb165-3"><a href="scrna-seq-data-analysis-overview.html#cb165-3" tabindex="-1"></a><span class="fu">plot</span>(dec.spike<span class="fl">.416</span>b<span class="sc">$</span>mean, dec.spike<span class="fl">.416</span>b<span class="sc">$</span>total,</span>
<span id="cb165-4"><a href="scrna-seq-data-analysis-overview.html#cb165-4" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb165-5"><a href="scrna-seq-data-analysis-overview.html#cb165-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Variance of log-expression&quot;</span></span>
<span id="cb165-6"><a href="scrna-seq-data-analysis-overview.html#cb165-6" tabindex="-1"></a>)</span>
<span id="cb165-7"><a href="scrna-seq-data-analysis-overview.html#cb165-7" tabindex="-1"></a>fit.spike<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">metadata</span>(dec.spike<span class="fl">.416</span>b)</span>
<span id="cb165-8"><a href="scrna-seq-data-analysis-overview.html#cb165-8" tabindex="-1"></a><span class="fu">points</span>(fit.spike<span class="fl">.416</span>b<span class="sc">$</span>mean, fit.spike<span class="fl">.416</span>b<span class="sc">$</span>var, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb165-9"><a href="scrna-seq-data-analysis-overview.html#cb165-9" tabindex="-1"></a><span class="fu">curve</span>(fit.spike<span class="fl">.416</span>b<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/modelGeneVarWithSpikes_416b-1.png" width="672" /></p>
</div>
<div id="quantifying-technical-noise-mean-variance-trend" class="section level3 hasAnchor" number="11.6.3">
<h3><span class="header-section-number">11.6.3</span> Quantifying technical noise (mean-variance trend)<a href="scrna-seq-data-analysis-overview.html#quantifying-technical-noise-mean-variance-trend" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the absence of spike-in data, one can attempt to create a trend by making some distributional assumptions about the noise. For example, UMI counts typically exhibit near-Poisson variation if we only consider technical noise from library preparation and sequencing. This can be used to construct a mean-variance trend in the log-counts with the <code>modelGeneVarByPoisson()</code> function.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="scrna-seq-data-analysis-overview.html#cb166-1" tabindex="-1"></a><span class="do">## construct a mean-variance trend in the log-counts</span></span>
<span id="cb166-2"><a href="scrna-seq-data-analysis-overview.html#cb166-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0010101</span>)</span>
<span id="cb166-3"><a href="scrna-seq-data-analysis-overview.html#cb166-3" tabindex="-1"></a>dec.pois.zeisel <span class="ot">&lt;-</span> <span class="fu">modelGeneVarByPoisson</span>(sce.zeisel)</span>
<span id="cb166-4"><a href="scrna-seq-data-analysis-overview.html#cb166-4" tabindex="-1"></a></span>
<span id="cb166-5"><a href="scrna-seq-data-analysis-overview.html#cb166-5" tabindex="-1"></a><span class="do">## Order by most interesting genes for inspection</span></span>
<span id="cb166-6"><a href="scrna-seq-data-analysis-overview.html#cb166-6" tabindex="-1"></a>dec.pois.zeisel <span class="ot">&lt;-</span> dec.pois.zeisel[<span class="fu">order</span>(dec.pois.zeisel<span class="sc">$</span>bio, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb166-7"><a href="scrna-seq-data-analysis-overview.html#cb166-7" tabindex="-1"></a><span class="fu">head</span>(dec.pois.zeisel)</span>
<span id="cb166-8"><a href="scrna-seq-data-analysis-overview.html#cb166-8" tabindex="-1"></a><span class="co">#&gt; DataFrame with 6 rows and 6 columns</span></span>
<span id="cb166-9"><a href="scrna-seq-data-analysis-overview.html#cb166-9" tabindex="-1"></a><span class="co">#&gt;           mean     total      tech       bio   p.value       FDR</span></span>
<span id="cb166-10"><a href="scrna-seq-data-analysis-overview.html#cb166-10" tabindex="-1"></a><span class="co">#&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span id="cb166-11"><a href="scrna-seq-data-analysis-overview.html#cb166-11" tabindex="-1"></a><span class="co">#&gt; Plp1   3.86637  15.44422  0.226375  15.21785         0         0</span></span>
<span id="cb166-12"><a href="scrna-seq-data-analysis-overview.html#cb166-12" tabindex="-1"></a><span class="co">#&gt; Trf    2.27790   9.95350  0.635655   9.31785         0         0</span></span>
<span id="cb166-13"><a href="scrna-seq-data-analysis-overview.html#cb166-13" tabindex="-1"></a><span class="co">#&gt; Mal    2.30761   9.19548  0.626251   8.56923         0         0</span></span>
<span id="cb166-14"><a href="scrna-seq-data-analysis-overview.html#cb166-14" tabindex="-1"></a><span class="co">#&gt; Apod   1.89630   7.78119  0.748055   7.03313         0         0</span></span>
<span id="cb166-15"><a href="scrna-seq-data-analysis-overview.html#cb166-15" tabindex="-1"></a><span class="co">#&gt; Mog    1.84701   7.30188  0.760426   6.54146         0         0</span></span>
<span id="cb166-16"><a href="scrna-seq-data-analysis-overview.html#cb166-16" tabindex="-1"></a><span class="co">#&gt; Mbp    2.20638   6.74997  0.658112   6.09186         0         0</span></span></code></pre></div>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="scrna-seq-data-analysis-overview.html#cb167-1" tabindex="-1"></a></span>
<span id="cb167-2"><a href="scrna-seq-data-analysis-overview.html#cb167-2" tabindex="-1"></a><span class="do">## Plot the fit</span></span>
<span id="cb167-3"><a href="scrna-seq-data-analysis-overview.html#cb167-3" tabindex="-1"></a><span class="fu">plot</span>(dec.pois.zeisel<span class="sc">$</span>mean, dec.pois.zeisel<span class="sc">$</span>total,</span>
<span id="cb167-4"><a href="scrna-seq-data-analysis-overview.html#cb167-4" tabindex="-1"></a>    <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean of log-expression&quot;</span>,</span>
<span id="cb167-5"><a href="scrna-seq-data-analysis-overview.html#cb167-5" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">&quot;Variance of log-expression&quot;</span></span>
<span id="cb167-6"><a href="scrna-seq-data-analysis-overview.html#cb167-6" tabindex="-1"></a>)</span>
<span id="cb167-7"><a href="scrna-seq-data-analysis-overview.html#cb167-7" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">metadata</span>(dec.pois.zeisel)<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/modelGeneVarByPoisson_zeisel-1.png" width="672" /></p>
<p><em>Trends based purely on technical noise tend to yield large biological components for highly-expressed genes</em>. This often includes so-called “house-keeping” genes coding for essential cellular components such as ribosomal proteins, which are considered uninteresting for characterizing cellular heterogeneity. These observations suggest that a more accurate noise model does not necessarily yield a better ranking of HVGs.
<strong>Though, one should keep an open mind that house-keeping genes are regularly DE in a variety of conditions</strong></p>
</div>
<div id="handling-batch-effects" class="section level3 hasAnchor" number="11.6.4">
<h3><span class="header-section-number">11.6.4</span> Handling batch effects<a href="scrna-seq-data-analysis-overview.html#handling-batch-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Data containing multiple batches will often exhibit batch effects. We are usually not interested in HVGs that are driven by batch effects; instead, we want to focus on genes that are highly variable within each batch.</p>
<p>This is naturally achieved by performing trend fitting and variance decomposition separately for each batch.</p>
<p>We will try now this approach by treating each plate (block) in the 416B dataset as a different batch, using the <code>modelGeneVarWithSpikes()</code> function. (The same argument is available in all other variance-modelling functions.)</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="scrna-seq-data-analysis-overview.html#cb168-1" tabindex="-1"></a><span class="do">## Fit a mean-dependent trend to the variance of the spike-in transcripts</span></span>
<span id="cb168-2"><a href="scrna-seq-data-analysis-overview.html#cb168-2" tabindex="-1"></a><span class="do">## Independently for each batch (block)</span></span>
<span id="cb168-3"><a href="scrna-seq-data-analysis-overview.html#cb168-3" tabindex="-1"></a>dec.block<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">modelGeneVarWithSpikes</span>(sce<span class="fl">.416</span>b, <span class="st">&quot;ERCC&quot;</span>, <span class="at">block =</span> sce<span class="fl">.416</span>b<span class="sc">$</span>block) <span class="co"># block=sce.416b$block</span></span>
<span id="cb168-4"><a href="scrna-seq-data-analysis-overview.html#cb168-4" tabindex="-1"></a><span class="fu">head</span>(dec.block<span class="fl">.416</span>b[<span class="fu">order</span>(dec.block<span class="fl">.416</span>b<span class="sc">$</span>bio, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb168-5"><a href="scrna-seq-data-analysis-overview.html#cb168-5" tabindex="-1"></a><span class="co">#&gt; DataFrame with 6 rows and 6 columns</span></span>
<span id="cb168-6"><a href="scrna-seq-data-analysis-overview.html#cb168-6" tabindex="-1"></a><span class="co">#&gt;              mean     total      tech       bio      p.value          FDR</span></span>
<span id="cb168-7"><a href="scrna-seq-data-analysis-overview.html#cb168-7" tabindex="-1"></a><span class="co">#&gt;         &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;</span></span>
<span id="cb168-8"><a href="scrna-seq-data-analysis-overview.html#cb168-8" tabindex="-1"></a><span class="co">#&gt; Lyz2      6.53871   13.5779   1.63259   11.9453  0.00000e+00  0.00000e+00</span></span>
<span id="cb168-9"><a href="scrna-seq-data-analysis-overview.html#cb168-9" tabindex="-1"></a><span class="co">#&gt; Top2a     5.78145   13.9852   2.77254   11.2126 6.95319e-238 2.07179e-235</span></span>
<span id="cb168-10"><a href="scrna-seq-data-analysis-overview.html#cb168-10" tabindex="-1"></a><span class="co">#&gt; Ccl9      6.70039   12.5449   1.40416   11.1408  0.00000e+00  0.00000e+00</span></span>
<span id="cb168-11"><a href="scrna-seq-data-analysis-overview.html#cb168-11" tabindex="-1"></a><span class="co">#&gt; Hbb-bt    4.95051   15.0506   4.07362   10.9770  7.34341e-90  5.66488e-88</span></span>
<span id="cb168-12"><a href="scrna-seq-data-analysis-overview.html#cb168-12" tabindex="-1"></a><span class="co">#&gt; Ccnb2     5.89731   13.3673   2.60730   10.7600 1.02751e-282 3.88775e-280</span></span>
<span id="cb168-13"><a href="scrna-seq-data-analysis-overview.html#cb168-13" tabindex="-1"></a><span class="co">#&gt; Cd200r3   4.81056   14.9435   4.31950   10.6240  8.48013e-76  5.20981e-74</span></span></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="scrna-seq-data-analysis-overview.html#cb169-1" tabindex="-1"></a></span>
<span id="cb169-2"><a href="scrna-seq-data-analysis-overview.html#cb169-2" tabindex="-1"></a><span class="do">## Plot the fit by batch (block)</span></span>
<span id="cb169-3"><a href="scrna-seq-data-analysis-overview.html#cb169-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb169-4"><a href="scrna-seq-data-analysis-overview.html#cb169-4" tabindex="-1"></a>blocked.stats <span class="ot">&lt;-</span> dec.block<span class="fl">.416</span>b<span class="sc">$</span>per.block</span>
<span id="cb169-5"><a href="scrna-seq-data-analysis-overview.html#cb169-5" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(blocked.stats)) {</span>
<span id="cb169-6"><a href="scrna-seq-data-analysis-overview.html#cb169-6" tabindex="-1"></a>    current <span class="ot">&lt;-</span> blocked.stats[[i]]</span>
<span id="cb169-7"><a href="scrna-seq-data-analysis-overview.html#cb169-7" tabindex="-1"></a>    <span class="fu">plot</span>(current<span class="sc">$</span>mean, current<span class="sc">$</span>total,</span>
<span id="cb169-8"><a href="scrna-seq-data-analysis-overview.html#cb169-8" tabindex="-1"></a>        <span class="at">main =</span> i, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.5</span>,</span>
<span id="cb169-9"><a href="scrna-seq-data-analysis-overview.html#cb169-9" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Mean of log-expression&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Variance of log-expression&quot;</span></span>
<span id="cb169-10"><a href="scrna-seq-data-analysis-overview.html#cb169-10" tabindex="-1"></a>    )</span>
<span id="cb169-11"><a href="scrna-seq-data-analysis-overview.html#cb169-11" tabindex="-1"></a>    curfit <span class="ot">&lt;-</span> <span class="fu">metadata</span>(current)</span>
<span id="cb169-12"><a href="scrna-seq-data-analysis-overview.html#cb169-12" tabindex="-1"></a>    <span class="fu">points</span>(curfit<span class="sc">$</span>mean, curfit<span class="sc">$</span>var, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb169-13"><a href="scrna-seq-data-analysis-overview.html#cb169-13" tabindex="-1"></a>    <span class="fu">curve</span>(curfit<span class="sc">$</span><span class="fu">trend</span>(x), <span class="at">col =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb169-14"><a href="scrna-seq-data-analysis-overview.html#cb169-14" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/modelGeneVar_batch-1.png" width="672" /></p>
<p>The use of a batch-specific trend fit is useful as it accommodates differences in the mean-variance trends between batches. This is especially important if batches exhibit systematic technical differences, e.g., differences in coverage or in the amount of spike-in RNA added.</p>
</div>
<div id="selecting-highly-variable-genes" class="section level3 hasAnchor" number="11.6.5">
<h3><span class="header-section-number">11.6.5</span> Selecting highly variable genes<a href="scrna-seq-data-analysis-overview.html#selecting-highly-variable-genes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once we have quantified the per-gene variation, the next step is to select the subset of HVGs to use in downstream analyses. A larger subset will reduce the risk of discarding interesting biological signal by retaining more potentially relevant genes, at the cost of increasing noise from irrelevant genes that might obscure said signal. It is difficult to determine the optimal trade-off for any given application as noise in one context may be useful signal in another.</p>
<p>The most obvious selection strategy is to take the top “n” genes with the largest values for the relevant variance metric. The main advantage of this approach is that the user can directly control the number of genes retained, which ensures that the computational complexity of downstream calculations is easily predicted. For <code>modelGeneVar()</code> and <code>modelGeneVarWithSpikes()</code>, we would select the genes with the largest biological components.</p>
<p>This is conveniently done for us via <code>getTopHVgs()</code>, as shown with <code>n = 1000</code>.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="scrna-seq-data-analysis-overview.html#cb170-1" tabindex="-1"></a><span class="do">## Top 1000 genes</span></span>
<span id="cb170-2"><a href="scrna-seq-data-analysis-overview.html#cb170-2" tabindex="-1"></a>hvg.zeisel.var <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(dec.zeisel, <span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb170-3"><a href="scrna-seq-data-analysis-overview.html#cb170-3" tabindex="-1"></a><span class="fu">str</span>(hvg.zeisel.var)</span>
<span id="cb170-4"><a href="scrna-seq-data-analysis-overview.html#cb170-4" tabindex="-1"></a><span class="co">#&gt;  chr [1:1000] &quot;Plp1&quot; &quot;Trf&quot; &quot;Mal&quot; &quot;Apod&quot; &quot;Mog&quot; &quot;Mbp&quot; &quot;Car2&quot; &quot;Cnp&quot; &quot;Ugt8a&quot; &quot;Enpp2&quot; &quot;Meg3&quot; &quot;Mobp&quot; &quot;Ermn&quot; &quot;Ptgds&quot; ...</span></span></code></pre></div>
<p>The choice of “n” also has a fairly straightforward biological interpretation.
The main disadvantage of this approach that it turns HVG selection into a competition between genes, whereby a subset of very highly variable genes can push other informative genes out of the top set. This can be problematic for analyses of highly heterogeneous populations if the loss of important markers prevents the resolution of certain subpopulations.</p>
</div>
</div>
<div id="dimensionality-reduction" class="section level2 hasAnchor" number="11.7">
<h2><span class="header-section-number">11.7</span> Dimensionality reduction<a href="scrna-seq-data-analysis-overview.html#dimensionality-reduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many scRNA-seq analysis procedures involve comparing cells based on their expression values across multiple genes. For example, clustering aims to identify cells with similar transcriptomic profiles by computing Euclidean distances across genes. In these applications, each individual gene represents a dimension of the data.</p>
<p>As the name suggests, dimensionality reduction aims to reduce the number of separate dimensions in the data. This is possible because different genes are correlated if they are affected by the same biological process. Thus, we do not need to store separate information for individual genes, but can instead compress multiple features into a single dimension, e.g., an “eigengene” (Langfelder and Horvath 2007). This reduces computational work in downstream analyses like clustering, as calculations only need to be performed for a few dimensions rather than thousands of genes; reduces noise by averaging across multiple genes to obtain a more precise representation of the patterns in the data; and enables effective plotting of the data, for those of us who are not capable of visualizing more than 3 dimensions.</p>
<div id="principal-components-analysis" class="section level3 hasAnchor" number="11.7.1">
<h3><span class="header-section-number">11.7.1</span> Principal components analysis<a href="scrna-seq-data-analysis-overview.html#principal-components-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Principal components analysis (PCA) discovers axes in high-dimensional space that capture the largest amount of variation. This is best understood by imagining each axis as a line. Say we draw a line anywhere, and we move each cell in our data set onto the closest position on the line. The variance captured by this axis is defined as the variance in the positions of cells along that line.</p>
<p><img src="https://raw.githubusercontent.com/lcolladotor/cshl_rstats_genome_scale_2024/devel/Figures/pca_concept.png" /></p>
<p>In PCA, the first axis (or “principal component”, PC) is chosen such that it maximizes this variance. The next PC is chosen such that it is orthogonal to the first and captures the greatest remaining amount of variation, and so on.</p>
<p>By definition, the top PCs capture the dominant factors of heterogeneity in the data set. In the context of scRNA-seq, our assumption is that biological processes affect multiple genes in a coordinated manner. This means that the earlier PCs are likely to represent biological structure as more variation can be captured by considering the correlated behavior of many genes. By comparison, random technical or biological noise is expected to affect each gene independently. There is unlikely to be an axis that can capture random variation across many genes, meaning that noise should mostly be concentrated in the later PCs. This motivates the use of the earlier PCs in our downstream analyses, which concentrates the biological signal to simultaneously reduce computational work and remove noise.</p>
<p><img src="https://raw.githubusercontent.com/lcolladotor/cshl_rstats_genome_scale_2024/devel/Figures/PCs.png" /></p>
<p>We can perform PCA on the log-normalized expression values using the <code>fixedPCA()</code> function from scran. By default, <code>fixedPCA()</code> will compute the first 50 PCs and store them in the <code>reducedDims()</code> of the output <code>SingleCellExperiment</code> object, as shown below.</p>
<p>Here, we use only the top 2000 genes with the largest biological components to reduce both computational work and high-dimensional random noise. In particular, while PCA is robust to random noise, an excess of it may cause the earlier PCs to capture noise instead of biological structure (Johnstone and Lu 2009).</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="scrna-seq-data-analysis-overview.html#cb171-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb171-2"><a href="scrna-seq-data-analysis-overview.html#cb171-2" tabindex="-1"></a></span>
<span id="cb171-3"><a href="scrna-seq-data-analysis-overview.html#cb171-3" tabindex="-1"></a><span class="do">## Top 2000 HVGs</span></span>
<span id="cb171-4"><a href="scrna-seq-data-analysis-overview.html#cb171-4" tabindex="-1"></a>top.zeisel <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(dec.zeisel, <span class="at">n =</span> <span class="dv">2000</span>)</span>
<span id="cb171-5"><a href="scrna-seq-data-analysis-overview.html#cb171-5" tabindex="-1"></a></span>
<span id="cb171-6"><a href="scrna-seq-data-analysis-overview.html#cb171-6" tabindex="-1"></a><span class="do">## Principal component analysis using top 2000 HVGs, 50 PCs</span></span>
<span id="cb171-7"><a href="scrna-seq-data-analysis-overview.html#cb171-7" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb171-8"><a href="scrna-seq-data-analysis-overview.html#cb171-8" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">fixedPCA</span>(sce.zeisel, <span class="at">subset.row =</span> top.zeisel)</span>
<span id="cb171-9"><a href="scrna-seq-data-analysis-overview.html#cb171-9" tabindex="-1"></a></span>
<span id="cb171-10"><a href="scrna-seq-data-analysis-overview.html#cb171-10" tabindex="-1"></a><span class="fu">reducedDimNames</span>(sce.zeisel)</span>
<span id="cb171-11"><a href="scrna-seq-data-analysis-overview.html#cb171-11" tabindex="-1"></a><span class="co">#&gt; [1] &quot;PCA&quot;</span></span></code></pre></div>
</div>
<div id="choosing-the-number-of-pcs" class="section level3 hasAnchor" number="11.7.2">
<h3><span class="header-section-number">11.7.2</span> Choosing the number of PCs<a href="scrna-seq-data-analysis-overview.html#choosing-the-number-of-pcs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>How many of the top PCs should we retain for downstream analyses? The choice of the number of PCs is an analogous decision to the choice of the number of HVGs to use. Using more PCs will retain more biological signal at the cost of including more noise that might mask said signal. On the other hand, using fewer PCs will introduce competition between different factors of variation, where weaker (but still interesting) factors may be pushed down into lower PCs and inadvertently discarded from downstream analyses.</p>
<p>It is hard to determine whether an “optimal” choice exists for the number of PCs. Certainly, we could attempt to remove the technical variation that is almost always uninteresting. However, even if we were only left with biological variation, there is no straightforward way to automatically determine which aspects of this variation are relevant.</p>
<p>Most practitioners will simply set to a “reasonable” but arbitrary value, typically ranging from 10 to 50. This is satisfactory depending of the amount of variance explained by that certain number of PCs.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="scrna-seq-data-analysis-overview.html#cb172-1" tabindex="-1"></a><span class="do">## Variance explained by PCs</span></span>
<span id="cb172-2"><a href="scrna-seq-data-analysis-overview.html#cb172-2" tabindex="-1"></a>percent.var <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">reducedDim</span>(sce.zeisel), <span class="st">&quot;percentVar&quot;</span>)</span>
<span id="cb172-3"><a href="scrna-seq-data-analysis-overview.html#cb172-3" tabindex="-1"></a><span class="fu">plot</span>(percent.var, <span class="at">log =</span> <span class="st">&quot;y&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;PC&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Variance explained (%)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/VarExplained_PCs-1.png" width="672" /></p>
</div>
<div id="visualizing-the-pcs" class="section level3 hasAnchor" number="11.7.3">
<h3><span class="header-section-number">11.7.3</span> Visualizing the PCs<a href="scrna-seq-data-analysis-overview.html#visualizing-the-pcs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Algorithms are more than happy to operate on 10-50 PCs, but these are still too many dimensions for human comprehension. To visualize the data, the most common and easy way is to use the top 2 PCs for plotting.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="scrna-seq-data-analysis-overview.html#cb173-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb173-2"><a href="scrna-seq-data-analysis-overview.html#cb173-2" tabindex="-1"></a><span class="do">## Plot PCA (Top 2 PCs for 2 dimentional visualization)</span></span>
<span id="cb173-3"><a href="scrna-seq-data-analysis-overview.html#cb173-3" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/PCs_zeisel-1.png" width="672" /></p>
<p>The problem is that PCA is a linear technique, i.e., only variation along a line in high-dimensional space is captured by each PC. As such, it cannot efficiently pack differences in <em>d</em> dimensions into the first 2 PCs.</p>
<p>One workaround is to plot several of the top PCs against each other in pairwise plots. However, it is difficult to interpret multiple plots simultaneously, and even this approach is not sufficient to separate some of the annotated subpopulations.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="scrna-seq-data-analysis-overview.html#cb174-1" tabindex="-1"></a><span class="do">## plot top 4 PCs against each other in pairwise plots</span></span>
<span id="cb174-2"><a href="scrna-seq-data-analysis-overview.html#cb174-2" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">ncomponents =</span> <span class="dv">4</span>, <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Plot_multiplePCA_PCs-1.png" width="672" /></p>
</div>
<div id="non-linear-methods-for-visualization" class="section level3 hasAnchor" number="11.7.4">
<h3><span class="header-section-number">11.7.4</span> Non-linear methods for visualization<a href="scrna-seq-data-analysis-overview.html#non-linear-methods-for-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="t-stochastic-neighbor-embedding" class="section level4 hasAnchor" number="11.7.4.1">
<h4><span class="header-section-number">11.7.4.1</span> t-stochastic neighbor embedding<a href="scrna-seq-data-analysis-overview.html#t-stochastic-neighbor-embedding" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The de facto standard for visualization of scRNA-seq data is the t-stochastic neighbor embedding (TSNE) method (Van der Maaten and Hinton 2008). This attempts to find a low-dimensional representation of the data that preserves the distances between each point and its neighbors in the high-dimensional space. Unlike PCA, it is not restricted to linear transformations, nor is it obliged to accurately represent distances between distant populations. This means that it has much more freedom in how it arranges cells in low-dimensional space, enabling it to separate many distinct clusters in a complex population</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="scrna-seq-data-analysis-overview.html#cb175-1" tabindex="-1"></a><span class="do">## TSNE using runTSNE() stores the t-SNE coordinates in the reducedDims</span></span>
<span id="cb175-2"><a href="scrna-seq-data-analysis-overview.html#cb175-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb175-3"><a href="scrna-seq-data-analysis-overview.html#cb175-3" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb175-4"><a href="scrna-seq-data-analysis-overview.html#cb175-4" tabindex="-1"></a><span class="do">## Plot TSNE</span></span>
<span id="cb175-5"><a href="scrna-seq-data-analysis-overview.html#cb175-5" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;TSNE&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/runTSNE_zeisel-1.png" width="672" /></p>
<p>The “perplexity” is another important parameter that determines the granularity of the visualization. Low perplexities will favor resolution of finer structure, possibly to the point that the visualization is compromised by random noise. Thus, it is advisable to test different perplexity values to ensure that the choice of perplexity does not drive the interpretation of the plot.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="scrna-seq-data-analysis-overview.html#cb176-1" tabindex="-1"></a><span class="do">## run TSNE using diferent perplexity numbers and plot</span></span>
<span id="cb176-2"><a href="scrna-seq-data-analysis-overview.html#cb176-2" tabindex="-1"></a></span>
<span id="cb176-3"><a href="scrna-seq-data-analysis-overview.html#cb176-3" tabindex="-1"></a><span class="do">## TSNE using perplexity = 5</span></span>
<span id="cb176-4"><a href="scrna-seq-data-analysis-overview.html#cb176-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb176-5"><a href="scrna-seq-data-analysis-overview.html#cb176-5" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">perplexity =</span> <span class="dv">5</span>)</span>
<span id="cb176-6"><a href="scrna-seq-data-analysis-overview.html#cb176-6" tabindex="-1"></a>out5 <span class="ot">&lt;-</span> <span class="fu">plotReducedDim</span>(sce.zeisel,</span>
<span id="cb176-7"><a href="scrna-seq-data-analysis-overview.html#cb176-7" tabindex="-1"></a>    <span class="at">dimred =</span> <span class="st">&quot;TSNE&quot;</span>,</span>
<span id="cb176-8"><a href="scrna-seq-data-analysis-overview.html#cb176-8" tabindex="-1"></a>    <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span></span>
<span id="cb176-9"><a href="scrna-seq-data-analysis-overview.html#cb176-9" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;perplexity = 5&quot;</span>)</span>
<span id="cb176-10"><a href="scrna-seq-data-analysis-overview.html#cb176-10" tabindex="-1"></a><span class="do">## TSNE using perplexity = 20</span></span>
<span id="cb176-11"><a href="scrna-seq-data-analysis-overview.html#cb176-11" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb176-12"><a href="scrna-seq-data-analysis-overview.html#cb176-12" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">perplexity =</span> <span class="dv">20</span>)</span>
<span id="cb176-13"><a href="scrna-seq-data-analysis-overview.html#cb176-13" tabindex="-1"></a>out20 <span class="ot">&lt;-</span> <span class="fu">plotReducedDim</span>(sce.zeisel,</span>
<span id="cb176-14"><a href="scrna-seq-data-analysis-overview.html#cb176-14" tabindex="-1"></a>    <span class="at">dimred =</span> <span class="st">&quot;TSNE&quot;</span>,</span>
<span id="cb176-15"><a href="scrna-seq-data-analysis-overview.html#cb176-15" tabindex="-1"></a>    <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span></span>
<span id="cb176-16"><a href="scrna-seq-data-analysis-overview.html#cb176-16" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;perplexity = 20&quot;</span>)</span>
<span id="cb176-17"><a href="scrna-seq-data-analysis-overview.html#cb176-17" tabindex="-1"></a><span class="do">## TSNE using perplexity = 80</span></span>
<span id="cb176-18"><a href="scrna-seq-data-analysis-overview.html#cb176-18" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb176-19"><a href="scrna-seq-data-analysis-overview.html#cb176-19" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">perplexity =</span> <span class="dv">80</span>)</span>
<span id="cb176-20"><a href="scrna-seq-data-analysis-overview.html#cb176-20" tabindex="-1"></a>out80 <span class="ot">&lt;-</span> <span class="fu">plotReducedDim</span>(sce.zeisel,</span>
<span id="cb176-21"><a href="scrna-seq-data-analysis-overview.html#cb176-21" tabindex="-1"></a>    <span class="at">dimred =</span> <span class="st">&quot;TSNE&quot;</span>,</span>
<span id="cb176-22"><a href="scrna-seq-data-analysis-overview.html#cb176-22" tabindex="-1"></a>    <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span></span>
<span id="cb176-23"><a href="scrna-seq-data-analysis-overview.html#cb176-23" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;perplexity = 80&quot;</span>)</span>
<span id="cb176-24"><a href="scrna-seq-data-analysis-overview.html#cb176-24" tabindex="-1"></a><span class="do">## Combine plots</span></span>
<span id="cb176-25"><a href="scrna-seq-data-analysis-overview.html#cb176-25" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(out5, out20, out80, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/TSNE_perplexity_plots-1.png" width="2016" /></p>
</div>
<div id="uniform-manifold-approximation-and-projection" class="section level4 hasAnchor" number="11.7.4.2">
<h4><span class="header-section-number">11.7.4.2</span> Uniform manifold approximation and projection<a href="scrna-seq-data-analysis-overview.html#uniform-manifold-approximation-and-projection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The uniform manifold approximation and projection (UMAP) method (McInnes, Healy, and Melville 2018) is an alternative to TSNE for non-linear dimensionality reduction. It is roughly similar to tSNE in that it also tries to find a low-dimensional representation that preserves relationships between neighbors in high-dimensional space. However, the two methods are based on different theory, represented by differences in the various graph weighting equations. This manifests as a different visualization.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="scrna-seq-data-analysis-overview.html#cb177-1" tabindex="-1"></a><span class="do">## UMAP using runUMAP() stores the coordinates in the reducedDims</span></span>
<span id="cb177-2"><a href="scrna-seq-data-analysis-overview.html#cb177-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb177-3"><a href="scrna-seq-data-analysis-overview.html#cb177-3" tabindex="-1"></a>sce.zeisel <span class="ot">&lt;-</span> <span class="fu">runUMAP</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb177-4"><a href="scrna-seq-data-analysis-overview.html#cb177-4" tabindex="-1"></a><span class="do">## Plot UMAP</span></span>
<span id="cb177-5"><a href="scrna-seq-data-analysis-overview.html#cb177-5" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce.zeisel, <span class="at">dimred =</span> <span class="st">&quot;UMAP&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;level1class&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/Umap_zeisel-1.png" width="672" /></p>
<p>Compared to tSNE, the UMAP visualization tends to have more compact visual clusters with more empty space between them. It also attempts to preserve more of the global structure than tSNE. From a practical perspective, UMAP is much faster than tSNE, which may be an important consideration for large datasets. UMAP also involves a series of randomization steps so setting the seed is critical.</p>
<p>It is arguable whether the UMAP or tSNE visualizations are more useful or aesthetically pleasing. UMAP aims to preserve more global structure but this necessarily reduces resolution within each visual cluster. However, UMAP is unarguably much faster, and for that reason alone, it is increasingly displacing TSNE as the method of choice for visualizing large scRNA-seq data sets.</p>
</div>
</div>
</div>
<div id="clustering" class="section level2 hasAnchor" number="11.8">
<h2><span class="header-section-number">11.8</span> Clustering<a href="scrna-seq-data-analysis-overview.html#clustering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Clustering is an unsupervised learning procedure that is used to empirically define groups of cells with similar expression profiles. Its primary purpose is to summarize complex scRNA-seq data into a digestible format for human interpretation. This allows us to describe population heterogeneity in terms of discrete labels that are easily understood, rather than attempting to comprehend the high-dimensional manifold on which the cells truly reside. After annotation based on marker genes, the clusters can be treated as proxies for more abstract biological concepts such as cell types or cell states.</p>
<p>At this point, it is helpful to realize that clustering, like a microscope, is simply a tool to explore the data. We can zoom in and out by changing the resolution of the clustering parameters, and we can experiment with different clustering algorithms to obtain alternative perspectives of the data. This iterative approach is entirely permissible given that data exploration constitutes the majority of the scRNA-seq data analysis workflow. As such, questions about the “correctness” of the clusters or the “true” number of clusters are usually meaningless. We can define as many clusters as we like, with whatever algorithm we like. Each clustering will represent its own partitioning of the high-dimensional expression space, and is as “real” as any other clustering.</p>
<p>A more relevant question is “how well do the clusters approximate the cell types or states of interest?” Unfortunately, this is difficult to answer given the context-dependent interpretation of the underlying biology. Some analysts will be satisfied with resolution of the major cell types; other analysts may want resolution of subtypes; and others still may require resolution of different states (e.g., metabolic activity, stress) within those subtypes.</p>
<p>Regardless of the exact method used, clustering is a critical step for extracting biological insights from scRNA-seq data.</p>
<div id="graph-based-clustering" class="section level3 hasAnchor" number="11.8.1">
<h3><span class="header-section-number">11.8.1</span> Graph-based clustering<a href="scrna-seq-data-analysis-overview.html#graph-based-clustering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Graph-based clustering is a flexible and scalable technique for clustering large scRNA-seq datasets. We first build a graph where each node is a cell that is connected to its nearest neighbors in the high-dimensional space. Edges are weighted based on the similarity between the cells involved, with higher weight given to cells that are more closely related. We then apply algorithms to identify “communities” of cells that are more connected to cells in the same community than they are to cells of different communities. Each community represents a cluster that we can use for downstream interpretation.</p>
<p>The major advantage of graph-based clustering lies in its scalability. It only requires a k-nearest neighbor search that can be done in log-linear time on average, in contrast to hierachical clustering methods with runtimes that are quadratic with respect to the number of cells. Graph construction avoids making strong assumptions about the shape of the clusters or the distribution of cells within each cluster, compared to other methods like k-means (that favor spherical clusters) or Gaussian mixture models (that require normality).</p>
<p>The main drawback of graph-based methods is that, after graph construction, no information is retained about relationships beyond the neighboring cells.</p>
<p>To demonstrate, we use the <code>clusterCells()</code> function in scran on PBMC dataset. All calculations are performed using the top PCs to take advantage of data compression and denoising. This function returns a vector containing cluster assignments for each cell in our <code>SingleCellExperiment</code> object.</p>
<p>By default, <code>clusterCells()</code> uses the 10 nearest neighbors of each cell to construct a shared nearest neighbor graph. Two cells are connected by an edge if any of their nearest neighbors are shared, with the edge weight defined from the highest average rank of the shared neighbors (Xu and Su 2015). The Walktrap method from the <code>igraph</code> package is then used to identify communities.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="scrna-seq-data-analysis-overview.html#cb178-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb178-2"><a href="scrna-seq-data-analysis-overview.html#cb178-2" tabindex="-1"></a><span class="do">## Cluster using &quot;scran::clusterCells&quot;</span></span>
<span id="cb178-3"><a href="scrna-seq-data-analysis-overview.html#cb178-3" tabindex="-1"></a>nn.clusters <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel, <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb178-4"><a href="scrna-seq-data-analysis-overview.html#cb178-4" tabindex="-1"></a><span class="do">## Cluster assignments</span></span>
<span id="cb178-5"><a href="scrna-seq-data-analysis-overview.html#cb178-5" tabindex="-1"></a><span class="fu">table</span>(nn.clusters)</span>
<span id="cb178-6"><a href="scrna-seq-data-analysis-overview.html#cb178-6" tabindex="-1"></a><span class="co">#&gt; nn.clusters</span></span>
<span id="cb178-7"><a href="scrna-seq-data-analysis-overview.html#cb178-7" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22 </span></span>
<span id="cb178-8"><a href="scrna-seq-data-analysis-overview.html#cb178-8" tabindex="-1"></a><span class="co">#&gt; 561 136  78 159 123  65 112 349 368 105  95 200  92  44  67  58  37  28  33  28  48  30</span></span></code></pre></div>
<p>We assign the cluster assignments back into our <code>SingleCellExperiment</code> object as a factor in the column metadata. This allows us to conveniently visualize the distribution of clusters in a tSNE plot:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="scrna-seq-data-analysis-overview.html#cb179-1" tabindex="-1"></a><span class="do">## Save the cluster assignments</span></span>
<span id="cb179-2"><a href="scrna-seq-data-analysis-overview.html#cb179-2" tabindex="-1"></a><span class="fu">colLabels</span>(sce.zeisel) <span class="ot">&lt;-</span> nn.clusters</span>
<span id="cb179-3"><a href="scrna-seq-data-analysis-overview.html#cb179-3" tabindex="-1"></a><span class="do">## Plot TSNE coloured by cluster assignments</span></span>
<span id="cb179-4"><a href="scrna-seq-data-analysis-overview.html#cb179-4" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce.zeisel, <span class="st">&quot;TSNE&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_clusters_zeisel-1.png" width="672" /></p>
<p>If we want to explicitly specify all of these parameters, we would use the more verbose call below. This uses a <code>SNNGraphParam</code> object from the bluster package to instruct <code>clusterCells()</code> to detect communities from a shared nearest-neighbor graph with the specified parameters. The appeal of this interface is that it allows us to easily switch to a different clustering algorithm by simply changing the <code>BLUSPARAM</code> argument.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="scrna-seq-data-analysis-overview.html#cb180-1" tabindex="-1"></a><span class="fu">library</span>(bluster)</span>
<span id="cb180-2"><a href="scrna-seq-data-analysis-overview.html#cb180-2" tabindex="-1"></a></span>
<span id="cb180-3"><a href="scrna-seq-data-analysis-overview.html#cb180-3" tabindex="-1"></a><span class="do">## Clustering using k=10</span></span>
<span id="cb180-4"><a href="scrna-seq-data-analysis-overview.html#cb180-4" tabindex="-1"></a>nn.clusters2 <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb180-5"><a href="scrna-seq-data-analysis-overview.html#cb180-5" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb180-6"><a href="scrna-seq-data-analysis-overview.html#cb180-6" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">SNNGraphParam</span>(<span class="at">k =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">&quot;rank&quot;</span>, <span class="at">cluster.fun =</span> <span class="st">&quot;walktrap&quot;</span>)</span>
<span id="cb180-7"><a href="scrna-seq-data-analysis-overview.html#cb180-7" tabindex="-1"></a>)</span>
<span id="cb180-8"><a href="scrna-seq-data-analysis-overview.html#cb180-8" tabindex="-1"></a></span>
<span id="cb180-9"><a href="scrna-seq-data-analysis-overview.html#cb180-9" tabindex="-1"></a><span class="fu">table</span>(nn.clusters2)</span>
<span id="cb180-10"><a href="scrna-seq-data-analysis-overview.html#cb180-10" tabindex="-1"></a><span class="co">#&gt; nn.clusters2</span></span>
<span id="cb180-11"><a href="scrna-seq-data-analysis-overview.html#cb180-11" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22 </span></span>
<span id="cb180-12"><a href="scrna-seq-data-analysis-overview.html#cb180-12" tabindex="-1"></a><span class="co">#&gt; 561 136  78 159 123  65 112 349 368 105  95 200  92  44  67  58  37  28  33  28  48  30</span></span></code></pre></div>
<p>We could also obtain the graph itself by specifying full=TRUE in the <code>clusterCells()</code> call. Doing so will return all intermediate structures that are used during clustering, including a graph object from the <code>igraph</code> package.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="scrna-seq-data-analysis-overview.html#cb181-1" tabindex="-1"></a><span class="do">## Obtain the graph</span></span>
<span id="cb181-2"><a href="scrna-seq-data-analysis-overview.html#cb181-2" tabindex="-1"></a>nn.clust.info <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel, <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">full =</span> <span class="cn">TRUE</span>)</span>
<span id="cb181-3"><a href="scrna-seq-data-analysis-overview.html#cb181-3" tabindex="-1"></a><span class="fu">head</span>(nn.clust.info<span class="sc">$</span>objects<span class="sc">$</span>graph)</span>
<span id="cb181-4"><a href="scrna-seq-data-analysis-overview.html#cb181-4" tabindex="-1"></a><span class="co">#&gt; 6 x 2816 sparse Matrix of class &quot;dgCMatrix&quot;</span></span>
<span id="cb181-5"><a href="scrna-seq-data-analysis-overview.html#cb181-5" tabindex="-1"></a><span class="co">#&gt;                                                                                                                                  </span></span>
<span id="cb181-6"><a href="scrna-seq-data-analysis-overview.html#cb181-6" tabindex="-1"></a><span class="co">#&gt; [1,] . 8.5 9.5 9.5 9 8.5 8 5.5 8 6 4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ......</span></span>
<span id="cb181-7"><a href="scrna-seq-data-analysis-overview.html#cb181-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb181-8"><a href="scrna-seq-data-analysis-overview.html#cb181-8" tabindex="-1"></a><span class="co">#&gt;  ..............................</span></span>
<span id="cb181-9"><a href="scrna-seq-data-analysis-overview.html#cb181-9" tabindex="-1"></a><span class="co">#&gt;  ........suppressing 2762 columns and 4 rows in show(); maybe adjust options(max.print=, width=)</span></span>
<span id="cb181-10"><a href="scrna-seq-data-analysis-overview.html#cb181-10" tabindex="-1"></a><span class="co">#&gt;  ..............................</span></span>
<span id="cb181-11"><a href="scrna-seq-data-analysis-overview.html#cb181-11" tabindex="-1"></a><span class="co">#&gt;                                                                                                                              </span></span>
<span id="cb181-12"><a href="scrna-seq-data-analysis-overview.html#cb181-12" tabindex="-1"></a><span class="co">#&gt; [6,] 8.5 8 5.5 9 9 . 8.5 9 8 6 5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ......</span></span></code></pre></div>
</div>
<div id="adjusting-the-parameters" class="section level3 hasAnchor" number="11.8.2">
<h3><span class="header-section-number">11.8.2</span> Adjusting the parameters<a href="scrna-seq-data-analysis-overview.html#adjusting-the-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A graph-based clustering method has several key parameters:</p>
<ul>
<li>How many neighbors are considered when constructing the graph.</li>
<li>What scheme is used to weight the edges.</li>
<li>Which community detection algorithm is used to define the clusters.</li>
</ul>
<p><strong>K Neighbors</strong></p>
<p>One of the most important parameters is k, the number of nearest neighbors used to construct the graph. This controls the resolution of the clustering where higher k yields a more inter-connected graph and broader clusters. Users can exploit this by experimenting with different values of k to obtain a satisfactory resolution.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="scrna-seq-data-analysis-overview.html#cb182-1" tabindex="-1"></a><span class="do">## More resolved clustering using a smaller k (k=5)</span></span>
<span id="cb182-2"><a href="scrna-seq-data-analysis-overview.html#cb182-2" tabindex="-1"></a>clust<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel, <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">k =</span> <span class="dv">5</span>))</span>
<span id="cb182-3"><a href="scrna-seq-data-analysis-overview.html#cb182-3" tabindex="-1"></a><span class="fu">table</span>(clust<span class="fl">.5</span>)</span>
<span id="cb182-4"><a href="scrna-seq-data-analysis-overview.html#cb182-4" tabindex="-1"></a><span class="co">#&gt; clust.5</span></span>
<span id="cb182-5"><a href="scrna-seq-data-analysis-overview.html#cb182-5" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30 </span></span>
<span id="cb182-6"><a href="scrna-seq-data-analysis-overview.html#cb182-6" tabindex="-1"></a><span class="co">#&gt; 118  98 336  85  36 115  49  85 429 295  40  37  97  56  45  43  77 159  28  40  52  33  24  51  28  89  36  51  65   8 </span></span>
<span id="cb182-7"><a href="scrna-seq-data-analysis-overview.html#cb182-7" tabindex="-1"></a><span class="co">#&gt;  31  32  33  34  35  36  37 </span></span>
<span id="cb182-8"><a href="scrna-seq-data-analysis-overview.html#cb182-8" tabindex="-1"></a><span class="co">#&gt;  15  17  20  14   9   9  27</span></span></code></pre></div>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="scrna-seq-data-analysis-overview.html#cb183-1" tabindex="-1"></a><span class="do">## Less resolved clustering using a larger k (k=50)</span></span>
<span id="cb183-2"><a href="scrna-seq-data-analysis-overview.html#cb183-2" tabindex="-1"></a>clust<span class="fl">.50</span> <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel, <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>, <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">k =</span> <span class="dv">50</span>))</span>
<span id="cb183-3"><a href="scrna-seq-data-analysis-overview.html#cb183-3" tabindex="-1"></a><span class="fu">table</span>(clust<span class="fl">.50</span>)</span>
<span id="cb183-4"><a href="scrna-seq-data-analysis-overview.html#cb183-4" tabindex="-1"></a><span class="co">#&gt; clust.50</span></span>
<span id="cb183-5"><a href="scrna-seq-data-analysis-overview.html#cb183-5" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5 </span></span>
<span id="cb183-6"><a href="scrna-seq-data-analysis-overview.html#cb183-6" tabindex="-1"></a><span class="co">#&gt; 362 812 945 288 409</span></span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="scrna-seq-data-analysis-overview.html#cb184-1" tabindex="-1"></a></span>
<span id="cb184-2"><a href="scrna-seq-data-analysis-overview.html#cb184-2" tabindex="-1"></a><span class="do">## Plot TSNE coloured by cluster assignments again, now with clust.50 results</span></span>
<span id="cb184-3"><a href="scrna-seq-data-analysis-overview.html#cb184-3" tabindex="-1"></a><span class="fu">colLabels</span>(sce.zeisel) <span class="ot">&lt;-</span> clust<span class="fl">.50</span></span>
<span id="cb184-4"><a href="scrna-seq-data-analysis-overview.html#cb184-4" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce.zeisel, <span class="st">&quot;TSNE&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/lessRes_clustering-1.png" width="672" /></p>
<p><strong>Edge weighting scheme</strong></p>
<p>Further tweaking can be performed by changing the edge weighting scheme during graph construction. Setting <code>type = "number"</code> will weight edges based on the number of nearest neighbors that are shared between two cells. Similarly, <code>type = "jaccard"</code> will weight edges according to the Jaccard index of the two sets of neighbors. We can also disable weighting altogether by using a simple<br />
k-nearest neighbor graph, which is occasionally useful for downstream graph operations that do not support weights.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="scrna-seq-data-analysis-overview.html#cb185-1" tabindex="-1"></a><span class="do">## Cluster using the number of shared nearest neighbors (type=&quot;number&quot;)</span></span>
<span id="cb185-2"><a href="scrna-seq-data-analysis-overview.html#cb185-2" tabindex="-1"></a>clust.num <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb185-3"><a href="scrna-seq-data-analysis-overview.html#cb185-3" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb185-4"><a href="scrna-seq-data-analysis-overview.html#cb185-4" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">type =</span> <span class="st">&quot;number&quot;</span>)</span>
<span id="cb185-5"><a href="scrna-seq-data-analysis-overview.html#cb185-5" tabindex="-1"></a>)</span>
<span id="cb185-6"><a href="scrna-seq-data-analysis-overview.html#cb185-6" tabindex="-1"></a><span class="fu">table</span>(clust.num)</span>
<span id="cb185-7"><a href="scrna-seq-data-analysis-overview.html#cb185-7" tabindex="-1"></a><span class="co">#&gt; clust.num</span></span>
<span id="cb185-8"><a href="scrna-seq-data-analysis-overview.html#cb185-8" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26 </span></span>
<span id="cb185-9"><a href="scrna-seq-data-analysis-overview.html#cb185-9" tabindex="-1"></a><span class="co">#&gt; 128 161 129 457 128 116  78 309 397 205  60  96  70  62  35  13  46  51  30  31  52  28  15  58  34  27</span></span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="scrna-seq-data-analysis-overview.html#cb186-1" tabindex="-1"></a></span>
<span id="cb186-2"><a href="scrna-seq-data-analysis-overview.html#cb186-2" tabindex="-1"></a><span class="do">## Cluster using the Jaccard index (similarity between sample sets)</span></span>
<span id="cb186-3"><a href="scrna-seq-data-analysis-overview.html#cb186-3" tabindex="-1"></a>clust.jaccard <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb186-4"><a href="scrna-seq-data-analysis-overview.html#cb186-4" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb186-5"><a href="scrna-seq-data-analysis-overview.html#cb186-5" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">type =</span> <span class="st">&quot;jaccard&quot;</span>)</span>
<span id="cb186-6"><a href="scrna-seq-data-analysis-overview.html#cb186-6" tabindex="-1"></a>)</span>
<span id="cb186-7"><a href="scrna-seq-data-analysis-overview.html#cb186-7" tabindex="-1"></a><span class="fu">table</span>(clust.jaccard)</span>
<span id="cb186-8"><a href="scrna-seq-data-analysis-overview.html#cb186-8" tabindex="-1"></a><span class="co">#&gt; clust.jaccard</span></span>
<span id="cb186-9"><a href="scrna-seq-data-analysis-overview.html#cb186-9" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26 </span></span>
<span id="cb186-10"><a href="scrna-seq-data-analysis-overview.html#cb186-10" tabindex="-1"></a><span class="co">#&gt; 131 166 195 129 294 128 113  77 332 200 375  61  97  71  84  32  13  46  53  30  52  28  31  36  15  27</span></span></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="scrna-seq-data-analysis-overview.html#cb187-1" tabindex="-1"></a></span>
<span id="cb187-2"><a href="scrna-seq-data-analysis-overview.html#cb187-2" tabindex="-1"></a><span class="do">## Cluster without specifying a graph type (default method-KNNGraphParam)</span></span>
<span id="cb187-3"><a href="scrna-seq-data-analysis-overview.html#cb187-3" tabindex="-1"></a>clust.none <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb187-4"><a href="scrna-seq-data-analysis-overview.html#cb187-4" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb187-5"><a href="scrna-seq-data-analysis-overview.html#cb187-5" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">KNNGraphParam</span>()</span>
<span id="cb187-6"><a href="scrna-seq-data-analysis-overview.html#cb187-6" tabindex="-1"></a>)</span>
<span id="cb187-7"><a href="scrna-seq-data-analysis-overview.html#cb187-7" tabindex="-1"></a><span class="fu">table</span>(clust.none)</span>
<span id="cb187-8"><a href="scrna-seq-data-analysis-overview.html#cb187-8" tabindex="-1"></a><span class="co">#&gt; clust.none</span></span>
<span id="cb187-9"><a href="scrna-seq-data-analysis-overview.html#cb187-9" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23 </span></span>
<span id="cb187-10"><a href="scrna-seq-data-analysis-overview.html#cb187-10" tabindex="-1"></a><span class="co">#&gt;  77 454 297 132 105 164 129 104  62 533 186  45 105  33  69  82  50  52  31  34  30  15  27</span></span></code></pre></div>
<p><strong>Community detection</strong></p>
<p>The community detection can be performed by using any of the algorithms provided by <code>igraph</code>. The Walktrap approach is a common one, but many others are available to choose from:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="scrna-seq-data-analysis-overview.html#cb188-1" tabindex="-1"></a>clust.walktrap <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb188-2"><a href="scrna-seq-data-analysis-overview.html#cb188-2" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb188-3"><a href="scrna-seq-data-analysis-overview.html#cb188-3" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">cluster.fun =</span> <span class="st">&quot;walktrap&quot;</span>)</span>
<span id="cb188-4"><a href="scrna-seq-data-analysis-overview.html#cb188-4" tabindex="-1"></a>)</span>
<span id="cb188-5"><a href="scrna-seq-data-analysis-overview.html#cb188-5" tabindex="-1"></a></span>
<span id="cb188-6"><a href="scrna-seq-data-analysis-overview.html#cb188-6" tabindex="-1"></a>clust.louvain <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb188-7"><a href="scrna-seq-data-analysis-overview.html#cb188-7" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb188-8"><a href="scrna-seq-data-analysis-overview.html#cb188-8" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">cluster.fun =</span> <span class="st">&quot;louvain&quot;</span>)</span>
<span id="cb188-9"><a href="scrna-seq-data-analysis-overview.html#cb188-9" tabindex="-1"></a>)</span>
<span id="cb188-10"><a href="scrna-seq-data-analysis-overview.html#cb188-10" tabindex="-1"></a></span>
<span id="cb188-11"><a href="scrna-seq-data-analysis-overview.html#cb188-11" tabindex="-1"></a>clust.infomap <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb188-12"><a href="scrna-seq-data-analysis-overview.html#cb188-12" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb188-13"><a href="scrna-seq-data-analysis-overview.html#cb188-13" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">cluster.fun =</span> <span class="st">&quot;infomap&quot;</span>)</span>
<span id="cb188-14"><a href="scrna-seq-data-analysis-overview.html#cb188-14" tabindex="-1"></a>)</span>
<span id="cb188-15"><a href="scrna-seq-data-analysis-overview.html#cb188-15" tabindex="-1"></a></span>
<span id="cb188-16"><a href="scrna-seq-data-analysis-overview.html#cb188-16" tabindex="-1"></a>clust.fast <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb188-17"><a href="scrna-seq-data-analysis-overview.html#cb188-17" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb188-18"><a href="scrna-seq-data-analysis-overview.html#cb188-18" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">cluster.fun =</span> <span class="st">&quot;fast_greedy&quot;</span>)</span>
<span id="cb188-19"><a href="scrna-seq-data-analysis-overview.html#cb188-19" tabindex="-1"></a>)</span>
<span id="cb188-20"><a href="scrna-seq-data-analysis-overview.html#cb188-20" tabindex="-1"></a></span>
<span id="cb188-21"><a href="scrna-seq-data-analysis-overview.html#cb188-21" tabindex="-1"></a>clust.labprop <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb188-22"><a href="scrna-seq-data-analysis-overview.html#cb188-22" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb188-23"><a href="scrna-seq-data-analysis-overview.html#cb188-23" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">cluster.fun =</span> <span class="st">&quot;label_prop&quot;</span>)</span>
<span id="cb188-24"><a href="scrna-seq-data-analysis-overview.html#cb188-24" tabindex="-1"></a>)</span>
<span id="cb188-25"><a href="scrna-seq-data-analysis-overview.html#cb188-25" tabindex="-1"></a></span>
<span id="cb188-26"><a href="scrna-seq-data-analysis-overview.html#cb188-26" tabindex="-1"></a>clust.eigen <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce.zeisel,</span>
<span id="cb188-27"><a href="scrna-seq-data-analysis-overview.html#cb188-27" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb188-28"><a href="scrna-seq-data-analysis-overview.html#cb188-28" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">NNGraphParam</span>(<span class="at">cluster.fun =</span> <span class="st">&quot;leading_eigen&quot;</span>)</span>
<span id="cb188-29"><a href="scrna-seq-data-analysis-overview.html#cb188-29" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="hierarchical-clustering" class="section level3 hasAnchor" number="11.8.3">
<h3><span class="header-section-number">11.8.3</span> Hierarchical clustering<a href="scrna-seq-data-analysis-overview.html#hierarchical-clustering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hierarchical clustering is an old technique that arranges samples into a hierarchy based on their relative similarity to each other. Most implementations do so by joining the most similar samples into a new cluster, then joining similar clusters into larger clusters, and so on, until all samples belong to a single cluster. This process yields obtain a dendrogram that defines clusters with progressively increasing granularity. Variants of hierarchical clustering methods primarily differ in how they choose to perform the agglomerations. For example, complete linkage aims to merge clusters with the smallest maximum distance between their elements, while Ward’s method aims to minimize the increase in within-cluster variance.</p>
<p>In the context of scRNA-seq, the main advantage of hierarchical clustering lies in the production of the dendrogram. This is a rich summary that quantitatively captures the relationships between subpopulations at various resolutions.This can be helpful for interpretation.</p>
<p>In practice, hierarchical clustering is too slow to be used for anything but the smallest scRNA-seq datasets. Most implementations require a cell-cell distance matrix that is prohibitively expensive to compute for a large number of cells. Greedy agglomeration is also likely to result in a quantitatively suboptimal partitioning (as defined by the agglomeration measure) at higher levels of the dendrogram when the number of cells and merge steps is high</p>
<p>We use a HclustParam object to instruct <code>clusterCells()</code> to perform hierarchical clustering on the top PCs. Specifically, it computes a cell-cell distance matrix using the top PCs and then applies Ward’s minimum variance method to obtain a dendrogram.</p>
<p>For this case, we will use the sce.416b</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="scrna-seq-data-analysis-overview.html#cb189-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb189-2"><a href="scrna-seq-data-analysis-overview.html#cb189-2" tabindex="-1"></a><span class="do">## Top 2000 HVGs</span></span>
<span id="cb189-3"><a href="scrna-seq-data-analysis-overview.html#cb189-3" tabindex="-1"></a>top<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(sce<span class="fl">.416</span>b, <span class="at">n =</span> <span class="dv">2000</span>)</span>
<span id="cb189-4"><a href="scrna-seq-data-analysis-overview.html#cb189-4" tabindex="-1"></a><span class="do">## Principal component analysis using top 2000 HVGs, 50 PCs</span></span>
<span id="cb189-5"><a href="scrna-seq-data-analysis-overview.html#cb189-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb189-6"><a href="scrna-seq-data-analysis-overview.html#cb189-6" tabindex="-1"></a>sce<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">fixedPCA</span>(sce<span class="fl">.416</span>b, <span class="at">subset.row =</span> top<span class="fl">.416</span>b)</span>
<span id="cb189-7"><a href="scrna-seq-data-analysis-overview.html#cb189-7" tabindex="-1"></a><span class="do">## TSNE</span></span>
<span id="cb189-8"><a href="scrna-seq-data-analysis-overview.html#cb189-8" tabindex="-1"></a>sce<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce<span class="fl">.416</span>b, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="scrna-seq-data-analysis-overview.html#cb190-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dendextend&quot;</span>)</span>
<span id="cb190-2"><a href="scrna-seq-data-analysis-overview.html#cb190-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb190-3"><a href="scrna-seq-data-analysis-overview.html#cb190-3" tabindex="-1"></a><span class="co">#&gt; ---------------------</span></span>
<span id="cb190-4"><a href="scrna-seq-data-analysis-overview.html#cb190-4" tabindex="-1"></a><span class="co">#&gt; Welcome to dendextend version 1.17.1</span></span>
<span id="cb190-5"><a href="scrna-seq-data-analysis-overview.html#cb190-5" tabindex="-1"></a><span class="co">#&gt; Type citation(&#39;dendextend&#39;) for how to cite the package.</span></span>
<span id="cb190-6"><a href="scrna-seq-data-analysis-overview.html#cb190-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb190-7"><a href="scrna-seq-data-analysis-overview.html#cb190-7" tabindex="-1"></a><span class="co">#&gt; Type browseVignettes(package = &#39;dendextend&#39;) for the package vignette.</span></span>
<span id="cb190-8"><a href="scrna-seq-data-analysis-overview.html#cb190-8" tabindex="-1"></a><span class="co">#&gt; The github page is: https://github.com/talgalili/dendextend/</span></span>
<span id="cb190-9"><a href="scrna-seq-data-analysis-overview.html#cb190-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb190-10"><a href="scrna-seq-data-analysis-overview.html#cb190-10" tabindex="-1"></a><span class="co">#&gt; Suggestions and bug-reports can be submitted at: https://github.com/talgalili/dendextend/issues</span></span>
<span id="cb190-11"><a href="scrna-seq-data-analysis-overview.html#cb190-11" tabindex="-1"></a><span class="co">#&gt; You may ask questions at stackoverflow, use the r and dendextend tags: </span></span>
<span id="cb190-12"><a href="scrna-seq-data-analysis-overview.html#cb190-12" tabindex="-1"></a><span class="co">#&gt;   https://stackoverflow.com/questions/tagged/dendextend</span></span>
<span id="cb190-13"><a href="scrna-seq-data-analysis-overview.html#cb190-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb190-14"><a href="scrna-seq-data-analysis-overview.html#cb190-14" tabindex="-1"></a><span class="co">#&gt;  To suppress this message use:  suppressPackageStartupMessages(library(dendextend))</span></span>
<span id="cb190-15"><a href="scrna-seq-data-analysis-overview.html#cb190-15" tabindex="-1"></a><span class="co">#&gt; ---------------------</span></span>
<span id="cb190-16"><a href="scrna-seq-data-analysis-overview.html#cb190-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb190-17"><a href="scrna-seq-data-analysis-overview.html#cb190-17" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;dendextend&#39;</span></span>
<span id="cb190-18"><a href="scrna-seq-data-analysis-overview.html#cb190-18" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:stats&#39;:</span></span>
<span id="cb190-19"><a href="scrna-seq-data-analysis-overview.html#cb190-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb190-20"><a href="scrna-seq-data-analysis-overview.html#cb190-20" tabindex="-1"></a><span class="co">#&gt;     cutree</span></span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="scrna-seq-data-analysis-overview.html#cb191-1" tabindex="-1"></a></span>
<span id="cb191-2"><a href="scrna-seq-data-analysis-overview.html#cb191-2" tabindex="-1"></a><span class="do">## Perform hierarchical clustering on the PCA-reduced data from sce.416b</span></span>
<span id="cb191-3"><a href="scrna-seq-data-analysis-overview.html#cb191-3" tabindex="-1"></a><span class="do">## The BLUSPARAM argument specifies the clustering method (here &quot;ward.D2&quot;).</span></span>
<span id="cb191-4"><a href="scrna-seq-data-analysis-overview.html#cb191-4" tabindex="-1"></a><span class="do">## The full=TRUE argument ensures that additional objects related to clustering are returned.</span></span>
<span id="cb191-5"><a href="scrna-seq-data-analysis-overview.html#cb191-5" tabindex="-1"></a>hclust<span class="fl">.416</span>b <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce<span class="fl">.416</span>b,</span>
<span id="cb191-6"><a href="scrna-seq-data-analysis-overview.html#cb191-6" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb191-7"><a href="scrna-seq-data-analysis-overview.html#cb191-7" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">HclustParam</span>(<span class="at">method =</span> <span class="st">&quot;ward.D2&quot;</span>), <span class="at">full =</span> <span class="cn">TRUE</span></span>
<span id="cb191-8"><a href="scrna-seq-data-analysis-overview.html#cb191-8" tabindex="-1"></a>)</span>
<span id="cb191-9"><a href="scrna-seq-data-analysis-overview.html#cb191-9" tabindex="-1"></a></span>
<span id="cb191-10"><a href="scrna-seq-data-analysis-overview.html#cb191-10" tabindex="-1"></a><span class="do">## Extract the hierarchical clustering tree from the clustering result</span></span>
<span id="cb191-11"><a href="scrna-seq-data-analysis-overview.html#cb191-11" tabindex="-1"></a>tree<span class="fl">.416</span>b <span class="ot">&lt;-</span> hclust<span class="fl">.416</span>b<span class="sc">$</span>objects<span class="sc">$</span>hclust</span>
<span id="cb191-12"><a href="scrna-seq-data-analysis-overview.html#cb191-12" tabindex="-1"></a></span>
<span id="cb191-13"><a href="scrna-seq-data-analysis-overview.html#cb191-13" tabindex="-1"></a><span class="do">## Customize the dendrogram for better visualization</span></span>
<span id="cb191-14"><a href="scrna-seq-data-analysis-overview.html#cb191-14" tabindex="-1"></a>tree<span class="fl">.416</span>b<span class="sc">$</span>labels <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(tree<span class="fl">.416</span>b<span class="sc">$</span>labels)</span>
<span id="cb191-15"><a href="scrna-seq-data-analysis-overview.html#cb191-15" tabindex="-1"></a><span class="do">## Convert the hierarchical clustering tree to a dendrogram object</span></span>
<span id="cb191-16"><a href="scrna-seq-data-analysis-overview.html#cb191-16" tabindex="-1"></a>dend <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(tree<span class="fl">.416</span>b, <span class="at">hang =</span> <span class="fl">0.1</span>)</span>
<span id="cb191-17"><a href="scrna-seq-data-analysis-overview.html#cb191-17" tabindex="-1"></a>combined.fac <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb191-18"><a href="scrna-seq-data-analysis-overview.html#cb191-18" tabindex="-1"></a>    sce<span class="fl">.416</span>b<span class="sc">$</span>block, <span class="st">&quot;.&quot;</span>,</span>
<span id="cb191-19"><a href="scrna-seq-data-analysis-overview.html#cb191-19" tabindex="-1"></a>    <span class="fu">sub</span>(<span class="st">&quot; .*&quot;</span>, <span class="st">&quot;&quot;</span>, sce<span class="fl">.416</span>b<span class="sc">$</span>phenotype)</span>
<span id="cb191-20"><a href="scrna-seq-data-analysis-overview.html#cb191-20" tabindex="-1"></a>)</span>
<span id="cb191-21"><a href="scrna-seq-data-analysis-overview.html#cb191-21" tabindex="-1"></a></span>
<span id="cb191-22"><a href="scrna-seq-data-analysis-overview.html#cb191-22" tabindex="-1"></a><span class="fu">labels_colors</span>(dend) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb191-23"><a href="scrna-seq-data-analysis-overview.html#cb191-23" tabindex="-1"></a>    <span class="st">&quot;20160113.wild&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb191-24"><a href="scrna-seq-data-analysis-overview.html#cb191-24" tabindex="-1"></a>    <span class="st">&quot;20160113.induced&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb191-25"><a href="scrna-seq-data-analysis-overview.html#cb191-25" tabindex="-1"></a>    <span class="st">&quot;20160325.wild&quot;</span> <span class="ot">=</span> <span class="st">&quot;dodgerblue&quot;</span>,</span>
<span id="cb191-26"><a href="scrna-seq-data-analysis-overview.html#cb191-26" tabindex="-1"></a>    <span class="st">&quot;20160325.induced&quot;</span> <span class="ot">=</span> <span class="st">&quot;salmon&quot;</span></span>
<span id="cb191-27"><a href="scrna-seq-data-analysis-overview.html#cb191-27" tabindex="-1"></a>)[combined.fac][<span class="fu">order.dendrogram</span>(dend)]</span>
<span id="cb191-28"><a href="scrna-seq-data-analysis-overview.html#cb191-28" tabindex="-1"></a></span>
<span id="cb191-29"><a href="scrna-seq-data-analysis-overview.html#cb191-29" tabindex="-1"></a><span class="do">## Plot the dendrogram</span></span>
<span id="cb191-30"><a href="scrna-seq-data-analysis-overview.html#cb191-30" tabindex="-1"></a><span class="fu">plot</span>(dend)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_dendogram-1.png" width="672" /></p>
<p>To obtain explicit clusters, we “cut” the tree by removing internal branches such that every subtree represents a distinct cluster. This is most simply done by removing internal branches above a certain height of the tree, as performed by the <code>cutree()</code> function. A more sophisticated variant of this approach is implemented in the <code>dynamicTreeCut</code> package, which uses the shape of the branches to obtain a better partitioning for complex dendrograms. We enable this option by setting <code>cut.dynamic = TRUE</code>, with additional tweaking of the <code>deepSplit</code> parameter to control the resolution of the resulting clusters.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="scrna-seq-data-analysis-overview.html#cb192-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dynamicTreeCut&quot;</span>)</span>
<span id="cb192-2"><a href="scrna-seq-data-analysis-overview.html#cb192-2" tabindex="-1"></a></span>
<span id="cb192-3"><a href="scrna-seq-data-analysis-overview.html#cb192-3" tabindex="-1"></a><span class="do">## Perform hierarchical clustering with dynamic tree cut on the PCA</span></span>
<span id="cb192-4"><a href="scrna-seq-data-analysis-overview.html#cb192-4" tabindex="-1"></a><span class="do">## The BLUSPARAM argument specifies the clustering method (here &quot;ward.D2&quot;),</span></span>
<span id="cb192-5"><a href="scrna-seq-data-analysis-overview.html#cb192-5" tabindex="-1"></a><span class="do">## and enables dynamic tree cut (cut.dynamic=TRUE) with specific parameters.</span></span>
<span id="cb192-6"><a href="scrna-seq-data-analysis-overview.html#cb192-6" tabindex="-1"></a>hclust.dyn <span class="ot">&lt;-</span> <span class="fu">clusterCells</span>(sce<span class="fl">.416</span>b,</span>
<span id="cb192-7"><a href="scrna-seq-data-analysis-overview.html#cb192-7" tabindex="-1"></a>    <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>,</span>
<span id="cb192-8"><a href="scrna-seq-data-analysis-overview.html#cb192-8" tabindex="-1"></a>    <span class="at">BLUSPARAM =</span> <span class="fu">HclustParam</span>(</span>
<span id="cb192-9"><a href="scrna-seq-data-analysis-overview.html#cb192-9" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;ward.D2&quot;</span>, <span class="at">cut.dynamic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb192-10"><a href="scrna-seq-data-analysis-overview.html#cb192-10" tabindex="-1"></a>        <span class="at">cut.params =</span> <span class="fu">list</span>(<span class="at">minClusterSize =</span> <span class="dv">10</span>, <span class="at">deepSplit =</span> <span class="dv">1</span>)</span>
<span id="cb192-11"><a href="scrna-seq-data-analysis-overview.html#cb192-11" tabindex="-1"></a>    )</span>
<span id="cb192-12"><a href="scrna-seq-data-analysis-overview.html#cb192-12" tabindex="-1"></a>)</span>
<span id="cb192-13"><a href="scrna-seq-data-analysis-overview.html#cb192-13" tabindex="-1"></a><span class="fu">table</span>(hclust.dyn)</span>
<span id="cb192-14"><a href="scrna-seq-data-analysis-overview.html#cb192-14" tabindex="-1"></a><span class="co">#&gt; hclust.dyn</span></span>
<span id="cb192-15"><a href="scrna-seq-data-analysis-overview.html#cb192-15" tabindex="-1"></a><span class="co">#&gt;  1  2  3  4 </span></span>
<span id="cb192-16"><a href="scrna-seq-data-analysis-overview.html#cb192-16" tabindex="-1"></a><span class="co">#&gt; 82 70 27 13</span></span></code></pre></div>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="scrna-seq-data-analysis-overview.html#cb193-1" tabindex="-1"></a></span>
<span id="cb193-2"><a href="scrna-seq-data-analysis-overview.html#cb193-2" tabindex="-1"></a><span class="do">## Plot dendogram</span></span>
<span id="cb193-3"><a href="scrna-seq-data-analysis-overview.html#cb193-3" tabindex="-1"></a><span class="fu">labels_colors</span>(dend) <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(hclust.dyn)[<span class="fu">order.dendrogram</span>(dend)]</span>
<span id="cb193-4"><a href="scrna-seq-data-analysis-overview.html#cb193-4" tabindex="-1"></a><span class="fu">plot</span>(dend)</span></code></pre></div>
<p><img src="_main_files/figure-html/cut_dendogram-1.png" width="672" /></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="scrna-seq-data-analysis-overview.html#cb194-1" tabindex="-1"></a></span>
<span id="cb194-2"><a href="scrna-seq-data-analysis-overview.html#cb194-2" tabindex="-1"></a><span class="do">## Obtain assignations and plot TSNE</span></span>
<span id="cb194-3"><a href="scrna-seq-data-analysis-overview.html#cb194-3" tabindex="-1"></a><span class="fu">colLabels</span>(sce<span class="fl">.416</span>b) <span class="ot">&lt;-</span> <span class="fu">factor</span>(hclust.dyn)</span>
<span id="cb194-4"><a href="scrna-seq-data-analysis-overview.html#cb194-4" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce<span class="fl">.416</span>b, <span class="st">&quot;TSNE&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/cut_dendogram-2.png" width="672" /></p>
</div>
<div id="subclustering" class="section level3 hasAnchor" number="11.8.4">
<h3><span class="header-section-number">11.8.4</span> Subclustering<a href="scrna-seq-data-analysis-overview.html#subclustering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another simple approach to improving resolution is to repeat the feature selection and clustering within a single cluster. This aims to select HVGs and PCs that are more relevant to internal structure, improving resolution by avoiding noise from unnecessary features. Subsetting also encourages clustering methods to separate cells according to more modest heterogeneity in the absence of distinct subpopulations.</p>
</div>
</div>
<div id="marker-gene-detection" class="section level2 hasAnchor" number="11.9">
<h2><span class="header-section-number">11.9</span> Marker gene detection<a href="scrna-seq-data-analysis-overview.html#marker-gene-detection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To interpret our clustering results, we need to identify the genes that drive separation between clusters. These marker genes allow us to assign biological meaning to each cluster based on their functional annotation. In the simplest case, we have <em>a priori</em> knowledge of the marker genes associated with particular cell types, allowing us to treat the clustering as a proxy for cell type identity.</p>
<p>The same principle can be applied to discover more subtle differences between clusters (e.g., changes in activation or differentiation state) based on the behavior of genes in the affected pathways.</p>
<p>The most straightforward approach to marker gene detection involves testing for differential expression between clusters. If a gene is strongly DE between clusters, it is likely to have driven the separation of cells in the clustering algorithm.</p>
<p>Several methods are available to quantify the differences in expression profiles between clusters and obtain a single ranking of genes for each cluster.</p>
<div id="scoring-markers-by-pairwise-comparisons" class="section level3 hasAnchor" number="11.9.1">
<h3><span class="header-section-number">11.9.1</span> Scoring markers by pairwise comparisons<a href="scrna-seq-data-analysis-overview.html#scoring-markers-by-pairwise-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our general strategy is to compare each pair of clusters and compute scores quantifying the differences in the expression distributions between clusters. The scores for all pairwise comparisons involving a particular cluster are then consolidated into a single <code>DataFrame</code> for that cluster.</p>
<p>The <code>scoreMarkers()</code> function from <code>scran</code> returns a list of DataFrames, where each DataFrame corresponds to a cluster and each row of the DataFrame corresponds to a gene.</p>
<p>In the DataFrame for cluster “X”, the columns contain</p>
<ul>
<li>the “self.average”: the mean log-expression in “X”</li>
<li>“other.average”: the grand mean across all other clusters</li>
<li>self.detected: the proportion of cells with detected expression in “X”</li>
<li>other.detected: the mean detected proportion across all other clusters</li>
<li>a variety of effect size summaries generated from all pairwise comparisons involving “X”</li>
</ul>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="scrna-seq-data-analysis-overview.html#cb195-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb195-2"><a href="scrna-seq-data-analysis-overview.html#cb195-2" tabindex="-1"></a></span>
<span id="cb195-3"><a href="scrna-seq-data-analysis-overview.html#cb195-3" tabindex="-1"></a><span class="do">## Scoring markers by pairwise comparisons</span></span>
<span id="cb195-4"><a href="scrna-seq-data-analysis-overview.html#cb195-4" tabindex="-1"></a>marker.info <span class="ot">&lt;-</span> <span class="fu">scoreMarkers</span>(sce.zeisel, <span class="fu">colLabels</span>(sce.zeisel))</span>
<span id="cb195-5"><a href="scrna-seq-data-analysis-overview.html#cb195-5" tabindex="-1"></a>marker.info</span>
<span id="cb195-6"><a href="scrna-seq-data-analysis-overview.html#cb195-6" tabindex="-1"></a><span class="co">#&gt; List of length 5</span></span>
<span id="cb195-7"><a href="scrna-seq-data-analysis-overview.html#cb195-7" tabindex="-1"></a><span class="co">#&gt; names(5): 1 2 3 4 5</span></span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="scrna-seq-data-analysis-overview.html#cb196-1" tabindex="-1"></a></span>
<span id="cb196-2"><a href="scrna-seq-data-analysis-overview.html#cb196-2" tabindex="-1"></a><span class="do">## Statistics for cluster 1</span></span>
<span id="cb196-3"><a href="scrna-seq-data-analysis-overview.html#cb196-3" tabindex="-1"></a><span class="fu">colnames</span>(marker.info[[<span class="st">&quot;1&quot;</span>]])</span>
<span id="cb196-4"><a href="scrna-seq-data-analysis-overview.html#cb196-4" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;self.average&quot;          &quot;other.average&quot;         &quot;self.detected&quot;         &quot;other.detected&quot;       </span></span>
<span id="cb196-5"><a href="scrna-seq-data-analysis-overview.html#cb196-5" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;mean.logFC.cohen&quot;      &quot;min.logFC.cohen&quot;       &quot;median.logFC.cohen&quot;    &quot;max.logFC.cohen&quot;      </span></span>
<span id="cb196-6"><a href="scrna-seq-data-analysis-overview.html#cb196-6" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;rank.logFC.cohen&quot;      &quot;mean.AUC&quot;              &quot;min.AUC&quot;               &quot;median.AUC&quot;           </span></span>
<span id="cb196-7"><a href="scrna-seq-data-analysis-overview.html#cb196-7" tabindex="-1"></a><span class="co">#&gt; [13] &quot;max.AUC&quot;               &quot;rank.AUC&quot;              &quot;mean.logFC.detected&quot;   &quot;min.logFC.detected&quot;   </span></span>
<span id="cb196-8"><a href="scrna-seq-data-analysis-overview.html#cb196-8" tabindex="-1"></a><span class="co">#&gt; [17] &quot;median.logFC.detected&quot; &quot;max.logFC.detected&quot;    &quot;rank.logFC.detected&quot;</span></span></code></pre></div>
<p>For each cluster, we can then rank candidate markers based on one of these effect size summaries</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="scrna-seq-data-analysis-overview.html#cb197-1" tabindex="-1"></a><span class="do">## Subset to the first cluster</span></span>
<span id="cb197-2"><a href="scrna-seq-data-analysis-overview.html#cb197-2" tabindex="-1"></a>chosen <span class="ot">&lt;-</span> marker.info[[<span class="st">&quot;1&quot;</span>]]</span>
<span id="cb197-3"><a href="scrna-seq-data-analysis-overview.html#cb197-3" tabindex="-1"></a></span>
<span id="cb197-4"><a href="scrna-seq-data-analysis-overview.html#cb197-4" tabindex="-1"></a><span class="do">## Rank candidate markers based on one of these effect size summaries</span></span>
<span id="cb197-5"><a href="scrna-seq-data-analysis-overview.html#cb197-5" tabindex="-1"></a>ordered <span class="ot">&lt;-</span> chosen[<span class="fu">order</span>(chosen<span class="sc">$</span>mean.AUC, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb197-6"><a href="scrna-seq-data-analysis-overview.html#cb197-6" tabindex="-1"></a><span class="fu">head</span>(ordered[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb197-7"><a href="scrna-seq-data-analysis-overview.html#cb197-7" tabindex="-1"></a><span class="co">#&gt; DataFrame with 6 rows and 4 columns</span></span>
<span id="cb197-8"><a href="scrna-seq-data-analysis-overview.html#cb197-8" tabindex="-1"></a><span class="co">#&gt;         self.average other.average self.detected other.detected</span></span>
<span id="cb197-9"><a href="scrna-seq-data-analysis-overview.html#cb197-9" tabindex="-1"></a><span class="co">#&gt;            &lt;numeric&gt;     &lt;numeric&gt;     &lt;numeric&gt;      &lt;numeric&gt;</span></span>
<span id="cb197-10"><a href="scrna-seq-data-analysis-overview.html#cb197-10" tabindex="-1"></a><span class="co">#&gt; Cst3         6.16324      2.721622      0.977901       0.895103</span></span>
<span id="cb197-11"><a href="scrna-seq-data-analysis-overview.html#cb197-11" tabindex="-1"></a><span class="co">#&gt; Sepp1        3.88488      0.830472      0.900552       0.297665</span></span>
<span id="cb197-12"><a href="scrna-seq-data-analysis-overview.html#cb197-12" tabindex="-1"></a><span class="co">#&gt; B2m          3.09863      0.820891      0.820442       0.468411</span></span>
<span id="cb197-13"><a href="scrna-seq-data-analysis-overview.html#cb197-13" tabindex="-1"></a><span class="co">#&gt; Sparcl1      5.54095      2.882289      0.930939       0.845173</span></span>
<span id="cb197-14"><a href="scrna-seq-data-analysis-overview.html#cb197-14" tabindex="-1"></a><span class="co">#&gt; Zfp36l1      2.48297      0.261565      0.723757       0.151524</span></span>
<span id="cb197-15"><a href="scrna-seq-data-analysis-overview.html#cb197-15" tabindex="-1"></a><span class="co">#&gt; Gng5         2.40613      0.603069      0.812155       0.320553</span></span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="scrna-seq-data-analysis-overview.html#cb198-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb198-2"><a href="scrna-seq-data-analysis-overview.html#cb198-2" tabindex="-1"></a></span>
<span id="cb198-3"><a href="scrna-seq-data-analysis-overview.html#cb198-3" tabindex="-1"></a><span class="do">## Plot the marker gene expression by label</span></span>
<span id="cb198-4"><a href="scrna-seq-data-analysis-overview.html#cb198-4" tabindex="-1"></a><span class="fu">plotExpression</span>(sce.zeisel,</span>
<span id="cb198-5"><a href="scrna-seq-data-analysis-overview.html#cb198-5" tabindex="-1"></a>    <span class="at">features =</span> <span class="fu">head</span>(<span class="fu">rownames</span>(ordered)),</span>
<span id="cb198-6"><a href="scrna-seq-data-analysis-overview.html#cb198-6" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;label&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;label&quot;</span></span>
<span id="cb198-7"><a href="scrna-seq-data-analysis-overview.html#cb198-7" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_markergenes1-1.png" width="672" /></p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="scrna-seq-data-analysis-overview.html#cb199-1" tabindex="-1"></a><span class="co"># Distribution of expression values across clusters for the top potential</span></span>
<span id="cb199-2"><a href="scrna-seq-data-analysis-overview.html#cb199-2" tabindex="-1"></a><span class="co"># marker genes (as determined by the mean AUC) for cluster 1</span></span></code></pre></div>
<p>Here, we deliberately use pairwise comparisons rather than comparing each cluster to the average of all other cells. The latter approach is sensitive to the population composition, which introduces an element of unpredictability to the marker sets due to variation in cell type abundances.</p>
<p>In the worst case, the presence of one sub-population containing a majority of the cells will drive the selection of top markers for every other cluster, pushing out useful genes that can distinguish between the smaller sub-populations.</p>
</div>
<div id="effect-sizes-for-pairwise-comparisons" class="section level3 hasAnchor" number="11.9.2">
<h3><span class="header-section-number">11.9.2</span> Effect sizes for pairwise comparisons<a href="scrna-seq-data-analysis-overview.html#effect-sizes-for-pairwise-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The AUC or Cohen’s <em>d</em> is usually the best choice for general purpose marker detection, as they are effective regardless of the magnitude of the expression values. The log-fold change in the detected proportion is specifically useful for identifying binary changes in expression.</p>
<p><strong>AUC</strong></p>
<p>In the context of marker detection, the area under the curve (AUC) quantifies our ability to distinguish between two distributions in a pairwise comparison. The AUC represents the probability that a randomly chosen observation from our cluster of interest is greater than a randomly chosen observation from the other cluster.</p>
<ul>
<li>A value of 1 corresponds to upregulation, where all values of our cluster of interest are greater than any value from the other cluster</li>
<li>A value of 0.5 means that there is no net difference in the location of the distributions</li>
<li>A value of 0 corresponds to downregulation</li>
</ul>
<p><em>he AUC is closely related to the U-statistic in the Wilcoxon ranked sum test (a.k.a., Mann-Whitney U-test).</em></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="scrna-seq-data-analysis-overview.html#cb200-1" tabindex="-1"></a><span class="do">## Subset the AUC from the candidate markers of cluster 1 info</span></span>
<span id="cb200-2"><a href="scrna-seq-data-analysis-overview.html#cb200-2" tabindex="-1"></a><span class="do">## and rank (by AUC)</span></span>
<span id="cb200-3"><a href="scrna-seq-data-analysis-overview.html#cb200-3" tabindex="-1"></a>auc.only <span class="ot">&lt;-</span> chosen[, <span class="fu">grepl</span>(<span class="st">&quot;AUC&quot;</span>, <span class="fu">colnames</span>(chosen))]</span>
<span id="cb200-4"><a href="scrna-seq-data-analysis-overview.html#cb200-4" tabindex="-1"></a>auc.only[<span class="fu">order</span>(auc.only<span class="sc">$</span>mean.AUC, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb200-5"><a href="scrna-seq-data-analysis-overview.html#cb200-5" tabindex="-1"></a><span class="co">#&gt; DataFrame with 19839 rows and 5 columns</span></span>
<span id="cb200-6"><a href="scrna-seq-data-analysis-overview.html#cb200-6" tabindex="-1"></a><span class="co">#&gt;           mean.AUC   min.AUC median.AUC   max.AUC  rank.AUC</span></span>
<span id="cb200-7"><a href="scrna-seq-data-analysis-overview.html#cb200-7" tabindex="-1"></a><span class="co">#&gt;          &lt;numeric&gt; &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;integer&gt;</span></span>
<span id="cb200-8"><a href="scrna-seq-data-analysis-overview.html#cb200-8" tabindex="-1"></a><span class="co">#&gt; Cst3      0.895187  0.858550   0.900951  0.920298         1</span></span>
<span id="cb200-9"><a href="scrna-seq-data-analysis-overview.html#cb200-9" tabindex="-1"></a><span class="co">#&gt; Sepp1     0.873234  0.723951   0.918144  0.932695         1</span></span>
<span id="cb200-10"><a href="scrna-seq-data-analysis-overview.html#cb200-10" tabindex="-1"></a><span class="co">#&gt; B2m       0.830457  0.794594   0.826349  0.874535         3</span></span>
<span id="cb200-11"><a href="scrna-seq-data-analysis-overview.html#cb200-11" tabindex="-1"></a><span class="co">#&gt; Sparcl1   0.829280  0.799851   0.816875  0.883517         2</span></span>
<span id="cb200-12"><a href="scrna-seq-data-analysis-overview.html#cb200-12" tabindex="-1"></a><span class="co">#&gt; Zfp36l1   0.828530  0.810392   0.827840  0.848047         3</span></span>
<span id="cb200-13"><a href="scrna-seq-data-analysis-overview.html#cb200-13" tabindex="-1"></a><span class="co">#&gt; ...            ...       ...        ...       ...       ...</span></span>
<span id="cb200-14"><a href="scrna-seq-data-analysis-overview.html#cb200-14" tabindex="-1"></a><span class="co">#&gt; Hsp90aa1 0.1054120 0.0623657  0.0905663 0.1781496     19655</span></span>
<span id="cb200-15"><a href="scrna-seq-data-analysis-overview.html#cb200-15" tabindex="-1"></a><span class="co">#&gt; Scg5     0.1033219 0.0193178  0.0312032 0.3315632     19249</span></span>
<span id="cb200-16"><a href="scrna-seq-data-analysis-overview.html#cb200-16" tabindex="-1"></a><span class="co">#&gt; Snurf    0.0876293 0.0140424  0.0358926 0.2646899     19529</span></span>
<span id="cb200-17"><a href="scrna-seq-data-analysis-overview.html#cb200-17" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 2 rows ]</span></span></code></pre></div>
<p><strong>Cohen’s <em>d</em> </strong></p>
<p>Cohen’s <strong>d</strong> is a standardized log-fold change where the difference in the mean log-expression between groups is scaled by the average standard deviation across groups. In other words, it is the number of standard deviations that separate the means of the two groups.</p>
<p>The interpretation is similar to the log-fold change:</p>
<ul>
<li>Positive values indicate that the gene is upregulated in our cluster of interest</li>
<li>Negative values indicate downregulation</li>
<li>values close to zero indicate that there is little difference.</li>
</ul>
<p>Cohen’s <strong>d</strong> is roughly analogous to the t-statistic in various two-sample t-tests.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="scrna-seq-data-analysis-overview.html#cb201-1" tabindex="-1"></a><span class="do">## Subset the &quot;logFC.cohen&quot; from the candidate markers of cluster 1 info</span></span>
<span id="cb201-2"><a href="scrna-seq-data-analysis-overview.html#cb201-2" tabindex="-1"></a><span class="do">## and rank (by Cohen’s d)</span></span>
<span id="cb201-3"><a href="scrna-seq-data-analysis-overview.html#cb201-3" tabindex="-1"></a>cohen.only <span class="ot">&lt;-</span> chosen[, <span class="fu">grepl</span>(<span class="st">&quot;logFC.cohen&quot;</span>, <span class="fu">colnames</span>(chosen))]</span>
<span id="cb201-4"><a href="scrna-seq-data-analysis-overview.html#cb201-4" tabindex="-1"></a>cohen.only[<span class="fu">order</span>(cohen.only<span class="sc">$</span>mean.logFC.cohen, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb201-5"><a href="scrna-seq-data-analysis-overview.html#cb201-5" tabindex="-1"></a><span class="co">#&gt; DataFrame with 19839 rows and 5 columns</span></span>
<span id="cb201-6"><a href="scrna-seq-data-analysis-overview.html#cb201-6" tabindex="-1"></a><span class="co">#&gt;         mean.logFC.cohen min.logFC.cohen median.logFC.cohen max.logFC.cohen rank.logFC.cohen</span></span>
<span id="cb201-7"><a href="scrna-seq-data-analysis-overview.html#cb201-7" tabindex="-1"></a><span class="co">#&gt;                &lt;numeric&gt;       &lt;numeric&gt;          &lt;numeric&gt;       &lt;numeric&gt;        &lt;integer&gt;</span></span>
<span id="cb201-8"><a href="scrna-seq-data-analysis-overview.html#cb201-8" tabindex="-1"></a><span class="co">#&gt; Sepp1            2.00527        0.887739            2.29849         2.53635                1</span></span>
<span id="cb201-9"><a href="scrna-seq-data-analysis-overview.html#cb201-9" tabindex="-1"></a><span class="co">#&gt; Cst3             1.77874        1.501392            1.82252         1.96852                1</span></span>
<span id="cb201-10"><a href="scrna-seq-data-analysis-overview.html#cb201-10" tabindex="-1"></a><span class="co">#&gt; Gng5             1.66122        0.538738            1.94492         2.21630                2</span></span>
<span id="cb201-11"><a href="scrna-seq-data-analysis-overview.html#cb201-11" tabindex="-1"></a><span class="co">#&gt; Zfp36l1          1.63278        1.459939            1.63000         1.81116                3</span></span>
<span id="cb201-12"><a href="scrna-seq-data-analysis-overview.html#cb201-12" tabindex="-1"></a><span class="co">#&gt; Apoe             1.58840        1.309029            1.61529         1.81402                5</span></span>
<span id="cb201-13"><a href="scrna-seq-data-analysis-overview.html#cb201-13" tabindex="-1"></a><span class="co">#&gt; ...                  ...             ...                ...             ...              ...</span></span>
<span id="cb201-14"><a href="scrna-seq-data-analysis-overview.html#cb201-14" tabindex="-1"></a><span class="co">#&gt; Rab3a           -2.80064        -3.94223           -3.35880       -0.542752            18990</span></span>
<span id="cb201-15"><a href="scrna-seq-data-analysis-overview.html#cb201-15" tabindex="-1"></a><span class="co">#&gt; Mllt11          -2.83899        -4.53504           -3.18120       -0.458515            18737</span></span>
<span id="cb201-16"><a href="scrna-seq-data-analysis-overview.html#cb201-16" tabindex="-1"></a><span class="co">#&gt; Acot7           -2.97134        -3.41241           -2.85837       -2.756219            19766</span></span>
<span id="cb201-17"><a href="scrna-seq-data-analysis-overview.html#cb201-17" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 2 rows ]</span></span></code></pre></div>
<p><strong>log-fold change</strong></p>
<p>Finally, we also compute the log-fold change in the proportion of cells with detected expression between clusters. This ignores any information about the magnitude of expression, <em>only considering whether any expression is detected at all</em>. Again, positive values indicate that a greater proportion of cells express the gene in our cluster of interest compared to the other cluster.</p>
<p><em>Note that a pseudo-count is added to avoid undefined log-fold changes when no cells express the gene in either group.</em></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="scrna-seq-data-analysis-overview.html#cb202-1" tabindex="-1"></a><span class="do">## Subset the &quot;logFC.detected&quot; from the candidate markers of cluster 1 info</span></span>
<span id="cb202-2"><a href="scrna-seq-data-analysis-overview.html#cb202-2" tabindex="-1"></a><span class="do">## and rank (by log-fold change)</span></span>
<span id="cb202-3"><a href="scrna-seq-data-analysis-overview.html#cb202-3" tabindex="-1"></a>detect.only <span class="ot">&lt;-</span> chosen[, <span class="fu">grepl</span>(<span class="st">&quot;logFC.detected&quot;</span>, <span class="fu">colnames</span>(chosen))]</span>
<span id="cb202-4"><a href="scrna-seq-data-analysis-overview.html#cb202-4" tabindex="-1"></a>detect.only[<span class="fu">order</span>(detect.only<span class="sc">$</span>mean.logFC.detected, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb202-5"><a href="scrna-seq-data-analysis-overview.html#cb202-5" tabindex="-1"></a><span class="co">#&gt; DataFrame with 19839 rows and 5 columns</span></span>
<span id="cb202-6"><a href="scrna-seq-data-analysis-overview.html#cb202-6" tabindex="-1"></a><span class="co">#&gt;               mean.logFC.detected min.logFC.detected median.logFC.detected max.logFC.detected rank.logFC.detected</span></span>
<span id="cb202-7"><a href="scrna-seq-data-analysis-overview.html#cb202-7" tabindex="-1"></a><span class="co">#&gt;                         &lt;numeric&gt;          &lt;numeric&gt;             &lt;numeric&gt;          &lt;numeric&gt;           &lt;integer&gt;</span></span>
<span id="cb202-8"><a href="scrna-seq-data-analysis-overview.html#cb202-8" tabindex="-1"></a><span class="co">#&gt; Hhex                      3.88701            3.18636               3.73608            4.88952                   2</span></span>
<span id="cb202-9"><a href="scrna-seq-data-analysis-overview.html#cb202-9" tabindex="-1"></a><span class="co">#&gt; Ly6f                      3.80886            2.62872               3.98527            4.63618                   3</span></span>
<span id="cb202-10"><a href="scrna-seq-data-analysis-overview.html#cb202-10" tabindex="-1"></a><span class="co">#&gt; 9030619P08Rik             3.74819            2.62200               3.76970            4.83137                   1</span></span>
<span id="cb202-11"><a href="scrna-seq-data-analysis-overview.html#cb202-11" tabindex="-1"></a><span class="co">#&gt; Casp8                     3.69939            2.49673               3.34698            5.60688                   3</span></span>
<span id="cb202-12"><a href="scrna-seq-data-analysis-overview.html#cb202-12" tabindex="-1"></a><span class="co">#&gt; Kcne1l                    3.60801            2.17477               3.75120            4.75489                   1</span></span>
<span id="cb202-13"><a href="scrna-seq-data-analysis-overview.html#cb202-13" tabindex="-1"></a><span class="co">#&gt; ...                           ...                ...                   ...                ...                 ...</span></span>
<span id="cb202-14"><a href="scrna-seq-data-analysis-overview.html#cb202-14" tabindex="-1"></a><span class="co">#&gt; Slc35f4                  -4.98323           -5.85599              -5.40401           -3.26891               19695</span></span>
<span id="cb202-15"><a href="scrna-seq-data-analysis-overview.html#cb202-15" tabindex="-1"></a><span class="co">#&gt; 2900079G21Rik            -5.03133           -5.99641              -5.44274           -3.24343               19688</span></span>
<span id="cb202-16"><a href="scrna-seq-data-analysis-overview.html#cb202-16" tabindex="-1"></a><span class="co">#&gt; D630023F18Rik            -5.16180           -6.71692              -5.63179           -2.66670               19516</span></span>
<span id="cb202-17"><a href="scrna-seq-data-analysis-overview.html#cb202-17" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 2 rows ]</span></span></code></pre></div>
<p>The AUC or Cohen’s <em>d</em> is usually the best choice for general purpose marker detection, as they are effective regardless of the magnitude of the expression values. The log-fold change in the detected proportion is specifically useful for identifying binary changes in expression.</p>
</div>
<div id="summaries-of-pairwise-effects" class="section level3 hasAnchor" number="11.9.3">
<h3><span class="header-section-number">11.9.3</span> Summaries of pairwise effects<a href="scrna-seq-data-analysis-overview.html#summaries-of-pairwise-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a dataset with “N” clusters, each cluster is associated with “N” − 1 values for each type of effect size described. To simplify interpretation, we summarize the effects for each cluster into some key statistics such as the mean and median.</p>
<p>Each summary statistic has a different interpretation when used for ranking:</p>
<ul>
<li><p><strong>mean</strong>: The most obvious summary statistic is the mean. For cluster “X”, a large mean effect size (&gt;0 for the log-fold changes, &gt;0.5 for the AUCs) indicates that the gene is upregulated in “X” compared to the average of the other groups.</p></li>
<li><p><strong>median</strong>: a large value indicates that the gene is upregulated in “X” compared to most (&gt;50%) other clusters. The median provides greater robustness to outliers than the mean, which may or may not be desirable. On one hand, the median avoids an inflated effect size if only a minority of comparisons have large effects; on the other hand, it will also overstate the effect size by ignoring a minority of comparisons that have opposing effects.</p></li>
<li><p><strong>minimum value:</strong> The minimum value (min.*) is the most stringent summary for identifying upregulated genes, as a large value indicates that the gene is upregulated in “X” compared to all other clusters. Conversely, if the minimum is small (&lt;0 for the log-fold changes, &lt;0.5 for the AUCs), we can conclude that the gene is downregulated in “X” compared to at least one other cluster.</p></li>
<li><p><strong>maximum value:</strong> The maximum value (max.*) is the least stringent summary for identifying upregulated genes, as a large value can be obtained if there is strong upregulation in “X” compared to any other cluster. Conversely, if the maximum is small, we can conclude that the gene is downregulated in “X” compared to all other clusters.</p></li>
<li><p><strong>minimum rank:</strong> The minimum rank, a.k.a., “min-rank” (rank.*) is the smallest rank of each gene across all pairwise comparisons. Specifically, genes are ranked within each pairwise comparison based on decreasing effect size, and then the smallest rank across all comparisons is reported for each gene. If a gene has a small min-rank, we can conclude that it is one of the top upregulated genes in at least one comparison of “X” to another cluster.</p></li>
</ul>
<p>Each of these summaries is computed for each effect size, for each gene, and for each cluster.</p>
<p>Our next step is to choose one of these summary statistics for one of the effect sizes and to use it to rank the rows of the DataFrame. For identifying upregulated genes, ranking by the minimum is the most stringent and the maximum is the least stringent; the mean and median fall somewhere in between and are reasonable defaults for most applications.</p>
</div>
<div id="choose-top-markers" class="section level3 hasAnchor" number="11.9.4">
<h3><span class="header-section-number">11.9.4</span> Choose top markers<a href="scrna-seq-data-analysis-overview.html#choose-top-markers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>To continue or example, we will use the the median Cohen’s d to obtain a ranking of the marker genes</em></p>
<p>Now that we have them ranked, we can choose how many of them are interesting to us. For this example, wi will stay with only the set of markers in which Cohen’s <em>d</em> derived min-ranks is less than or equal to 5.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="scrna-seq-data-analysis-overview.html#cb203-1" tabindex="-1"></a><span class="do">## Order the candidate markers by &quot;rank.logFC.cohen&quot; for each cluster</span></span>
<span id="cb203-2"><a href="scrna-seq-data-analysis-overview.html#cb203-2" tabindex="-1"></a>ordered <span class="ot">&lt;-</span> chosen[<span class="fu">order</span>(chosen<span class="sc">$</span>rank.logFC.cohen), ]</span>
<span id="cb203-3"><a href="scrna-seq-data-analysis-overview.html#cb203-3" tabindex="-1"></a></span>
<span id="cb203-4"><a href="scrna-seq-data-analysis-overview.html#cb203-4" tabindex="-1"></a><span class="do">## Choose the top marker genes for each cluster</span></span>
<span id="cb203-5"><a href="scrna-seq-data-analysis-overview.html#cb203-5" tabindex="-1"></a>top.ranked <span class="ot">&lt;-</span> ordered[ordered<span class="sc">$</span>rank.logFC.cohen <span class="sc">&lt;=</span> <span class="dv">10</span>, ]</span>
<span id="cb203-6"><a href="scrna-seq-data-analysis-overview.html#cb203-6" tabindex="-1"></a><span class="fu">rownames</span>(top.ranked) <span class="co"># Gene names</span></span>
<span id="cb203-7"><a href="scrna-seq-data-analysis-overview.html#cb203-7" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Cst3&quot;     &quot;Sepp1&quot;    &quot;Gng5&quot;     &quot;Sparcl1&quot;  &quot;B2m&quot;      &quot;Zfp36l1&quot;  &quot;Atp1a2&quot;   &quot;Qk&quot;       &quot;Apoe&quot;     &quot;Id3&quot;     </span></span>
<span id="cb203-8"><a href="scrna-seq-data-analysis-overview.html#cb203-8" tabindex="-1"></a><span class="co">#&gt; [11] &quot;Sat1&quot;     &quot;Sparc&quot;    &quot;Cd63&quot;     &quot;Epas1&quot;    &quot;Slco1c1&quot;  &quot;Glul&quot;     &quot;Gstm1&quot;    &quot;Mt1&quot;      &quot;Serpine2&quot;</span></span></code></pre></div>
<p>We can also plot the expression in a Heat Map:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="scrna-seq-data-analysis-overview.html#cb204-1" tabindex="-1"></a><span class="do">## Plot a heatmap for the expression of some top marker genes for each cluster</span></span>
<span id="cb204-2"><a href="scrna-seq-data-analysis-overview.html#cb204-2" tabindex="-1"></a><span class="fu">plotGroupedHeatmap</span>(sce.zeisel,</span>
<span id="cb204-3"><a href="scrna-seq-data-analysis-overview.html#cb204-3" tabindex="-1"></a>    <span class="at">features =</span> <span class="fu">rownames</span>(top.ranked), <span class="at">group =</span> <span class="st">&quot;label&quot;</span>,</span>
<span id="cb204-4"><a href="scrna-seq-data-analysis-overview.html#cb204-4" tabindex="-1"></a>    <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">zlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb204-5"><a href="scrna-seq-data-analysis-overview.html#cb204-5" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/top_markers_heatmap-1.png" width="672" /></p>
</div>
<div id="using-a-log-fold-change-threshold" class="section level3 hasAnchor" number="11.9.5">
<h3><span class="header-section-number">11.9.5</span> Using a log-fold change threshold<a href="scrna-seq-data-analysis-overview.html#using-a-log-fold-change-threshold" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Cohen’s <em>d</em> and AUC calculations consider both the magnitude of the difference between clusters as well as the variability within each cluster.</p>
<p>If the variability is lower, it is possible for a gene to have a large effect size even if the magnitude of the difference is small.</p>
<p>These genes tend to be somewhat uninformative for cell type identification despite their strong differential expression (e.g., ribosomal protein genes). We would prefer genes with larger log-fold changes between clusters, even if they have higher variability.</p>
<p>To favor the detection of such genes, we can compute the effect sizes relative to a log-fold change threshold by setting <code>lfc=</code> in <code>scoreMarkers()</code>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="scrna-seq-data-analysis-overview.html#cb205-1" tabindex="-1"></a><span class="do">## Scoring markers by pairwise comparisons (effect sizes relative to a log-fold change)</span></span>
<span id="cb205-2"><a href="scrna-seq-data-analysis-overview.html#cb205-2" tabindex="-1"></a>marker.info.lfc <span class="ot">&lt;-</span> <span class="fu">scoreMarkers</span>(sce.zeisel, <span class="fu">colLabels</span>(sce.zeisel), <span class="at">lfc =</span> <span class="dv">2</span>)</span>
<span id="cb205-3"><a href="scrna-seq-data-analysis-overview.html#cb205-3" tabindex="-1"></a></span>
<span id="cb205-4"><a href="scrna-seq-data-analysis-overview.html#cb205-4" tabindex="-1"></a><span class="do">## Statistics for cluster 1</span></span>
<span id="cb205-5"><a href="scrna-seq-data-analysis-overview.html#cb205-5" tabindex="-1"></a>chosen2 <span class="ot">&lt;-</span> marker.info.lfc[[<span class="st">&quot;1&quot;</span>]]</span>
<span id="cb205-6"><a href="scrna-seq-data-analysis-overview.html#cb205-6" tabindex="-1"></a><span class="do">## Rank info from cluster 1 by mean.AUC</span></span>
<span id="cb205-7"><a href="scrna-seq-data-analysis-overview.html#cb205-7" tabindex="-1"></a>chosen2 <span class="ot">&lt;-</span> chosen2[<span class="fu">order</span>(chosen2<span class="sc">$</span>mean.AUC, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb205-8"><a href="scrna-seq-data-analysis-overview.html#cb205-8" tabindex="-1"></a>chosen2[, <span class="fu">c</span>(<span class="st">&quot;self.average&quot;</span>, <span class="st">&quot;other.average&quot;</span>, <span class="st">&quot;mean.AUC&quot;</span>)] <span class="co"># Check &quot;self.average&quot;, &quot;other.average&quot;, &quot;mean.AUC&quot;</span></span>
<span id="cb205-9"><a href="scrna-seq-data-analysis-overview.html#cb205-9" tabindex="-1"></a><span class="co">#&gt; DataFrame with 19839 rows and 3 columns</span></span>
<span id="cb205-10"><a href="scrna-seq-data-analysis-overview.html#cb205-10" tabindex="-1"></a><span class="co">#&gt;         self.average other.average  mean.AUC</span></span>
<span id="cb205-11"><a href="scrna-seq-data-analysis-overview.html#cb205-11" tabindex="-1"></a><span class="co">#&gt;            &lt;numeric&gt;     &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span id="cb205-12"><a href="scrna-seq-data-analysis-overview.html#cb205-12" tabindex="-1"></a><span class="co">#&gt; Sepp1        3.88488      0.830472  0.716022</span></span>
<span id="cb205-13"><a href="scrna-seq-data-analysis-overview.html#cb205-13" tabindex="-1"></a><span class="co">#&gt; Cst3         6.16324      2.721622  0.706665</span></span>
<span id="cb205-14"><a href="scrna-seq-data-analysis-overview.html#cb205-14" tabindex="-1"></a><span class="co">#&gt; Atp1a2       4.54695      0.995355  0.680076</span></span>
<span id="cb205-15"><a href="scrna-seq-data-analysis-overview.html#cb205-15" tabindex="-1"></a><span class="co">#&gt; Apoe         4.44418      0.619766  0.667839</span></span>
<span id="cb205-16"><a href="scrna-seq-data-analysis-overview.html#cb205-16" tabindex="-1"></a><span class="co">#&gt; Sparc        3.71278      0.625208  0.642240</span></span>
<span id="cb205-17"><a href="scrna-seq-data-analysis-overview.html#cb205-17" tabindex="-1"></a><span class="co">#&gt; ...              ...           ...       ...</span></span>
<span id="cb205-18"><a href="scrna-seq-data-analysis-overview.html#cb205-18" tabindex="-1"></a><span class="co">#&gt; Zscan4b   0.00000000   0.000835435         0</span></span>
<span id="cb205-19"><a href="scrna-seq-data-analysis-overview.html#cb205-19" tabindex="-1"></a><span class="co">#&gt; Zscan4e   0.00000000   0.000977365         0</span></span>
<span id="cb205-20"><a href="scrna-seq-data-analysis-overview.html#cb205-20" tabindex="-1"></a><span class="co">#&gt; Zscan4f   0.00000000   0.001098376         0</span></span>
<span id="cb205-21"><a href="scrna-seq-data-analysis-overview.html#cb205-21" tabindex="-1"></a><span class="co">#&gt; Zswim5    0.01622302   0.059746058         0</span></span>
<span id="cb205-22"><a href="scrna-seq-data-analysis-overview.html#cb205-22" tabindex="-1"></a><span class="co">#&gt; Zyg11a    0.00451334   0.001709500         0</span></span></code></pre></div>
<p>We can also create something a little bit different. Here we have a dot plot of the top potential marker genes (as determined by the mean AUC) for cluster 1.</p>
<ul>
<li>Each row corrresponds to a marker gene and each column corresponds to a cluster.</li>
<li>The size of each dot represents the proportion of cells with detected expression of the gene in the cluster.</li>
<li>The color is proportional to the average expression across all cells in that cluster.</li>
</ul>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="scrna-seq-data-analysis-overview.html#cb206-1" tabindex="-1"></a><span class="do">## Dot plot for the potential top markers for cluster 1</span></span>
<span id="cb206-2"><a href="scrna-seq-data-analysis-overview.html#cb206-2" tabindex="-1"></a><span class="fu">plotDots</span>(sce.zeisel, <span class="fu">rownames</span>(chosen2)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="at">group =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotDots_markers-1.png" width="672" /></p>
</div>
<div id="handling-blocking-factors" class="section level3 hasAnchor" number="11.9.6">
<h3><span class="header-section-number">11.9.6</span> Handling blocking factors<a href="scrna-seq-data-analysis-overview.html#handling-blocking-factors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some studies may contain factors of variation that are known and not interesting (e.g., batch effects, sex differences). If these are not modelled, they can interfere with marker gene detection, most obviously by inflating the variance within each cluster, but also by distorting the log-fold changes if the cluster composition varies across levels of the blocking factor.</p>
<p>To avoid these issues, we specify the blocking factor via the block= argument</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="scrna-seq-data-analysis-overview.html#cb207-1" tabindex="-1"></a><span class="do">## Scoring markers by pairwise comparisons using a block  factor (tissue)</span></span>
<span id="cb207-2"><a href="scrna-seq-data-analysis-overview.html#cb207-2" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">scoreMarkers</span>(sce.zeisel, <span class="fu">colLabels</span>(sce.zeisel), <span class="at">block =</span> sce.zeisel<span class="sc">$</span>tissue)</span></code></pre></div>
<p>For each gene, each pairwise comparison between clusters is performed separately in each level of the blocking factor - in this case, the plate of origin. By comparing within each batch, we cancel out any batch effects so that they are not conflated with the biological differences between subpopulations. The effect sizes are then averaged across batches to obtain a single value per comparison, using a weighted mean that accounts for the number of cells involved in the comparison in each batch.</p>
<p>A similar correction is applied to the mean log-expression and proportion of detected cells inside and outside each cluster.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="scrna-seq-data-analysis-overview.html#cb208-1" tabindex="-1"></a><span class="do">## Subset the info for cluster 1</span></span>
<span id="cb208-2"><a href="scrna-seq-data-analysis-overview.html#cb208-2" tabindex="-1"></a>demo <span class="ot">&lt;-</span> m.out[[<span class="st">&quot;1&quot;</span>]]</span>
<span id="cb208-3"><a href="scrna-seq-data-analysis-overview.html#cb208-3" tabindex="-1"></a><span class="do">## Order by the log-expression (which had a correction using block=sex)</span></span>
<span id="cb208-4"><a href="scrna-seq-data-analysis-overview.html#cb208-4" tabindex="-1"></a>ordered <span class="ot">&lt;-</span> demo[<span class="fu">order</span>(demo<span class="sc">$</span>median.logFC.cohen, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb208-5"><a href="scrna-seq-data-analysis-overview.html#cb208-5" tabindex="-1"></a>ordered[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb208-6"><a href="scrna-seq-data-analysis-overview.html#cb208-6" tabindex="-1"></a><span class="co">#&gt; DataFrame with 19839 rows and 4 columns</span></span>
<span id="cb208-7"><a href="scrna-seq-data-analysis-overview.html#cb208-7" tabindex="-1"></a><span class="co">#&gt;         self.average other.average self.detected other.detected</span></span>
<span id="cb208-8"><a href="scrna-seq-data-analysis-overview.html#cb208-8" tabindex="-1"></a><span class="co">#&gt;            &lt;numeric&gt;     &lt;numeric&gt;     &lt;numeric&gt;      &lt;numeric&gt;</span></span>
<span id="cb208-9"><a href="scrna-seq-data-analysis-overview.html#cb208-9" tabindex="-1"></a><span class="co">#&gt; Sepp1        3.50217      0.528293      0.825712       0.209078</span></span>
<span id="cb208-10"><a href="scrna-seq-data-analysis-overview.html#cb208-10" tabindex="-1"></a><span class="co">#&gt; Gng5         2.37150      0.575725      0.800459       0.311615</span></span>
<span id="cb208-11"><a href="scrna-seq-data-analysis-overview.html#cb208-11" tabindex="-1"></a><span class="co">#&gt; Cst3         6.45770      2.954119      0.981201       0.904447</span></span>
<span id="cb208-12"><a href="scrna-seq-data-analysis-overview.html#cb208-12" tabindex="-1"></a><span class="co">#&gt; Apoe         4.66651      0.795313      0.704185       0.186789</span></span>
<span id="cb208-13"><a href="scrna-seq-data-analysis-overview.html#cb208-13" tabindex="-1"></a><span class="co">#&gt; Zfp36l1      2.49179      0.268529      0.735299       0.156745</span></span>
<span id="cb208-14"><a href="scrna-seq-data-analysis-overview.html#cb208-14" tabindex="-1"></a><span class="co">#&gt; ...              ...           ...           ...            ...</span></span>
<span id="cb208-15"><a href="scrna-seq-data-analysis-overview.html#cb208-15" tabindex="-1"></a><span class="co">#&gt; Syp         0.238229       2.20762      0.148603       0.814644</span></span>
<span id="cb208-16"><a href="scrna-seq-data-analysis-overview.html#cb208-16" tabindex="-1"></a><span class="co">#&gt; Rab3a       0.475216       2.62944      0.219682       0.878967</span></span>
<span id="cb208-17"><a href="scrna-seq-data-analysis-overview.html#cb208-17" tabindex="-1"></a><span class="co">#&gt; Snap25      1.229693       4.40115      0.433556       0.882369</span></span>
<span id="cb208-18"><a href="scrna-seq-data-analysis-overview.html#cb208-18" tabindex="-1"></a><span class="co">#&gt; Stmn3       0.614814       3.75383      0.204414       0.840670</span></span>
<span id="cb208-19"><a href="scrna-seq-data-analysis-overview.html#cb208-19" tabindex="-1"></a><span class="co">#&gt; Ndrg4       0.664605       3.23414      0.240788       0.825395</span></span></code></pre></div>
<p>We can also plot our top marker genes expression now coloured by the block factor we used, in this case <code>"tissue"</code>.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="scrna-seq-data-analysis-overview.html#cb209-1" tabindex="-1"></a><span class="do">## In case we don´t have them as factors for the coloring</span></span>
<span id="cb209-2"><a href="scrna-seq-data-analysis-overview.html#cb209-2" tabindex="-1"></a>sce.zeisel<span class="sc">$</span>tissue <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(sce.zeisel<span class="sc">$</span>tissue)</span>
<span id="cb209-3"><a href="scrna-seq-data-analysis-overview.html#cb209-3" tabindex="-1"></a><span class="do">## Plot the top marker genes expression by tissue</span></span>
<span id="cb209-4"><a href="scrna-seq-data-analysis-overview.html#cb209-4" tabindex="-1"></a><span class="fu">plotExpression</span>(sce.zeisel,</span>
<span id="cb209-5"><a href="scrna-seq-data-analysis-overview.html#cb209-5" tabindex="-1"></a>    <span class="at">features =</span> <span class="fu">rownames</span>(ordered)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb209-6"><a href="scrna-seq-data-analysis-overview.html#cb209-6" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;label&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;tissue&quot;</span></span>
<span id="cb209-7"><a href="scrna-seq-data-analysis-overview.html#cb209-7" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot_markers_byblock-1.png" width="672" /></p>
<p>The <code>block=</code> argument works for all effect sizes shown above and is robust to differences in the log-fold changes or variance between batches.</p>
<p>However, it assumes that each pair of clusters is present in at least one batch. In scenarios where cells from two clusters never co-occur in the same batch, the associated pairwise comparison will be impossible and is ignored during calculation of summary statistics.</p>
</div>
<div id="deconvobuddies" class="section level3 hasAnchor" number="11.9.7">
<h3><span class="header-section-number">11.9.7</span> Deconvobuddies<a href="scrna-seq-data-analysis-overview.html#deconvobuddies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="scrna-seq-data-analysis-overview.html#cb210-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb210-2"><a href="scrna-seq-data-analysis-overview.html#cb210-2" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb210-3"><a href="scrna-seq-data-analysis-overview.html#cb210-3" tabindex="-1"></a>}</span>
<span id="cb210-4"><a href="scrna-seq-data-analysis-overview.html#cb210-4" tabindex="-1"></a></span>
<span id="cb210-5"><a href="scrna-seq-data-analysis-overview.html#cb210-5" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;DeconvoBuddies&quot;</span>)</span></code></pre></div>
<p><strong>findMarkers_1vAll()</strong></p>
<p>Calculate 1 vs. All standard fold change for each gene x cell type, wrapper function for <code>scran::findMarkers()</code></p>
<p><a href="https://research.libd.org/DeconvoBuddies/reference/findMarkers_1vAll.html" class="uri">https://research.libd.org/DeconvoBuddies/reference/findMarkers_1vAll.html</a></p>
<p><strong>get_mean_ratio()</strong></p>
<p>Calculate the mean ratio value and rank for each gene for each cell type in the <code>sce</code> object, to identify effective marker genes</p>
<p><a href="http://research.libd.org/DeconvoBuddies/reference/get_mean_ratio.html" class="uri">http://research.libd.org/DeconvoBuddies/reference/get_mean_ratio.html</a></p>
</div>
</div>
<div id="cell-type-annotation" class="section level2 hasAnchor" number="11.10">
<h2><span class="header-section-number">11.10</span> Cell type annotation<a href="scrna-seq-data-analysis-overview.html#cell-type-annotation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The most challenging task in scRNA-seq data analysis is arguably the interpretation of the results. Obtaining clusters of cells is fairly straightforward, but it is more difficult to determine what biological state is represented by each of those clusters. Doing so requires us to bridge the gap between the current dataset and prior biological knowledge, and the latter is not always available in a consistent and quantitative manner.</p>
<p><em>Even the concept of a “cell type” is not clearly defined :( </em>
Interpretation of scRNA-seq data is often manual and a common bottleneck in the analysis workflow.</p>
<p>To expedite this step, we can try to use various computational approaches that exploit prior information to assign meaning to an uncharacterized scRNA-seq dataset.</p>
<p>The most obvious sources of prior information are the curated gene sets associated with particular biological processes, e.g., from the Gene Ontology (GO) or the Kyoto Encyclopedia of Genes and Genomes (KEGG) collections. Alternatively, we could directly compare our expression profiles to published reference datasets where each sample or cell has already been annotated with its putative biological state by domain experts.</p>
<p><strong>It is important to have in mind that this step will largely depend on the amount of previous biological knowledge for your specific data set.</strong></p>
<p>The most obvious sources of prior information are the curated gene sets associated with particular biological processes, e.g., from the Gene Ontology (GO) or the Kyoto Encyclopedia of Genes and Genomes (KEGG) collections.</p>
<p>Alternatively, we can directly compare our expression profiles to published reference datasets where each sample or cell has already been annotated with its putative biological state by domain experts.</p>
<div id="assigning-cell-labels-from-reference-data" class="section level3 hasAnchor" number="11.10.1">
<h3><span class="header-section-number">11.10.1</span> Assigning cell labels from reference data<a href="scrna-seq-data-analysis-overview.html#assigning-cell-labels-from-reference-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A conceptually straightforward annotation approach is to compare the single-cell expression profiles with previously annotated reference datasets. Labels can then be assigned to each cell in our uncharacterized test dataset based on the most similar reference sample(s). This is a standard classification challenge that can be tackled by standard machine learning techniques such as random forests and support vector machines.</p>
<p><em>Any published and labelled RNA-seq dataset (bulk or single-cell) can be used as a reference</em></p>
<p><strong>SingleR method</strong>
The SingleR method (Aran et al. 2019) for cell type annotation assigns labels to cells based on the reference samples with the highest Spearman rank correlations, using only the marker genes between pairs of labels to focus on the relevant differences between cell types.</p>
<p>It also performs a fine-tuning step for each cell where the correlations are recomputed with just the marker genes for the top-scoring labels. This aims to resolve any ambiguity between those labels by removing noise from irrelevant markers for other labels. Further details can be found in the <a href="https://bioconductor.org/books/release/SingleRBook/">SingleR book</a>.</p>
</div>
<div id="getting-ready-again" class="section level3 hasAnchor" number="11.10.2">
<h3><span class="header-section-number">11.10.2</span> Getting ready again<a href="scrna-seq-data-analysis-overview.html#getting-ready-again" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will use now one of the 10X PBMC datasets as our test. While will apply quality control, normalization and clustering for this dataset, altough this is not strictly necessary.</p>
<p><strong>It is entirely possible to run <code>SingleR()</code> on the raw counts without any a priori quality control and filter on the annotation results at one’s leisure </strong></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="scrna-seq-data-analysis-overview.html#cb211-1" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb211-2"><a href="scrna-seq-data-analysis-overview.html#cb211-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;DropletTestFiles&quot;</span>)</span>
<span id="cb211-3"><a href="scrna-seq-data-analysis-overview.html#cb211-3" tabindex="-1"></a>raw.path <span class="ot">&lt;-</span> <span class="fu">getTestFile</span>(<span class="st">&quot;tenx-2.1.0-pbmc4k/1.0.0/raw.tar.gz&quot;</span>)</span>
<span id="cb211-4"><a href="scrna-seq-data-analysis-overview.html#cb211-4" tabindex="-1"></a><span class="co">#&gt; see ?DropletTestFiles and browseVignettes(&#39;DropletTestFiles&#39;) for documentation</span></span>
<span id="cb211-5"><a href="scrna-seq-data-analysis-overview.html#cb211-5" tabindex="-1"></a><span class="co">#&gt; downloading 1 resources</span></span>
<span id="cb211-6"><a href="scrna-seq-data-analysis-overview.html#cb211-6" tabindex="-1"></a><span class="co">#&gt; retrieving 1 resource</span></span>
<span id="cb211-7"><a href="scrna-seq-data-analysis-overview.html#cb211-7" tabindex="-1"></a><span class="co">#&gt; loading from cache</span></span></code></pre></div>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="scrna-seq-data-analysis-overview.html#cb212-1" tabindex="-1"></a>out.path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;pbmc4k&quot;</span>)</span>
<span id="cb212-2"><a href="scrna-seq-data-analysis-overview.html#cb212-2" tabindex="-1"></a><span class="fu">untar</span>(raw.path, <span class="at">exdir =</span> out.path)</span>
<span id="cb212-3"><a href="scrna-seq-data-analysis-overview.html#cb212-3" tabindex="-1"></a></span>
<span id="cb212-4"><a href="scrna-seq-data-analysis-overview.html#cb212-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;DropletUtils&quot;</span>)</span>
<span id="cb212-5"><a href="scrna-seq-data-analysis-overview.html#cb212-5" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(out.path, <span class="st">&quot;raw_gene_bc_matrices/GRCh38&quot;</span>)</span>
<span id="cb212-6"><a href="scrna-seq-data-analysis-overview.html#cb212-6" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> <span class="fu">read10xCounts</span>(fname, <span class="at">col.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-7"><a href="scrna-seq-data-analysis-overview.html#cb212-7" tabindex="-1"></a></span>
<span id="cb212-8"><a href="scrna-seq-data-analysis-overview.html#cb212-8" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scater&quot;</span>)</span>
<span id="cb212-9"><a href="scrna-seq-data-analysis-overview.html#cb212-9" tabindex="-1"></a><span class="fu">rownames</span>(sce.pbmc) <span class="ot">&lt;-</span> <span class="fu">uniquifyFeatureNames</span>(</span>
<span id="cb212-10"><a href="scrna-seq-data-analysis-overview.html#cb212-10" tabindex="-1"></a>    <span class="fu">rowData</span>(sce.pbmc)<span class="sc">$</span>ID, <span class="fu">rowData</span>(sce.pbmc)<span class="sc">$</span>Symbol</span>
<span id="cb212-11"><a href="scrna-seq-data-analysis-overview.html#cb212-11" tabindex="-1"></a>)</span>
<span id="cb212-12"><a href="scrna-seq-data-analysis-overview.html#cb212-12" tabindex="-1"></a></span>
<span id="cb212-13"><a href="scrna-seq-data-analysis-overview.html#cb212-13" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;EnsDb.Hsapiens.v86&quot;</span>)</span>
<span id="cb212-14"><a href="scrna-seq-data-analysis-overview.html#cb212-14" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">mapIds</span>(EnsDb.Hsapiens.v86,</span>
<span id="cb212-15"><a href="scrna-seq-data-analysis-overview.html#cb212-15" tabindex="-1"></a>    <span class="at">keys =</span> <span class="fu">rowData</span>(sce.pbmc)<span class="sc">$</span>ID,</span>
<span id="cb212-16"><a href="scrna-seq-data-analysis-overview.html#cb212-16" tabindex="-1"></a>    <span class="at">column =</span> <span class="st">&quot;SEQNAME&quot;</span>, <span class="at">keytype =</span> <span class="st">&quot;GENEID&quot;</span></span>
<span id="cb212-17"><a href="scrna-seq-data-analysis-overview.html#cb212-17" tabindex="-1"></a>)</span>
<span id="cb212-18"><a href="scrna-seq-data-analysis-overview.html#cb212-18" tabindex="-1"></a><span class="co">#&gt; Warning: Unable to map 144 of 33694 requested IDs.</span></span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="scrna-seq-data-analysis-overview.html#cb213-1" tabindex="-1"></a></span>
<span id="cb213-2"><a href="scrna-seq-data-analysis-overview.html#cb213-2" tabindex="-1"></a><span class="do">### QC</span></span>
<span id="cb213-3"><a href="scrna-seq-data-analysis-overview.html#cb213-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb213-4"><a href="scrna-seq-data-analysis-overview.html#cb213-4" tabindex="-1"></a>e.out <span class="ot">&lt;-</span> <span class="fu">emptyDrops</span>(<span class="fu">counts</span>(sce.pbmc))</span>
<span id="cb213-5"><a href="scrna-seq-data-analysis-overview.html#cb213-5" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> sce.pbmc[, <span class="fu">which</span>(e.out<span class="sc">$</span>FDR <span class="sc">&lt;=</span> <span class="fl">0.001</span>)]</span>
<span id="cb213-6"><a href="scrna-seq-data-analysis-overview.html#cb213-6" tabindex="-1"></a>unfiltered <span class="ot">&lt;-</span> sce.pbmc</span>
<span id="cb213-7"><a href="scrna-seq-data-analysis-overview.html#cb213-7" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">perCellQCMetrics</span>(sce.pbmc, <span class="at">subsets =</span> <span class="fu">list</span>(<span class="at">Mito =</span> <span class="fu">which</span>(location <span class="sc">==</span> <span class="st">&quot;MT&quot;</span>)))</span>
<span id="cb213-8"><a href="scrna-seq-data-analysis-overview.html#cb213-8" tabindex="-1"></a>high.mito <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(stats<span class="sc">$</span>subsets_Mito_percent, <span class="at">type =</span> <span class="st">&quot;higher&quot;</span>)</span>
<span id="cb213-9"><a href="scrna-seq-data-analysis-overview.html#cb213-9" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> sce.pbmc[, <span class="sc">!</span>high.mito]</span>
<span id="cb213-10"><a href="scrna-seq-data-analysis-overview.html#cb213-10" tabindex="-1"></a><span class="fu">summary</span>(high.mito)</span>
<span id="cb213-11"><a href="scrna-seq-data-analysis-overview.html#cb213-11" tabindex="-1"></a><span class="co">#&gt;    Mode   FALSE    TRUE </span></span>
<span id="cb213-12"><a href="scrna-seq-data-analysis-overview.html#cb213-12" tabindex="-1"></a><span class="co">#&gt; logical    3985     315</span></span></code></pre></div>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="scrna-seq-data-analysis-overview.html#cb214-1" tabindex="-1"></a></span>
<span id="cb214-2"><a href="scrna-seq-data-analysis-overview.html#cb214-2" tabindex="-1"></a><span class="do">### Normalization</span></span>
<span id="cb214-3"><a href="scrna-seq-data-analysis-overview.html#cb214-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb214-4"><a href="scrna-seq-data-analysis-overview.html#cb214-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb214-5"><a href="scrna-seq-data-analysis-overview.html#cb214-5" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">quickCluster</span>(sce.pbmc)</span>
<span id="cb214-6"><a href="scrna-seq-data-analysis-overview.html#cb214-6" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> <span class="fu">computeSumFactors</span>(sce.pbmc, <span class="at">cluster =</span> clusters)</span>
<span id="cb214-7"><a href="scrna-seq-data-analysis-overview.html#cb214-7" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> <span class="fu">logNormCounts</span>(sce.pbmc)</span>
<span id="cb214-8"><a href="scrna-seq-data-analysis-overview.html#cb214-8" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">sizeFactors</span>(sce.pbmc))</span>
<span id="cb214-9"><a href="scrna-seq-data-analysis-overview.html#cb214-9" tabindex="-1"></a><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb214-10"><a href="scrna-seq-data-analysis-overview.html#cb214-10" tabindex="-1"></a><span class="co">#&gt;  0.00749  0.71207  0.87490  1.00000  1.09900 12.25412</span></span></code></pre></div>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="scrna-seq-data-analysis-overview.html#cb215-1" tabindex="-1"></a></span>
<span id="cb215-2"><a href="scrna-seq-data-analysis-overview.html#cb215-2" tabindex="-1"></a><span class="do">### Variance modelling</span></span>
<span id="cb215-3"><a href="scrna-seq-data-analysis-overview.html#cb215-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb215-4"><a href="scrna-seq-data-analysis-overview.html#cb215-4" tabindex="-1"></a>dec.pbmc <span class="ot">&lt;-</span> <span class="fu">modelGeneVarByPoisson</span>(sce.pbmc)</span>
<span id="cb215-5"><a href="scrna-seq-data-analysis-overview.html#cb215-5" tabindex="-1"></a>top.pbmc <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(dec.pbmc, <span class="at">prop =</span> <span class="fl">0.1</span>)</span>
<span id="cb215-6"><a href="scrna-seq-data-analysis-overview.html#cb215-6" tabindex="-1"></a></span>
<span id="cb215-7"><a href="scrna-seq-data-analysis-overview.html#cb215-7" tabindex="-1"></a><span class="do">### Dimensionality reduction</span></span>
<span id="cb215-8"><a href="scrna-seq-data-analysis-overview.html#cb215-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10000</span>)</span>
<span id="cb215-9"><a href="scrna-seq-data-analysis-overview.html#cb215-9" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> <span class="fu">denoisePCA</span>(sce.pbmc, <span class="at">subset.row =</span> top.pbmc, <span class="at">technical =</span> dec.pbmc)</span>
<span id="cb215-10"><a href="scrna-seq-data-analysis-overview.html#cb215-10" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100000</span>)</span>
<span id="cb215-11"><a href="scrna-seq-data-analysis-overview.html#cb215-11" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce.pbmc, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb215-12"><a href="scrna-seq-data-analysis-overview.html#cb215-12" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000000</span>)</span>
<span id="cb215-13"><a href="scrna-seq-data-analysis-overview.html#cb215-13" tabindex="-1"></a>sce.pbmc <span class="ot">&lt;-</span> <span class="fu">runUMAP</span>(sce.pbmc, <span class="at">dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb215-14"><a href="scrna-seq-data-analysis-overview.html#cb215-14" tabindex="-1"></a></span>
<span id="cb215-15"><a href="scrna-seq-data-analysis-overview.html#cb215-15" tabindex="-1"></a><span class="do">### Clustering</span></span>
<span id="cb215-16"><a href="scrna-seq-data-analysis-overview.html#cb215-16" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">buildSNNGraph</span>(sce.pbmc, <span class="at">k =</span> <span class="dv">10</span>, <span class="at">use.dimred =</span> <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb215-17"><a href="scrna-seq-data-analysis-overview.html#cb215-17" tabindex="-1"></a>clust <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">cluster_walktrap</span>(g)<span class="sc">$</span>membership</span>
<span id="cb215-18"><a href="scrna-seq-data-analysis-overview.html#cb215-18" tabindex="-1"></a><span class="fu">colLabels</span>(sce.pbmc) <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust)</span>
<span id="cb215-19"><a href="scrna-seq-data-analysis-overview.html#cb215-19" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">colLabels</span>(sce.pbmc))</span>
<span id="cb215-20"><a href="scrna-seq-data-analysis-overview.html#cb215-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb215-21"><a href="scrna-seq-data-analysis-overview.html#cb215-21" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15 </span></span>
<span id="cb215-22"><a href="scrna-seq-data-analysis-overview.html#cb215-22" tabindex="-1"></a><span class="co">#&gt; 205 731 617  56 541 352 125  46 819  47 153  61 129  87  16</span></span></code></pre></div>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="scrna-seq-data-analysis-overview.html#cb216-1" tabindex="-1"></a><span class="fu">plotTSNE</span>(sce.pbmc, <span class="at">colour_by =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/set_PBMC_dataset-1.png" width="672" /></p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="scrna-seq-data-analysis-overview.html#cb217-1" tabindex="-1"></a></span>
<span id="cb217-2"><a href="scrna-seq-data-analysis-overview.html#cb217-2" tabindex="-1"></a><span class="do">### Interpretation</span></span>
<span id="cb217-3"><a href="scrna-seq-data-analysis-overview.html#cb217-3" tabindex="-1"></a>markers <span class="ot">&lt;-</span> <span class="fu">findMarkers</span>(sce.pbmc, <span class="at">pval.type =</span> <span class="st">&quot;some&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;up&quot;</span>)</span>
<span id="cb217-4"><a href="scrna-seq-data-analysis-overview.html#cb217-4" tabindex="-1"></a>marker.set <span class="ot">&lt;-</span> markers[[<span class="st">&quot;8&quot;</span>]]</span>
<span id="cb217-5"><a href="scrna-seq-data-analysis-overview.html#cb217-5" tabindex="-1"></a><span class="fu">as.data.frame</span>(marker.set[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb217-6"><a href="scrna-seq-data-analysis-overview.html#cb217-6" tabindex="-1"></a><span class="co">#&gt;                p.value          FDR summary.logFC</span></span>
<span id="cb217-7"><a href="scrna-seq-data-analysis-overview.html#cb217-7" tabindex="-1"></a><span class="co">#&gt; PF4       5.234138e-32 1.763591e-27      6.862880</span></span>
<span id="cb217-8"><a href="scrna-seq-data-analysis-overview.html#cb217-8" tabindex="-1"></a><span class="co">#&gt; TMSB4X    3.502960e-25 5.901437e-21      3.129070</span></span>
<span id="cb217-9"><a href="scrna-seq-data-analysis-overview.html#cb217-9" tabindex="-1"></a><span class="co">#&gt; TAGLN2    2.055571e-24 2.308680e-20      4.771441</span></span>
<span id="cb217-10"><a href="scrna-seq-data-analysis-overview.html#cb217-10" tabindex="-1"></a><span class="co">#&gt; NRGN      1.005824e-22 8.472562e-19      5.007984</span></span>
<span id="cb217-11"><a href="scrna-seq-data-analysis-overview.html#cb217-11" tabindex="-1"></a><span class="co">#&gt; SDPR      2.288275e-22 1.542023e-18      5.610425</span></span>
<span id="cb217-12"><a href="scrna-seq-data-analysis-overview.html#cb217-12" tabindex="-1"></a><span class="co">#&gt; PPBP      7.961199e-20 4.470744e-16      6.500820</span></span>
<span id="cb217-13"><a href="scrna-seq-data-analysis-overview.html#cb217-13" tabindex="-1"></a><span class="co">#&gt; GPX1      1.177137e-19 5.666066e-16      5.158546</span></span>
<span id="cb217-14"><a href="scrna-seq-data-analysis-overview.html#cb217-14" tabindex="-1"></a><span class="co">#&gt; CCL5      5.637712e-19 2.374463e-15      5.316314</span></span>
<span id="cb217-15"><a href="scrna-seq-data-analysis-overview.html#cb217-15" tabindex="-1"></a><span class="co">#&gt; GNG11     8.384893e-19 3.139118e-15      5.475652</span></span>
<span id="cb217-16"><a href="scrna-seq-data-analysis-overview.html#cb217-16" tabindex="-1"></a><span class="co">#&gt; HIST1H2AC 2.660666e-18 8.964847e-15      5.532573</span></span>
<span id="cb217-17"><a href="scrna-seq-data-analysis-overview.html#cb217-17" tabindex="-1"></a><span class="co">#&gt; TUBB1     7.919842e-18 2.425920e-14      4.987507</span></span>
<span id="cb217-18"><a href="scrna-seq-data-analysis-overview.html#cb217-18" tabindex="-1"></a><span class="co">#&gt; ACTB      4.073237e-17 1.058163e-13      3.171552</span></span>
<span id="cb217-19"><a href="scrna-seq-data-analysis-overview.html#cb217-19" tabindex="-1"></a><span class="co">#&gt; B2M       4.082661e-17 1.058163e-13      1.610689</span></span>
<span id="cb217-20"><a href="scrna-seq-data-analysis-overview.html#cb217-20" tabindex="-1"></a><span class="co">#&gt; FTH1      2.973798e-14 7.157083e-11      3.425641</span></span>
<span id="cb217-21"><a href="scrna-seq-data-analysis-overview.html#cb217-21" tabindex="-1"></a><span class="co">#&gt; RGS18     6.579466e-13 1.477924e-09      4.298459</span></span>
<span id="cb217-22"><a href="scrna-seq-data-analysis-overview.html#cb217-22" tabindex="-1"></a><span class="co">#&gt; ACRBP     1.357416e-12 2.858549e-09      3.969306</span></span>
<span id="cb217-23"><a href="scrna-seq-data-analysis-overview.html#cb217-23" tabindex="-1"></a><span class="co">#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 14 rows ]</span></span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="scrna-seq-data-analysis-overview.html#cb218-1" tabindex="-1"></a><span class="fu">plotExpression</span>(sce.pbmc, <span class="at">features =</span> <span class="fu">c</span>(</span>
<span id="cb218-2"><a href="scrna-seq-data-analysis-overview.html#cb218-2" tabindex="-1"></a>    <span class="st">&quot;CD14&quot;</span>, <span class="st">&quot;CD68&quot;</span>,</span>
<span id="cb218-3"><a href="scrna-seq-data-analysis-overview.html#cb218-3" tabindex="-1"></a>    <span class="st">&quot;MNDA&quot;</span>, <span class="st">&quot;FCGR3A&quot;</span></span>
<span id="cb218-4"><a href="scrna-seq-data-analysis-overview.html#cb218-4" tabindex="-1"></a>), <span class="at">x =</span> <span class="st">&quot;label&quot;</span>, <span class="at">colour_by =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/set_PBMC_dataset-2.png" width="672" /></p>
</div>
<div id="using-existing-references" class="section level3 hasAnchor" number="11.10.3">
<h3><span class="header-section-number">11.10.3</span> Using existing references<a href="scrna-seq-data-analysis-overview.html#using-existing-references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>celldex</code> contains a number of curated reference datasets, mostly assembled from bulk RNA-seq or microarray data of sorted cell types. These references are often good enough for most applications provided that they contain the cell types that are expected in the test population. Here, we will use a reference constructed from Blueprint and ENCODE data (Martens and Stunnenberg 2013; The ENCODE Project Consortium 2012); this is obtained by calling the <code>BlueprintEncode()</code> function to construct a SummarizedExperiment containing log-expression values with curated labels for each sample.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="scrna-seq-data-analysis-overview.html#cb219-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;celldex&quot;</span>)</span>
<span id="cb219-2"><a href="scrna-seq-data-analysis-overview.html#cb219-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb219-3"><a href="scrna-seq-data-analysis-overview.html#cb219-3" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;celldex&#39;</span></span>
<span id="cb219-4"><a href="scrna-seq-data-analysis-overview.html#cb219-4" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:scRNAseq&#39;:</span></span>
<span id="cb219-5"><a href="scrna-seq-data-analysis-overview.html#cb219-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb219-6"><a href="scrna-seq-data-analysis-overview.html#cb219-6" tabindex="-1"></a><span class="co">#&gt;     fetchLatestVersion, fetchMetadata, listVersions</span></span></code></pre></div>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="scrna-seq-data-analysis-overview.html#cb220-1" tabindex="-1"></a></span>
<span id="cb220-2"><a href="scrna-seq-data-analysis-overview.html#cb220-2" tabindex="-1"></a>ref <span class="ot">&lt;-</span> <span class="fu">BlueprintEncodeData</span>()</span>
<span id="cb220-3"><a href="scrna-seq-data-analysis-overview.html#cb220-3" tabindex="-1"></a>ref</span>
<span id="cb220-4"><a href="scrna-seq-data-analysis-overview.html#cb220-4" tabindex="-1"></a><span class="co">#&gt; class: SummarizedExperiment </span></span>
<span id="cb220-5"><a href="scrna-seq-data-analysis-overview.html#cb220-5" tabindex="-1"></a><span class="co">#&gt; dim: 19859 259 </span></span>
<span id="cb220-6"><a href="scrna-seq-data-analysis-overview.html#cb220-6" tabindex="-1"></a><span class="co">#&gt; metadata(0):</span></span>
<span id="cb220-7"><a href="scrna-seq-data-analysis-overview.html#cb220-7" tabindex="-1"></a><span class="co">#&gt; assays(1): logcounts</span></span>
<span id="cb220-8"><a href="scrna-seq-data-analysis-overview.html#cb220-8" tabindex="-1"></a><span class="co">#&gt; rownames(19859): TSPAN6 TNMD ... LINC00550 GIMAP1-GIMAP5</span></span>
<span id="cb220-9"><a href="scrna-seq-data-analysis-overview.html#cb220-9" tabindex="-1"></a><span class="co">#&gt; rowData names(0):</span></span>
<span id="cb220-10"><a href="scrna-seq-data-analysis-overview.html#cb220-10" tabindex="-1"></a><span class="co">#&gt; colnames(259): mature.neutrophil CD14.positive..CD16.negative.classical.monocyte ...</span></span>
<span id="cb220-11"><a href="scrna-seq-data-analysis-overview.html#cb220-11" tabindex="-1"></a><span class="co">#&gt;   epithelial.cell.of.umbilical.artery.1 dermis.lymphatic.vessel.endothelial.cell.1</span></span>
<span id="cb220-12"><a href="scrna-seq-data-analysis-overview.html#cb220-12" tabindex="-1"></a><span class="co">#&gt; colData names(3): label.main label.fine label.ont</span></span></code></pre></div>
<p>We call the <code>SingleR()</code> function to annotate each of our PBMCs with the main cell type labels from the Blueprint/ENCODE reference. This returns a <code>DataFrame</code> where each row corresponds to a cell in the test dataset and contains its label assignments. Alternatively, we could use the labels in <code>ref$label.fine</code>, which provide more resolution at the cost of speed and increased ambiguity in the assignments.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="scrna-seq-data-analysis-overview.html#cb221-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;SingleR&quot;</span>)</span>
<span id="cb221-2"><a href="scrna-seq-data-analysis-overview.html#cb221-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb221-3"><a href="scrna-seq-data-analysis-overview.html#cb221-3" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;SingleR&#39;</span></span>
<span id="cb221-4"><a href="scrna-seq-data-analysis-overview.html#cb221-4" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:celldex&#39;:</span></span>
<span id="cb221-5"><a href="scrna-seq-data-analysis-overview.html#cb221-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb221-6"><a href="scrna-seq-data-analysis-overview.html#cb221-6" tabindex="-1"></a><span class="co">#&gt;     BlueprintEncodeData, DatabaseImmuneCellExpressionData, HumanPrimaryCellAtlasData, ImmGenData,</span></span>
<span id="cb221-7"><a href="scrna-seq-data-analysis-overview.html#cb221-7" tabindex="-1"></a><span class="co">#&gt;     MonacoImmuneData, MouseRNAseqData, NovershternHematopoieticData</span></span></code></pre></div>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="scrna-seq-data-analysis-overview.html#cb222-1" tabindex="-1"></a></span>
<span id="cb222-2"><a href="scrna-seq-data-analysis-overview.html#cb222-2" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">SingleR</span>(<span class="at">test =</span> sce.pbmc, <span class="at">ref =</span> ref, <span class="at">labels =</span> ref<span class="sc">$</span>label.main)</span>
<span id="cb222-3"><a href="scrna-seq-data-analysis-overview.html#cb222-3" tabindex="-1"></a><span class="fu">table</span>(pred<span class="sc">$</span>labels)</span>
<span id="cb222-4"><a href="scrna-seq-data-analysis-overview.html#cb222-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb222-5"><a href="scrna-seq-data-analysis-overview.html#cb222-5" tabindex="-1"></a><span class="co">#&gt;      B-cells CD4+ T-cells CD8+ T-cells           DC  Eosinophils Erythrocytes          HSC    Monocytes     NK cells </span></span>
<span id="cb222-6"><a href="scrna-seq-data-analysis-overview.html#cb222-6" tabindex="-1"></a><span class="co">#&gt;          549          772         1275            1            1            6           14         1116          251</span></span></code></pre></div>
<p>Now, we can inspect the results using a heatmap of the per-cell and label scores. Ideally, each cell should exhibit a high score in one label relative to all of the others, indicating that the assignment to that label was unambiguous.</p>
<p>In this particular case it is true for monocytes and B cells, whereas we see more ambiguity between CD4+ and CD8+ T cells (and to a lesser extent, NK cells).</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="scrna-seq-data-analysis-overview.html#cb223-1" tabindex="-1"></a><span class="fu">plotScoreHeatmap</span>(pred)</span></code></pre></div>
<p><img src="_main_files/figure-html/predicted_vs_clusters_heatmap-1.png" width="672" /></p>
<p>We now compare the assignments with the clustering results to determine the identity of each cluster using a Heatmap of the distribution of cells across labels and clusters in the 10X PBMC dataset.</p>
<p><em>Here, several clusters are nested within the monocyte and B cell labels, indicating that the clustering represents finer subdivisions within the cell types. </em></p>
<p><em>Interestingly, our clustering does not effectively distinguish between CD4+ and CD8+ T cell labels. This is probably due to the presence of other factors of heterogeneity within the T cell subpopulation (e.g., activation) that have a stronger influence on unsupervised methods than the a priori expected CD4+/CD8+ distinction.</em></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="scrna-seq-data-analysis-overview.html#cb224-1" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Assigned =</span> pred<span class="sc">$</span>pruned.labels, <span class="at">Cluster =</span> <span class="fu">colLabels</span>(sce.pbmc))</span>
<span id="cb224-2"><a href="scrna-seq-data-analysis-overview.html#cb224-2" tabindex="-1"></a></span>
<span id="cb224-3"><a href="scrna-seq-data-analysis-overview.html#cb224-3" tabindex="-1"></a><span class="co"># Adding a pseudo-count of 10 to avoid strong color jumps with just 1 cell.</span></span>
<span id="cb224-4"><a href="scrna-seq-data-analysis-overview.html#cb224-4" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb224-5"><a href="scrna-seq-data-analysis-overview.html#cb224-5" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">log2</span>(tab <span class="sc">+</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;blue&quot;</span>))(<span class="dv">101</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/assigned_vs_ann_heatmap-1.png" width="672" /></p>
<p>This highlights some of the differences between reference-based annotation and unsupervised clustering. The former explicitly focuses on aspects of the data that are known to be interesting, simplifying the process of biological interpretation. However, the cost is that the downstream analysis is restricted by the diversity and resolution of the available labels, a problem that is largely avoided by de novo identification of clusters.</p>
<p>Applying both strategies to examine the agreement (or lack thereof) between reference label and cluster assignments could work for you. Any inconsistencies are not necessarily problematic due to the conceptual differences between the two approaches; indeed, one could use those discrepancies as the basis for further investigation to discover novel factors of variation in the data.</p>
<p><strong>We can also apply <code>SingleR</code> to single-cell reference datasets that are curated and supplied by the user. This is most obviously useful when we have an existing dataset that was previously (manually) annotated and we want to use that knowledge to annotate a new dataset in an automated manner.</strong></p>
</div>
<div id="assigning-cell-labels-from-gene-sets" class="section level3 hasAnchor" number="11.10.4">
<h3><span class="header-section-number">11.10.4</span> Assigning cell labels from gene sets<a href="scrna-seq-data-analysis-overview.html#assigning-cell-labels-from-gene-sets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A related strategy is to explicitly identify sets of marker genes that are highly expressed in each individual cell. This does not require matching of individual cells to the expression values of the reference dataset, which is faster and more convenient when only the identities of the markers are available.</p>
<p><em>For this example, we will be using the neuronal cell type markers derived from the Zeisel et al. (2015) study.</em></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="scrna-seq-data-analysis-overview.html#cb225-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scran&quot;</span>)</span>
<span id="cb225-2"><a href="scrna-seq-data-analysis-overview.html#cb225-2" tabindex="-1"></a></span>
<span id="cb225-3"><a href="scrna-seq-data-analysis-overview.html#cb225-3" tabindex="-1"></a>wilcox.z <span class="ot">&lt;-</span> <span class="fu">pairwiseWilcox</span>(sce.zeisel, sce.zeisel<span class="sc">$</span>level1class,</span>
<span id="cb225-4"><a href="scrna-seq-data-analysis-overview.html#cb225-4" tabindex="-1"></a>    <span class="at">lfc =</span> <span class="dv">1</span>, <span class="at">direction =</span> <span class="st">&quot;up&quot;</span></span>
<span id="cb225-5"><a href="scrna-seq-data-analysis-overview.html#cb225-5" tabindex="-1"></a>)</span>
<span id="cb225-6"><a href="scrna-seq-data-analysis-overview.html#cb225-6" tabindex="-1"></a></span>
<span id="cb225-7"><a href="scrna-seq-data-analysis-overview.html#cb225-7" tabindex="-1"></a>markers.z <span class="ot">&lt;-</span> <span class="fu">getTopMarkers</span>(wilcox.z<span class="sc">$</span>statistics, wilcox.z<span class="sc">$</span>pairs,</span>
<span id="cb225-8"><a href="scrna-seq-data-analysis-overview.html#cb225-8" tabindex="-1"></a>    <span class="at">pairwise =</span> <span class="cn">FALSE</span>, <span class="at">n =</span> <span class="dv">50</span></span>
<span id="cb225-9"><a href="scrna-seq-data-analysis-overview.html#cb225-9" tabindex="-1"></a>)</span>
<span id="cb225-10"><a href="scrna-seq-data-analysis-overview.html#cb225-10" tabindex="-1"></a></span>
<span id="cb225-11"><a href="scrna-seq-data-analysis-overview.html#cb225-11" tabindex="-1"></a><span class="fu">lengths</span>(markers.z)</span>
<span id="cb225-12"><a href="scrna-seq-data-analysis-overview.html#cb225-12" tabindex="-1"></a><span class="co">#&gt; astrocytes_ependymal    endothelial-mural         interneurons            microglia     oligodendrocytes </span></span>
<span id="cb225-13"><a href="scrna-seq-data-analysis-overview.html#cb225-13" tabindex="-1"></a><span class="co">#&gt;                   78                   85                  120                   69                   82 </span></span>
<span id="cb225-14"><a href="scrna-seq-data-analysis-overview.html#cb225-14" tabindex="-1"></a><span class="co">#&gt;        pyramidal CA1         pyramidal SS </span></span>
<span id="cb225-15"><a href="scrna-seq-data-analysis-overview.html#cb225-15" tabindex="-1"></a><span class="co">#&gt;                  122                  148</span></span></code></pre></div>
<p><em>And our test dataset will be another brain scRNA-seq experiment from Tasic et al. (2016).</em></p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="scrna-seq-data-analysis-overview.html#cb226-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;scRNAseq&quot;</span>)</span>
<span id="cb226-2"><a href="scrna-seq-data-analysis-overview.html#cb226-2" tabindex="-1"></a></span>
<span id="cb226-3"><a href="scrna-seq-data-analysis-overview.html#cb226-3" tabindex="-1"></a>sce.tasic <span class="ot">&lt;-</span> <span class="fu">TasicBrainData</span>()</span>
<span id="cb226-4"><a href="scrna-seq-data-analysis-overview.html#cb226-4" tabindex="-1"></a>sce.tasic</span>
<span id="cb226-5"><a href="scrna-seq-data-analysis-overview.html#cb226-5" tabindex="-1"></a><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span id="cb226-6"><a href="scrna-seq-data-analysis-overview.html#cb226-6" tabindex="-1"></a><span class="co">#&gt; dim: 24058 1809 </span></span>
<span id="cb226-7"><a href="scrna-seq-data-analysis-overview.html#cb226-7" tabindex="-1"></a><span class="co">#&gt; metadata(0):</span></span>
<span id="cb226-8"><a href="scrna-seq-data-analysis-overview.html#cb226-8" tabindex="-1"></a><span class="co">#&gt; assays(1): counts</span></span>
<span id="cb226-9"><a href="scrna-seq-data-analysis-overview.html#cb226-9" tabindex="-1"></a><span class="co">#&gt; rownames(24058): 0610005C13Rik 0610007C21Rik ... mt_X57780 tdTomato</span></span>
<span id="cb226-10"><a href="scrna-seq-data-analysis-overview.html#cb226-10" tabindex="-1"></a><span class="co">#&gt; rowData names(0):</span></span>
<span id="cb226-11"><a href="scrna-seq-data-analysis-overview.html#cb226-11" tabindex="-1"></a><span class="co">#&gt; colnames(1809): Calb2_tdTpositive_cell_1 Calb2_tdTpositive_cell_2 ... Rbp4_CTX_250ng_2 Trib2_CTX_250ng_1</span></span>
<span id="cb226-12"><a href="scrna-seq-data-analysis-overview.html#cb226-12" tabindex="-1"></a><span class="co">#&gt; colData names(12): mouse_line cre_driver_1 ... secondary_type aibs_vignette_id</span></span>
<span id="cb226-13"><a href="scrna-seq-data-analysis-overview.html#cb226-13" tabindex="-1"></a><span class="co">#&gt; reducedDimNames(0):</span></span>
<span id="cb226-14"><a href="scrna-seq-data-analysis-overview.html#cb226-14" tabindex="-1"></a><span class="co">#&gt; mainExpName: NULL</span></span>
<span id="cb226-15"><a href="scrna-seq-data-analysis-overview.html#cb226-15" tabindex="-1"></a><span class="co">#&gt; altExpNames(1): ERCC</span></span></code></pre></div>
<p>We are using the <code>AUCell</code> package to identify marker sets that are highly expressed in each cell. This method ranks genes by their expression values within each cell and constructs a response curve of the number of genes from each marker set that are present with increasing rank.</p>
<p>It then computes the area under the curve (AUC) for each marker set, quantifying the enrichment of those markers among the most highly expressed genes in that cell. This is roughly similar to performing a Wilcoxon rank sum test between genes in and outside of the set, but involving only the top ranking genes by expression in each cell.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="scrna-seq-data-analysis-overview.html#cb227-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;GSEABase&quot;</span>)</span>
<span id="cb227-2"><a href="scrna-seq-data-analysis-overview.html#cb227-2" tabindex="-1"></a><span class="co">#&gt; Loading required package: annotate</span></span>
<span id="cb227-3"><a href="scrna-seq-data-analysis-overview.html#cb227-3" tabindex="-1"></a><span class="co">#&gt; Loading required package: XML</span></span>
<span id="cb227-4"><a href="scrna-seq-data-analysis-overview.html#cb227-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb227-5"><a href="scrna-seq-data-analysis-overview.html#cb227-5" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;XML&#39;</span></span>
<span id="cb227-6"><a href="scrna-seq-data-analysis-overview.html#cb227-6" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:patchwork&#39;:</span></span>
<span id="cb227-7"><a href="scrna-seq-data-analysis-overview.html#cb227-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb227-8"><a href="scrna-seq-data-analysis-overview.html#cb227-8" tabindex="-1"></a><span class="co">#&gt;     free</span></span>
<span id="cb227-9"><a href="scrna-seq-data-analysis-overview.html#cb227-9" tabindex="-1"></a><span class="co">#&gt; Loading required package: graph</span></span>
<span id="cb227-10"><a href="scrna-seq-data-analysis-overview.html#cb227-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb227-11"><a href="scrna-seq-data-analysis-overview.html#cb227-11" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;graph&#39;</span></span>
<span id="cb227-12"><a href="scrna-seq-data-analysis-overview.html#cb227-12" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:XML&#39;:</span></span>
<span id="cb227-13"><a href="scrna-seq-data-analysis-overview.html#cb227-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb227-14"><a href="scrna-seq-data-analysis-overview.html#cb227-14" tabindex="-1"></a><span class="co">#&gt;     addNode</span></span>
<span id="cb227-15"><a href="scrna-seq-data-analysis-overview.html#cb227-15" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:circlize&#39;:</span></span>
<span id="cb227-16"><a href="scrna-seq-data-analysis-overview.html#cb227-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb227-17"><a href="scrna-seq-data-analysis-overview.html#cb227-17" tabindex="-1"></a><span class="co">#&gt;     degree</span></span>
<span id="cb227-18"><a href="scrna-seq-data-analysis-overview.html#cb227-18" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:stringr&#39;:</span></span>
<span id="cb227-19"><a href="scrna-seq-data-analysis-overview.html#cb227-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb227-20"><a href="scrna-seq-data-analysis-overview.html#cb227-20" tabindex="-1"></a><span class="co">#&gt;     boundary</span></span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="scrna-seq-data-analysis-overview.html#cb228-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;AUCell&quot;</span>)</span>
<span id="cb228-2"><a href="scrna-seq-data-analysis-overview.html#cb228-2" tabindex="-1"></a></span>
<span id="cb228-3"><a href="scrna-seq-data-analysis-overview.html#cb228-3" tabindex="-1"></a>all.sets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(markers.z), <span class="cf">function</span>(x) {</span>
<span id="cb228-4"><a href="scrna-seq-data-analysis-overview.html#cb228-4" tabindex="-1"></a>    <span class="fu">GeneSet</span>(markers.z[[x]], <span class="at">setName =</span> x)</span>
<span id="cb228-5"><a href="scrna-seq-data-analysis-overview.html#cb228-5" tabindex="-1"></a>})</span>
<span id="cb228-6"><a href="scrna-seq-data-analysis-overview.html#cb228-6" tabindex="-1"></a>all.sets <span class="ot">&lt;-</span> <span class="fu">GeneSetCollection</span>(all.sets)</span>
<span id="cb228-7"><a href="scrna-seq-data-analysis-overview.html#cb228-7" tabindex="-1"></a></span>
<span id="cb228-8"><a href="scrna-seq-data-analysis-overview.html#cb228-8" tabindex="-1"></a>rankings <span class="ot">&lt;-</span> <span class="fu">AUCell_buildRankings</span>(<span class="fu">counts</span>(sce.tasic),</span>
<span id="cb228-9"><a href="scrna-seq-data-analysis-overview.html#cb228-9" tabindex="-1"></a>    <span class="at">plotStats =</span> <span class="cn">FALSE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb228-10"><a href="scrna-seq-data-analysis-overview.html#cb228-10" tabindex="-1"></a>)</span>
<span id="cb228-11"><a href="scrna-seq-data-analysis-overview.html#cb228-11" tabindex="-1"></a></span>
<span id="cb228-12"><a href="scrna-seq-data-analysis-overview.html#cb228-12" tabindex="-1"></a>cell.aucs <span class="ot">&lt;-</span> <span class="fu">AUCell_calcAUC</span>(all.sets, rankings)</span>
<span id="cb228-13"><a href="scrna-seq-data-analysis-overview.html#cb228-13" tabindex="-1"></a><span class="co">#&gt; Genes in the gene sets NOT available in the dataset: </span></span>
<span id="cb228-14"><a href="scrna-seq-data-analysis-overview.html#cb228-14" tabindex="-1"></a><span class="co">#&gt;  endothelial-mural:  8 (9% of 85)</span></span>
<span id="cb228-15"><a href="scrna-seq-data-analysis-overview.html#cb228-15" tabindex="-1"></a><span class="co">#&gt;  interneurons:   1 (1% of 120)</span></span>
<span id="cb228-16"><a href="scrna-seq-data-analysis-overview.html#cb228-16" tabindex="-1"></a><span class="co">#&gt;  oligodendrocytes:   2 (2% of 82)</span></span>
<span id="cb228-17"><a href="scrna-seq-data-analysis-overview.html#cb228-17" tabindex="-1"></a><span class="co">#&gt;  pyramidal CA1:  4 (3% of 122)</span></span>
<span id="cb228-18"><a href="scrna-seq-data-analysis-overview.html#cb228-18" tabindex="-1"></a><span class="co">#&gt;  pyramidal SS:   4 (3% of 148)</span></span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="scrna-seq-data-analysis-overview.html#cb229-1" tabindex="-1"></a></span>
<span id="cb229-2"><a href="scrna-seq-data-analysis-overview.html#cb229-2" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">assay</span>(cell.aucs))</span>
<span id="cb229-3"><a href="scrna-seq-data-analysis-overview.html#cb229-3" tabindex="-1"></a><span class="fu">head</span>(results)</span>
<span id="cb229-4"><a href="scrna-seq-data-analysis-overview.html#cb229-4" tabindex="-1"></a><span class="co">#&gt;                           gene sets</span></span>
<span id="cb229-5"><a href="scrna-seq-data-analysis-overview.html#cb229-5" tabindex="-1"></a><span class="co">#&gt; cells                      astrocytes_ependymal endothelial-mural interneurons  microglia oligodendrocytes</span></span>
<span id="cb229-6"><a href="scrna-seq-data-analysis-overview.html#cb229-6" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_1            0.1285798        0.04210738    0.5480712 0.04845394        0.1291290</span></span>
<span id="cb229-7"><a href="scrna-seq-data-analysis-overview.html#cb229-7" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_2            0.1261887        0.04823270    0.4615967 0.02682648        0.1083978</span></span>
<span id="cb229-8"><a href="scrna-seq-data-analysis-overview.html#cb229-8" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_3            0.1030379        0.07177445    0.3679172 0.03582241        0.1345914</span></span>
<span id="cb229-9"><a href="scrna-seq-data-analysis-overview.html#cb229-9" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_4            0.1220786        0.04930379    0.5336098 0.05387632        0.1250108</span></span>
<span id="cb229-10"><a href="scrna-seq-data-analysis-overview.html#cb229-10" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_5            0.1531630        0.06033829    0.5062161 0.06655747        0.1151828</span></span>
<span id="cb229-11"><a href="scrna-seq-data-analysis-overview.html#cb229-11" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_6            0.1237204        0.09046280    0.3618004 0.03201310        0.1293656</span></span>
<span id="cb229-12"><a href="scrna-seq-data-analysis-overview.html#cb229-12" tabindex="-1"></a><span class="co">#&gt;                           gene sets</span></span>
<span id="cb229-13"><a href="scrna-seq-data-analysis-overview.html#cb229-13" tabindex="-1"></a><span class="co">#&gt; cells                      pyramidal CA1 pyramidal SS</span></span>
<span id="cb229-14"><a href="scrna-seq-data-analysis-overview.html#cb229-14" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_1     0.2306182    0.3381124</span></span>
<span id="cb229-15"><a href="scrna-seq-data-analysis-overview.html#cb229-15" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_2     0.2033824    0.2716657</span></span>
<span id="cb229-16"><a href="scrna-seq-data-analysis-overview.html#cb229-16" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_3     0.3217893    0.5137783</span></span>
<span id="cb229-17"><a href="scrna-seq-data-analysis-overview.html#cb229-17" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_4     0.2569572    0.3441631</span></span>
<span id="cb229-18"><a href="scrna-seq-data-analysis-overview.html#cb229-18" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_5     0.2109269    0.3030309</span></span>
<span id="cb229-19"><a href="scrna-seq-data-analysis-overview.html#cb229-19" tabindex="-1"></a><span class="co">#&gt;   Calb2_tdTpositive_cell_6     0.4041339    0.5251548</span></span></code></pre></div>
<p>We assign cell type identity to each cell in the test dataset by taking the marker set with the top AUC as the label for that cell. Our new labels mostly agree with the original annotation from Tasic et al. (2016), which is encouraging :)</p>
<p>The only exception involves misassignment of oligodendrocyte precursors to astrocytes, which may be understandable given that they are derived from a common lineage. In the absence of prior annotation, a more general diagnostic check is to compare the assigned labels to cluster identities, under the expectation that most cells of a single cluster would have the same label (or, if multiple labels are present, they should at least represent closely related cell states).</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="scrna-seq-data-analysis-overview.html#cb230-1" tabindex="-1"></a>new.labels <span class="ot">&lt;-</span> <span class="fu">colnames</span>(results)[<span class="fu">max.col</span>(results)]</span>
<span id="cb230-2"><a href="scrna-seq-data-analysis-overview.html#cb230-2" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(new.labels, sce.tasic<span class="sc">$</span>broad_type)</span>
<span id="cb230-3"><a href="scrna-seq-data-analysis-overview.html#cb230-3" tabindex="-1"></a>tab</span>
<span id="cb230-4"><a href="scrna-seq-data-analysis-overview.html#cb230-4" tabindex="-1"></a><span class="co">#&gt;                       </span></span>
<span id="cb230-5"><a href="scrna-seq-data-analysis-overview.html#cb230-5" tabindex="-1"></a><span class="co">#&gt; new.labels             Astrocyte Endothelial Cell GABA-ergic Neuron Glutamatergic Neuron Microglia Oligodendrocyte</span></span>
<span id="cb230-6"><a href="scrna-seq-data-analysis-overview.html#cb230-6" tabindex="-1"></a><span class="co">#&gt;   astrocytes_ependymal        43                2                 0                    0         0               0</span></span>
<span id="cb230-7"><a href="scrna-seq-data-analysis-overview.html#cb230-7" tabindex="-1"></a><span class="co">#&gt;   endothelial-mural            0               27                 0                    0         0               0</span></span>
<span id="cb230-8"><a href="scrna-seq-data-analysis-overview.html#cb230-8" tabindex="-1"></a><span class="co">#&gt;   interneurons                 0                0               760                    3         0               0</span></span>
<span id="cb230-9"><a href="scrna-seq-data-analysis-overview.html#cb230-9" tabindex="-1"></a><span class="co">#&gt;   microglia                    0                0                 0                    0        22               0</span></span>
<span id="cb230-10"><a href="scrna-seq-data-analysis-overview.html#cb230-10" tabindex="-1"></a><span class="co">#&gt;   oligodendrocytes             0                0                 1                    0         0              38</span></span>
<span id="cb230-11"><a href="scrna-seq-data-analysis-overview.html#cb230-11" tabindex="-1"></a><span class="co">#&gt;   pyramidal SS                 0                0                 0                  809         0               0</span></span>
<span id="cb230-12"><a href="scrna-seq-data-analysis-overview.html#cb230-12" tabindex="-1"></a><span class="co">#&gt;                       </span></span>
<span id="cb230-13"><a href="scrna-seq-data-analysis-overview.html#cb230-13" tabindex="-1"></a><span class="co">#&gt; new.labels             Oligodendrocyte Precursor Cell Unclassified</span></span>
<span id="cb230-14"><a href="scrna-seq-data-analysis-overview.html#cb230-14" tabindex="-1"></a><span class="co">#&gt;   astrocytes_ependymal                             21            4</span></span>
<span id="cb230-15"><a href="scrna-seq-data-analysis-overview.html#cb230-15" tabindex="-1"></a><span class="co">#&gt;   endothelial-mural                                 0            2</span></span>
<span id="cb230-16"><a href="scrna-seq-data-analysis-overview.html#cb230-16" tabindex="-1"></a><span class="co">#&gt;   interneurons                                      0           15</span></span>
<span id="cb230-17"><a href="scrna-seq-data-analysis-overview.html#cb230-17" tabindex="-1"></a><span class="co">#&gt;   microglia                                         0            1</span></span>
<span id="cb230-18"><a href="scrna-seq-data-analysis-overview.html#cb230-18" tabindex="-1"></a><span class="co">#&gt;   oligodendrocytes                                  1            0</span></span>
<span id="cb230-19"><a href="scrna-seq-data-analysis-overview.html#cb230-19" tabindex="-1"></a><span class="co">#&gt;   pyramidal SS                                      0           60</span></span></code></pre></div>
<p>As a diagnostic measure, we examine the distribution of AUCs across cells for each label.</p>
<p>In heterogeneous populations, the distribution for each label should be bimodal with one high-scoring peak containing cells of that cell type and a low-scoring peak containing cells of other types.</p>
<p>The gap between these two peaks can be used to derive a threshold for whether a label is “active” for a particular cell. (In this case, we simply take the single highest-scoring label per cell as the labels should be mutually exclusive.) In populations where a particular cell type is expected, lack of clear bimodality for the corresponding label may indicate that its gene set is not sufficiently informative.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="scrna-seq-data-analysis-overview.html#cb231-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb231-2"><a href="scrna-seq-data-analysis-overview.html#cb231-2" tabindex="-1"></a><span class="fu">AUCell_exploreThresholds</span>(cell.aucs, <span class="at">plotHist =</span> <span class="cn">TRUE</span>, <span class="at">assign =</span> <span class="cn">TRUE</span>)</span>
<span id="cb231-3"><a href="scrna-seq-data-analysis-overview.html#cb231-3" tabindex="-1"></a><span class="co">#&gt; $astrocytes_ependymal</span></span>
<span id="cb231-4"><a href="scrna-seq-data-analysis-overview.html#cb231-4" tabindex="-1"></a><span class="co">#&gt; $astrocytes_ependymal$aucThr</span></span>
<span id="cb231-5"><a href="scrna-seq-data-analysis-overview.html#cb231-5" tabindex="-1"></a><span class="co">#&gt; $astrocytes_ependymal$aucThr$selected</span></span>
<span id="cb231-6"><a href="scrna-seq-data-analysis-overview.html#cb231-6" tabindex="-1"></a><span class="co">#&gt; minimumDens </span></span>
<span id="cb231-7"><a href="scrna-seq-data-analysis-overview.html#cb231-7" tabindex="-1"></a><span class="co">#&gt;  0.04144623 </span></span>
<span id="cb231-8"><a href="scrna-seq-data-analysis-overview.html#cb231-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-9"><a href="scrna-seq-data-analysis-overview.html#cb231-9" tabindex="-1"></a><span class="co">#&gt; $astrocytes_ependymal$aucThr$thresholds</span></span>
<span id="cb231-10"><a href="scrna-seq-data-analysis-overview.html#cb231-10" tabindex="-1"></a><span class="co">#&gt;              threshold nCells</span></span>
<span id="cb231-11"><a href="scrna-seq-data-analysis-overview.html#cb231-11" tabindex="-1"></a><span class="co">#&gt; Global_k1   0.20913180     93</span></span>
<span id="cb231-12"><a href="scrna-seq-data-analysis-overview.html#cb231-12" tabindex="-1"></a><span class="co">#&gt; L_k2        0.20910138     93</span></span>
<span id="cb231-13"><a href="scrna-seq-data-analysis-overview.html#cb231-13" tabindex="-1"></a><span class="co">#&gt; R_k3        0.57911351     43</span></span>
<span id="cb231-14"><a href="scrna-seq-data-analysis-overview.html#cb231-14" tabindex="-1"></a><span class="co">#&gt; minimumDens 0.04144623   1808</span></span>
<span id="cb231-15"><a href="scrna-seq-data-analysis-overview.html#cb231-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-16"><a href="scrna-seq-data-analysis-overview.html#cb231-16" tabindex="-1"></a><span class="co">#&gt; $astrocytes_ependymal$aucThr$comment</span></span>
<span id="cb231-17"><a href="scrna-seq-data-analysis-overview.html#cb231-17" tabindex="-1"></a><span class="co">#&gt; [1] &quot;&quot;</span></span>
<span id="cb231-18"><a href="scrna-seq-data-analysis-overview.html#cb231-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-19"><a href="scrna-seq-data-analysis-overview.html#cb231-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-20"><a href="scrna-seq-data-analysis-overview.html#cb231-20" tabindex="-1"></a><span class="co">#&gt; $astrocytes_ependymal$assignment</span></span>
<span id="cb231-21"><a href="scrna-seq-data-analysis-overview.html#cb231-21" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Calb2_tdTpositive_cell_1&quot;  &quot;Calb2_tdTpositive_cell_2&quot;  &quot;Calb2_tdTpositive_cell_3&quot;  &quot;Calb2_tdTpositive_cell_4&quot; </span></span>
<span id="cb231-22"><a href="scrna-seq-data-analysis-overview.html#cb231-22" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;Calb2_tdTpositive_cell_5&quot;  &quot;Calb2_tdTpositive_cell_6&quot;  &quot;Calb2_tdTpositive_cell_7&quot;  &quot;Calb2_tdTpositive_cell_8&quot; </span></span>
<span id="cb231-23"><a href="scrna-seq-data-analysis-overview.html#cb231-23" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;Calb2_tdTpositive_cell_9&quot;  &quot;Calb2_tdTpositive_cell_10&quot; &quot;Calb2_tdTpositive_cell_11&quot; &quot;Calb2_tdTpositive_cell_12&quot;</span></span>
<span id="cb231-24"><a href="scrna-seq-data-analysis-overview.html#cb231-24" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Calb2_tdTpositive_cell_13&quot; &quot;Calb2_tdTpositive_cell_14&quot; &quot;Calb2_tdTpositive_cell_15&quot; &quot;Calb2_tdTpositive_cell_16&quot;</span></span>
<span id="cb231-25"><a href="scrna-seq-data-analysis-overview.html#cb231-25" tabindex="-1"></a><span class="co">#&gt; [17] &quot;Calb2_tdTpositive_cell_17&quot; &quot;Calb2_tdTpositive_cell_18&quot; &quot;Calb2_tdTpositive_cell_19&quot; &quot;Calb2_tdTpositive_cell_20&quot;</span></span>
<span id="cb231-26"><a href="scrna-seq-data-analysis-overview.html#cb231-26" tabindex="-1"></a><span class="co">#&gt; [21] &quot;Calb2_tdTpositive_cell_21&quot; &quot;Calb2_tdTpositive_cell_22&quot; &quot;Calb2_tdTpositive_cell_23&quot; &quot;Calb2_tdTpositive_cell_24&quot;</span></span>
<span id="cb231-27"><a href="scrna-seq-data-analysis-overview.html#cb231-27" tabindex="-1"></a><span class="co">#&gt; [25] &quot;Calb2_tdTpositive_cell_25&quot; &quot;Calb2_tdTpositive_cell_26&quot; &quot;Calb2_tdTpositive_cell_27&quot; &quot;Calb2_tdTpositive_cell_28&quot;</span></span>
<span id="cb231-28"><a href="scrna-seq-data-analysis-overview.html#cb231-28" tabindex="-1"></a><span class="co">#&gt; [29] &quot;Calb2_tdTpositive_cell_29&quot; &quot;Calb2_tdTpositive_cell_30&quot; &quot;Calb2_tdTpositive_cell_31&quot; &quot;Calb2_tdTpositive_cell_32&quot;</span></span>
<span id="cb231-29"><a href="scrna-seq-data-analysis-overview.html#cb231-29" tabindex="-1"></a><span class="co">#&gt; [33] &quot;Calb2_tdTpositive_cell_33&quot; &quot;Calb2_tdTpositive_cell_34&quot; &quot;Calb2_tdTpositive_cell_35&quot; &quot;Calb2_tdTpositive_cell_36&quot;</span></span>
<span id="cb231-30"><a href="scrna-seq-data-analysis-overview.html#cb231-30" tabindex="-1"></a><span class="co">#&gt; [37] &quot;Calb2_tdTpositive_cell_37&quot; &quot;Calb2_tdTpositive_cell_38&quot; &quot;Calb2_tdTpositive_cell_39&quot; &quot;Calb2_tdTpositive_cell_40&quot;</span></span>
<span id="cb231-31"><a href="scrna-seq-data-analysis-overview.html#cb231-31" tabindex="-1"></a><span class="co">#&gt; [41] &quot;Calb2_tdTpositive_cell_41&quot; &quot;Calb2_tdTpositive_cell_42&quot; &quot;Calb2_tdTpositive_cell_43&quot; &quot;Calb2_tdTpositive_cell_44&quot;</span></span>
<span id="cb231-32"><a href="scrna-seq-data-analysis-overview.html#cb231-32" tabindex="-1"></a><span class="co">#&gt; [45] &quot;Calb2_tdTpositive_cell_45&quot; &quot;Calb2_tdTpositive_cell_46&quot; &quot;Calb2_tdTpositive_cell_47&quot; &quot;Calb2_tdTpositive_cell_48&quot;</span></span>
<span id="cb231-33"><a href="scrna-seq-data-analysis-overview.html#cb231-33" tabindex="-1"></a><span class="co">#&gt; [49] &quot;Calb2_tdTpositive_cell_49&quot; &quot;Calb2_tdTpositive_cell_50&quot;</span></span>
<span id="cb231-34"><a href="scrna-seq-data-analysis-overview.html#cb231-34" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 1758 entries ]</span></span>
<span id="cb231-35"><a href="scrna-seq-data-analysis-overview.html#cb231-35" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-36"><a href="scrna-seq-data-analysis-overview.html#cb231-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-37"><a href="scrna-seq-data-analysis-overview.html#cb231-37" tabindex="-1"></a><span class="co">#&gt; $`endothelial-mural`</span></span>
<span id="cb231-38"><a href="scrna-seq-data-analysis-overview.html#cb231-38" tabindex="-1"></a><span class="co">#&gt; $`endothelial-mural`$aucThr</span></span>
<span id="cb231-39"><a href="scrna-seq-data-analysis-overview.html#cb231-39" tabindex="-1"></a><span class="co">#&gt; $`endothelial-mural`$aucThr$selected</span></span>
<span id="cb231-40"><a href="scrna-seq-data-analysis-overview.html#cb231-40" tabindex="-1"></a><span class="co">#&gt;      R_k3 </span></span>
<span id="cb231-41"><a href="scrna-seq-data-analysis-overview.html#cb231-41" tabindex="-1"></a><span class="co">#&gt; 0.2463287 </span></span>
<span id="cb231-42"><a href="scrna-seq-data-analysis-overview.html#cb231-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-43"><a href="scrna-seq-data-analysis-overview.html#cb231-43" tabindex="-1"></a><span class="co">#&gt; $`endothelial-mural`$aucThr$thresholds</span></span>
<span id="cb231-44"><a href="scrna-seq-data-analysis-overview.html#cb231-44" tabindex="-1"></a><span class="co">#&gt;           threshold nCells</span></span>
<span id="cb231-45"><a href="scrna-seq-data-analysis-overview.html#cb231-45" tabindex="-1"></a><span class="co">#&gt; Global_k1 0.1196348    125</span></span>
<span id="cb231-46"><a href="scrna-seq-data-analysis-overview.html#cb231-46" tabindex="-1"></a><span class="co">#&gt; L_k2      0.1653355     53</span></span>
<span id="cb231-47"><a href="scrna-seq-data-analysis-overview.html#cb231-47" tabindex="-1"></a><span class="co">#&gt; R_k3      0.2463287     28</span></span>
<span id="cb231-48"><a href="scrna-seq-data-analysis-overview.html#cb231-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-49"><a href="scrna-seq-data-analysis-overview.html#cb231-49" tabindex="-1"></a><span class="co">#&gt; $`endothelial-mural`$aucThr$comment</span></span>
<span id="cb231-50"><a href="scrna-seq-data-analysis-overview.html#cb231-50" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Few cells have high AUC values (0.018% cells with AUC&gt; 0.20). &quot;</span></span>
<span id="cb231-51"><a href="scrna-seq-data-analysis-overview.html#cb231-51" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-52"><a href="scrna-seq-data-analysis-overview.html#cb231-52" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-53"><a href="scrna-seq-data-analysis-overview.html#cb231-53" tabindex="-1"></a><span class="co">#&gt; $`endothelial-mural`$assignment</span></span>
<span id="cb231-54"><a href="scrna-seq-data-analysis-overview.html#cb231-54" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Ctgf_tdTpositive_cell_1&quot;   &quot;Ctgf_tdTpositive_cell_2&quot;   &quot;Ctgf_tdTpositive_cell_3&quot;   &quot;Ctgf_tdTpositive_cell_4&quot;  </span></span>
<span id="cb231-55"><a href="scrna-seq-data-analysis-overview.html#cb231-55" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;Ctgf_tdTpositive_cell_5&quot;   &quot;Ctgf_tdTpositive_cell_6&quot;   &quot;Ctgf_tdTpositive_cell_7&quot;   &quot;Ctgf_tdTpositive_cell_8&quot;  </span></span>
<span id="cb231-56"><a href="scrna-seq-data-analysis-overview.html#cb231-56" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;Ctgf_tdTpositive_cell_10&quot;  &quot;Cux2_tdTnegative_cell_10&quot;  &quot;Ndnf_tdTpositive_cell_1&quot;   &quot;Ndnf_tdTpositive_cell_3&quot;  </span></span>
<span id="cb231-57"><a href="scrna-seq-data-analysis-overview.html#cb231-57" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Ndnf_tdTpositive_cell_4&quot;   &quot;Ndnf_tdTpositive_cell_5&quot;   &quot;Ndnf_tdTpositive_cell_6&quot;   &quot;Ndnf_tdTpositive_cell_7&quot;  </span></span>
<span id="cb231-58"><a href="scrna-seq-data-analysis-overview.html#cb231-58" tabindex="-1"></a><span class="co">#&gt; [17] &quot;Ndnf_tdTpositive_cell_8&quot;   &quot;Ndnf_tdTpositive_cell_9&quot;   &quot;Ndnf_tdTpositive_cell_10&quot;  &quot;Ndnf_tdTpositive_cell_11&quot; </span></span>
<span id="cb231-59"><a href="scrna-seq-data-analysis-overview.html#cb231-59" tabindex="-1"></a><span class="co">#&gt; [21] &quot;Ndnf_tdTpositive_cell_12&quot;  &quot;Ndnf_tdTpositive_cell_20&quot;  &quot;Ndnf_tdTpositive_cell_21&quot;  &quot;Nos1_tdTpositive_cell_1&quot;  </span></span>
<span id="cb231-60"><a href="scrna-seq-data-analysis-overview.html#cb231-60" tabindex="-1"></a><span class="co">#&gt; [25] &quot;Nos1_tdTpositive_cell_28&quot;  &quot;Nos1_tdTpositive_cell_54&quot;  &quot;Nos1_tdTpositive_cell_66&quot;  &quot;Ntsr1_tdTnegative_cell_29&quot;</span></span>
<span id="cb231-61"><a href="scrna-seq-data-analysis-overview.html#cb231-61" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-62"><a href="scrna-seq-data-analysis-overview.html#cb231-62" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-63"><a href="scrna-seq-data-analysis-overview.html#cb231-63" tabindex="-1"></a><span class="co">#&gt; $interneurons</span></span>
<span id="cb231-64"><a href="scrna-seq-data-analysis-overview.html#cb231-64" tabindex="-1"></a><span class="co">#&gt; $interneurons$aucThr</span></span>
<span id="cb231-65"><a href="scrna-seq-data-analysis-overview.html#cb231-65" tabindex="-1"></a><span class="co">#&gt; $interneurons$aucThr$selected</span></span>
<span id="cb231-66"><a href="scrna-seq-data-analysis-overview.html#cb231-66" tabindex="-1"></a><span class="co">#&gt; minimumDens </span></span>
<span id="cb231-67"><a href="scrna-seq-data-analysis-overview.html#cb231-67" tabindex="-1"></a><span class="co">#&gt;   0.2102008 </span></span>
<span id="cb231-68"><a href="scrna-seq-data-analysis-overview.html#cb231-68" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-69"><a href="scrna-seq-data-analysis-overview.html#cb231-69" tabindex="-1"></a><span class="co">#&gt; $interneurons$aucThr$thresholds</span></span>
<span id="cb231-70"><a href="scrna-seq-data-analysis-overview.html#cb231-70" tabindex="-1"></a><span class="co">#&gt;             threshold nCells</span></span>
<span id="cb231-71"><a href="scrna-seq-data-analysis-overview.html#cb231-71" tabindex="-1"></a><span class="co">#&gt; Global_k1   0.4912184    482</span></span>
<span id="cb231-72"><a href="scrna-seq-data-analysis-overview.html#cb231-72" tabindex="-1"></a><span class="co">#&gt; L_k2        0.2253667   1644</span></span>
<span id="cb231-73"><a href="scrna-seq-data-analysis-overview.html#cb231-73" tabindex="-1"></a><span class="co">#&gt; R_k3        0.4116720    960</span></span>
<span id="cb231-74"><a href="scrna-seq-data-analysis-overview.html#cb231-74" tabindex="-1"></a><span class="co">#&gt; minimumDens 0.2102008   1646</span></span>
<span id="cb231-75"><a href="scrna-seq-data-analysis-overview.html#cb231-75" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-76"><a href="scrna-seq-data-analysis-overview.html#cb231-76" tabindex="-1"></a><span class="co">#&gt; $interneurons$aucThr$comment</span></span>
<span id="cb231-77"><a href="scrna-seq-data-analysis-overview.html#cb231-77" tabindex="-1"></a><span class="co">#&gt; [1] &quot;The right distribution is taller. &quot;</span></span>
<span id="cb231-78"><a href="scrna-seq-data-analysis-overview.html#cb231-78" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-79"><a href="scrna-seq-data-analysis-overview.html#cb231-79" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-80"><a href="scrna-seq-data-analysis-overview.html#cb231-80" tabindex="-1"></a><span class="co">#&gt; $interneurons$assignment</span></span>
<span id="cb231-81"><a href="scrna-seq-data-analysis-overview.html#cb231-81" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Calb2_tdTpositive_cell_1&quot;  &quot;Calb2_tdTpositive_cell_2&quot;  &quot;Calb2_tdTpositive_cell_3&quot;  &quot;Calb2_tdTpositive_cell_4&quot; </span></span>
<span id="cb231-82"><a href="scrna-seq-data-analysis-overview.html#cb231-82" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;Calb2_tdTpositive_cell_5&quot;  &quot;Calb2_tdTpositive_cell_6&quot;  &quot;Calb2_tdTpositive_cell_7&quot;  &quot;Calb2_tdTpositive_cell_8&quot; </span></span>
<span id="cb231-83"><a href="scrna-seq-data-analysis-overview.html#cb231-83" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;Calb2_tdTpositive_cell_9&quot;  &quot;Calb2_tdTpositive_cell_10&quot; &quot;Calb2_tdTpositive_cell_11&quot; &quot;Calb2_tdTpositive_cell_12&quot;</span></span>
<span id="cb231-84"><a href="scrna-seq-data-analysis-overview.html#cb231-84" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Calb2_tdTpositive_cell_13&quot; &quot;Calb2_tdTpositive_cell_14&quot; &quot;Calb2_tdTpositive_cell_15&quot; &quot;Calb2_tdTpositive_cell_16&quot;</span></span>
<span id="cb231-85"><a href="scrna-seq-data-analysis-overview.html#cb231-85" tabindex="-1"></a><span class="co">#&gt; [17] &quot;Calb2_tdTpositive_cell_17&quot; &quot;Calb2_tdTpositive_cell_18&quot; &quot;Calb2_tdTpositive_cell_19&quot; &quot;Calb2_tdTpositive_cell_20&quot;</span></span>
<span id="cb231-86"><a href="scrna-seq-data-analysis-overview.html#cb231-86" tabindex="-1"></a><span class="co">#&gt; [21] &quot;Calb2_tdTpositive_cell_21&quot; &quot;Calb2_tdTpositive_cell_22&quot; &quot;Calb2_tdTpositive_cell_23&quot; &quot;Calb2_tdTpositive_cell_24&quot;</span></span>
<span id="cb231-87"><a href="scrna-seq-data-analysis-overview.html#cb231-87" tabindex="-1"></a><span class="co">#&gt; [25] &quot;Calb2_tdTpositive_cell_25&quot; &quot;Calb2_tdTpositive_cell_26&quot; &quot;Calb2_tdTpositive_cell_27&quot; &quot;Calb2_tdTpositive_cell_29&quot;</span></span>
<span id="cb231-88"><a href="scrna-seq-data-analysis-overview.html#cb231-88" tabindex="-1"></a><span class="co">#&gt; [29] &quot;Calb2_tdTpositive_cell_30&quot; &quot;Calb2_tdTpositive_cell_31&quot; &quot;Calb2_tdTpositive_cell_32&quot; &quot;Calb2_tdTpositive_cell_33&quot;</span></span>
<span id="cb231-89"><a href="scrna-seq-data-analysis-overview.html#cb231-89" tabindex="-1"></a><span class="co">#&gt; [33] &quot;Calb2_tdTpositive_cell_34&quot; &quot;Calb2_tdTpositive_cell_35&quot; &quot;Calb2_tdTpositive_cell_36&quot; &quot;Calb2_tdTpositive_cell_37&quot;</span></span>
<span id="cb231-90"><a href="scrna-seq-data-analysis-overview.html#cb231-90" tabindex="-1"></a><span class="co">#&gt; [37] &quot;Calb2_tdTpositive_cell_38&quot; &quot;Calb2_tdTpositive_cell_39&quot; &quot;Calb2_tdTpositive_cell_40&quot; &quot;Calb2_tdTpositive_cell_41&quot;</span></span>
<span id="cb231-91"><a href="scrna-seq-data-analysis-overview.html#cb231-91" tabindex="-1"></a><span class="co">#&gt; [41] &quot;Calb2_tdTpositive_cell_42&quot; &quot;Calb2_tdTpositive_cell_43&quot; &quot;Calb2_tdTpositive_cell_44&quot; &quot;Calb2_tdTpositive_cell_45&quot;</span></span>
<span id="cb231-92"><a href="scrna-seq-data-analysis-overview.html#cb231-92" tabindex="-1"></a><span class="co">#&gt; [45] &quot;Calb2_tdTpositive_cell_47&quot; &quot;Calb2_tdTpositive_cell_49&quot; &quot;Calb2_tdTpositive_cell_51&quot; &quot;Calb2_tdTpositive_cell_52&quot;</span></span>
<span id="cb231-93"><a href="scrna-seq-data-analysis-overview.html#cb231-93" tabindex="-1"></a><span class="co">#&gt; [49] &quot;Calb2_tdTpositive_cell_54&quot; &quot;Calb2_tdTpositive_cell_55&quot;</span></span>
<span id="cb231-94"><a href="scrna-seq-data-analysis-overview.html#cb231-94" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 1596 entries ]</span></span>
<span id="cb231-95"><a href="scrna-seq-data-analysis-overview.html#cb231-95" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-96"><a href="scrna-seq-data-analysis-overview.html#cb231-96" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-97"><a href="scrna-seq-data-analysis-overview.html#cb231-97" tabindex="-1"></a><span class="co">#&gt; $microglia</span></span>
<span id="cb231-98"><a href="scrna-seq-data-analysis-overview.html#cb231-98" tabindex="-1"></a><span class="co">#&gt; $microglia$aucThr</span></span>
<span id="cb231-99"><a href="scrna-seq-data-analysis-overview.html#cb231-99" tabindex="-1"></a><span class="co">#&gt; $microglia$aucThr$selected</span></span>
<span id="cb231-100"><a href="scrna-seq-data-analysis-overview.html#cb231-100" tabindex="-1"></a><span class="co">#&gt;      R_k3 </span></span>
<span id="cb231-101"><a href="scrna-seq-data-analysis-overview.html#cb231-101" tabindex="-1"></a><span class="co">#&gt; 0.4649278 </span></span>
<span id="cb231-102"><a href="scrna-seq-data-analysis-overview.html#cb231-102" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-103"><a href="scrna-seq-data-analysis-overview.html#cb231-103" tabindex="-1"></a><span class="co">#&gt; $microglia$aucThr$thresholds</span></span>
<span id="cb231-104"><a href="scrna-seq-data-analysis-overview.html#cb231-104" tabindex="-1"></a><span class="co">#&gt;                  threshold nCells</span></span>
<span id="cb231-105"><a href="scrna-seq-data-analysis-overview.html#cb231-105" tabindex="-1"></a><span class="co">#&gt; tenPercentOfMax 0.06006924    474</span></span>
<span id="cb231-106"><a href="scrna-seq-data-analysis-overview.html#cb231-106" tabindex="-1"></a><span class="co">#&gt; Global_k1       0.09814942     88</span></span>
<span id="cb231-107"><a href="scrna-seq-data-analysis-overview.html#cb231-107" tabindex="-1"></a><span class="co">#&gt; L_k2            0.11821099     58</span></span>
<span id="cb231-108"><a href="scrna-seq-data-analysis-overview.html#cb231-108" tabindex="-1"></a><span class="co">#&gt; R_k3            0.46492785     23</span></span>
<span id="cb231-109"><a href="scrna-seq-data-analysis-overview.html#cb231-109" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-110"><a href="scrna-seq-data-analysis-overview.html#cb231-110" tabindex="-1"></a><span class="co">#&gt; $microglia$aucThr$comment</span></span>
<span id="cb231-111"><a href="scrna-seq-data-analysis-overview.html#cb231-111" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Few cells have high AUC values (0.013% cells with AUC&gt; 0.20). &quot;</span></span>
<span id="cb231-112"><a href="scrna-seq-data-analysis-overview.html#cb231-112" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-113"><a href="scrna-seq-data-analysis-overview.html#cb231-113" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-114"><a href="scrna-seq-data-analysis-overview.html#cb231-114" tabindex="-1"></a><span class="co">#&gt; $microglia$assignment</span></span>
<span id="cb231-115"><a href="scrna-seq-data-analysis-overview.html#cb231-115" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Cux2_tdTnegative_cell_5&quot;        &quot;Cux2_tdTnegative_cell_6&quot;        &quot;Cux2_tdTnegative_cell_12&quot;      </span></span>
<span id="cb231-116"><a href="scrna-seq-data-analysis-overview.html#cb231-116" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;Cux2_tdTnegative_cell_15&quot;       &quot;Ntsr1_tdTnegative_cell_18&quot;      &quot;Ntsr1_tdTnegative_cell_28&quot;     </span></span>
<span id="cb231-117"><a href="scrna-seq-data-analysis-overview.html#cb231-117" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;Rbp4_tdTnegative_cell_2&quot;        &quot;Rbp4_tdTnegative_cell_3&quot;        &quot;Rbp4_tdTnegative_cell_4&quot;       </span></span>
<span id="cb231-118"><a href="scrna-seq-data-analysis-overview.html#cb231-118" tabindex="-1"></a><span class="co">#&gt; [10] &quot;Rbp4_tdTnegative_cell_10&quot;       &quot;Rbp4_tdTnegative_cell_14&quot;       &quot;Rbp4_tdTnegative_cell_16&quot;      </span></span>
<span id="cb231-119"><a href="scrna-seq-data-analysis-overview.html#cb231-119" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Rbp4_tdTnegative_cell_19&quot;       &quot;Rbp4_tdTnegative_cell_21&quot;       &quot;Rbp4_tdTnegative_cell_22&quot;      </span></span>
<span id="cb231-120"><a href="scrna-seq-data-analysis-overview.html#cb231-120" tabindex="-1"></a><span class="co">#&gt; [16] &quot;Rbp4_tdTnegative_cell_23&quot;       &quot;Scnn1a-Tg3_tdTnegative_cell_2&quot;  &quot;Scnn1a-Tg3_tdTnegative_cell_4&quot; </span></span>
<span id="cb231-121"><a href="scrna-seq-data-analysis-overview.html#cb231-121" tabindex="-1"></a><span class="co">#&gt; [19] &quot;Scnn1a-Tg3_tdTnegative_cell_8&quot;  &quot;Scnn1a-Tg3_tdTnegative_cell_12&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_16&quot;</span></span>
<span id="cb231-122"><a href="scrna-seq-data-analysis-overview.html#cb231-122" tabindex="-1"></a><span class="co">#&gt; [22] &quot;Scnn1a-Tg3_tdTnegative_cell_21&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_24&quot;</span></span>
<span id="cb231-123"><a href="scrna-seq-data-analysis-overview.html#cb231-123" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-124"><a href="scrna-seq-data-analysis-overview.html#cb231-124" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-125"><a href="scrna-seq-data-analysis-overview.html#cb231-125" tabindex="-1"></a><span class="co">#&gt; $oligodendrocytes</span></span>
<span id="cb231-126"><a href="scrna-seq-data-analysis-overview.html#cb231-126" tabindex="-1"></a><span class="co">#&gt; $oligodendrocytes$aucThr</span></span>
<span id="cb231-127"><a href="scrna-seq-data-analysis-overview.html#cb231-127" tabindex="-1"></a><span class="co">#&gt; $oligodendrocytes$aucThr$selected</span></span>
<span id="cb231-128"><a href="scrna-seq-data-analysis-overview.html#cb231-128" tabindex="-1"></a><span class="co">#&gt;      R_k3 </span></span>
<span id="cb231-129"><a href="scrna-seq-data-analysis-overview.html#cb231-129" tabindex="-1"></a><span class="co">#&gt; 0.5673453 </span></span>
<span id="cb231-130"><a href="scrna-seq-data-analysis-overview.html#cb231-130" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-131"><a href="scrna-seq-data-analysis-overview.html#cb231-131" tabindex="-1"></a><span class="co">#&gt; $oligodendrocytes$aucThr$thresholds</span></span>
<span id="cb231-132"><a href="scrna-seq-data-analysis-overview.html#cb231-132" tabindex="-1"></a><span class="co">#&gt;           threshold nCells</span></span>
<span id="cb231-133"><a href="scrna-seq-data-analysis-overview.html#cb231-133" tabindex="-1"></a><span class="co">#&gt; Global_k1 0.2062242     82</span></span>
<span id="cb231-134"><a href="scrna-seq-data-analysis-overview.html#cb231-134" tabindex="-1"></a><span class="co">#&gt; L_k2      0.2302351     65</span></span>
<span id="cb231-135"><a href="scrna-seq-data-analysis-overview.html#cb231-135" tabindex="-1"></a><span class="co">#&gt; R_k3      0.5673453     34</span></span>
<span id="cb231-136"><a href="scrna-seq-data-analysis-overview.html#cb231-136" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-137"><a href="scrna-seq-data-analysis-overview.html#cb231-137" tabindex="-1"></a><span class="co">#&gt; $oligodendrocytes$aucThr$comment</span></span>
<span id="cb231-138"><a href="scrna-seq-data-analysis-overview.html#cb231-138" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Few cells have high AUC values (0.048% cells with AUC&gt; 0.20). &quot;</span></span>
<span id="cb231-139"><a href="scrna-seq-data-analysis-overview.html#cb231-139" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-140"><a href="scrna-seq-data-analysis-overview.html#cb231-140" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-141"><a href="scrna-seq-data-analysis-overview.html#cb231-141" tabindex="-1"></a><span class="co">#&gt; $oligodendrocytes$assignment</span></span>
<span id="cb231-142"><a href="scrna-seq-data-analysis-overview.html#cb231-142" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Gad2_tdTpositive_cell_31&quot;       &quot;Gad2_tdTpositive_cell_44&quot;       &quot;Gad2_tdTpositive_cell_77&quot;      </span></span>
<span id="cb231-143"><a href="scrna-seq-data-analysis-overview.html#cb231-143" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;Ntsr1_tdTnegative_cell_3&quot;       &quot;Ntsr1_tdTnegative_cell_5&quot;       &quot;Ntsr1_tdTnegative_cell_13&quot;     </span></span>
<span id="cb231-144"><a href="scrna-seq-data-analysis-overview.html#cb231-144" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;Ntsr1_tdTnegative_cell_16&quot;      &quot;Ntsr1_tdTnegative_cell_19&quot;      &quot;Ntsr1_tdTnegative_cell_22&quot;     </span></span>
<span id="cb231-145"><a href="scrna-seq-data-analysis-overview.html#cb231-145" tabindex="-1"></a><span class="co">#&gt; [10] &quot;Ntsr1_tdTnegative_cell_23&quot;      &quot;Ntsr1_tdTnegative_cell_24&quot;      &quot;Ntsr1_tdTnegative_cell_32&quot;     </span></span>
<span id="cb231-146"><a href="scrna-seq-data-analysis-overview.html#cb231-146" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Ntsr1_tdTnegative_cell_41&quot;      &quot;Ntsr1_tdTnegative_cell_44&quot;      &quot;Pvalb_tdTpositive_cell_81&quot;     </span></span>
<span id="cb231-147"><a href="scrna-seq-data-analysis-overview.html#cb231-147" tabindex="-1"></a><span class="co">#&gt; [16] &quot;Rbp4_tdTnegative_cell_1&quot;        &quot;Rbp4_tdTnegative_cell_7&quot;        &quot;Rbp4_tdTnegative_cell_12&quot;      </span></span>
<span id="cb231-148"><a href="scrna-seq-data-analysis-overview.html#cb231-148" tabindex="-1"></a><span class="co">#&gt; [19] &quot;Rbp4_tdTnegative_cell_15&quot;       &quot;Rbp4_tdTnegative_cell_18&quot;       &quot;Scnn1a-Tg2_tdTnegative_cell_3&quot; </span></span>
<span id="cb231-149"><a href="scrna-seq-data-analysis-overview.html#cb231-149" tabindex="-1"></a><span class="co">#&gt; [22] &quot;Scnn1a-Tg2_tdTnegative_cell_17&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_1&quot;  &quot;Scnn1a-Tg3_tdTnegative_cell_3&quot; </span></span>
<span id="cb231-150"><a href="scrna-seq-data-analysis-overview.html#cb231-150" tabindex="-1"></a><span class="co">#&gt; [25] &quot;Scnn1a-Tg3_tdTnegative_cell_6&quot;  &quot;Scnn1a-Tg3_tdTnegative_cell_10&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_13&quot;</span></span>
<span id="cb231-151"><a href="scrna-seq-data-analysis-overview.html#cb231-151" tabindex="-1"></a><span class="co">#&gt; [28] &quot;Scnn1a-Tg3_tdTnegative_cell_14&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_15&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_18&quot;</span></span>
<span id="cb231-152"><a href="scrna-seq-data-analysis-overview.html#cb231-152" tabindex="-1"></a><span class="co">#&gt; [31] &quot;Scnn1a-Tg3_tdTnegative_cell_19&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_22&quot; &quot;Scnn1a-Tg3_tdTnegative_cell_23&quot;</span></span>
<span id="cb231-153"><a href="scrna-seq-data-analysis-overview.html#cb231-153" tabindex="-1"></a><span class="co">#&gt; [34] &quot;Sst_tdTpositive_cell_19&quot;       </span></span>
<span id="cb231-154"><a href="scrna-seq-data-analysis-overview.html#cb231-154" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-155"><a href="scrna-seq-data-analysis-overview.html#cb231-155" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-156"><a href="scrna-seq-data-analysis-overview.html#cb231-156" tabindex="-1"></a><span class="co">#&gt; $`pyramidal CA1`</span></span>
<span id="cb231-157"><a href="scrna-seq-data-analysis-overview.html#cb231-157" tabindex="-1"></a><span class="co">#&gt; $`pyramidal CA1`$aucThr</span></span>
<span id="cb231-158"><a href="scrna-seq-data-analysis-overview.html#cb231-158" tabindex="-1"></a><span class="co">#&gt; $`pyramidal CA1`$aucThr$selected</span></span>
<span id="cb231-159"><a href="scrna-seq-data-analysis-overview.html#cb231-159" tabindex="-1"></a><span class="co">#&gt; minimumDens </span></span>
<span id="cb231-160"><a href="scrna-seq-data-analysis-overview.html#cb231-160" tabindex="-1"></a><span class="co">#&gt;   0.1269473 </span></span>
<span id="cb231-161"><a href="scrna-seq-data-analysis-overview.html#cb231-161" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-162"><a href="scrna-seq-data-analysis-overview.html#cb231-162" tabindex="-1"></a><span class="co">#&gt; $`pyramidal CA1`$aucThr$thresholds</span></span>
<span id="cb231-163"><a href="scrna-seq-data-analysis-overview.html#cb231-163" tabindex="-1"></a><span class="co">#&gt;             threshold nCells</span></span>
<span id="cb231-164"><a href="scrna-seq-data-analysis-overview.html#cb231-164" tabindex="-1"></a><span class="co">#&gt; Global_k1   0.3328189    542</span></span>
<span id="cb231-165"><a href="scrna-seq-data-analysis-overview.html#cb231-165" tabindex="-1"></a><span class="co">#&gt; L_k2        0.6311996      0</span></span>
<span id="cb231-166"><a href="scrna-seq-data-analysis-overview.html#cb231-166" tabindex="-1"></a><span class="co">#&gt; R_k3        0.1545174   1646</span></span>
<span id="cb231-167"><a href="scrna-seq-data-analysis-overview.html#cb231-167" tabindex="-1"></a><span class="co">#&gt; minimumDens 0.1269473   1649</span></span>
<span id="cb231-168"><a href="scrna-seq-data-analysis-overview.html#cb231-168" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-169"><a href="scrna-seq-data-analysis-overview.html#cb231-169" tabindex="-1"></a><span class="co">#&gt; $`pyramidal CA1`$aucThr$comment</span></span>
<span id="cb231-170"><a href="scrna-seq-data-analysis-overview.html#cb231-170" tabindex="-1"></a><span class="co">#&gt; [1] &quot;The global distribution overlaps the partial distributions. &quot;</span></span>
<span id="cb231-171"><a href="scrna-seq-data-analysis-overview.html#cb231-171" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-172"><a href="scrna-seq-data-analysis-overview.html#cb231-172" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-173"><a href="scrna-seq-data-analysis-overview.html#cb231-173" tabindex="-1"></a><span class="co">#&gt; $`pyramidal CA1`$assignment</span></span>
<span id="cb231-174"><a href="scrna-seq-data-analysis-overview.html#cb231-174" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Calb2_tdTpositive_cell_1&quot;  &quot;Calb2_tdTpositive_cell_2&quot;  &quot;Calb2_tdTpositive_cell_3&quot;  &quot;Calb2_tdTpositive_cell_4&quot; </span></span>
<span id="cb231-175"><a href="scrna-seq-data-analysis-overview.html#cb231-175" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;Calb2_tdTpositive_cell_5&quot;  &quot;Calb2_tdTpositive_cell_6&quot;  &quot;Calb2_tdTpositive_cell_7&quot;  &quot;Calb2_tdTpositive_cell_8&quot; </span></span>
<span id="cb231-176"><a href="scrna-seq-data-analysis-overview.html#cb231-176" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;Calb2_tdTpositive_cell_9&quot;  &quot;Calb2_tdTpositive_cell_10&quot; &quot;Calb2_tdTpositive_cell_11&quot; &quot;Calb2_tdTpositive_cell_12&quot;</span></span>
<span id="cb231-177"><a href="scrna-seq-data-analysis-overview.html#cb231-177" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Calb2_tdTpositive_cell_13&quot; &quot;Calb2_tdTpositive_cell_14&quot; &quot;Calb2_tdTpositive_cell_15&quot; &quot;Calb2_tdTpositive_cell_16&quot;</span></span>
<span id="cb231-178"><a href="scrna-seq-data-analysis-overview.html#cb231-178" tabindex="-1"></a><span class="co">#&gt; [17] &quot;Calb2_tdTpositive_cell_17&quot; &quot;Calb2_tdTpositive_cell_18&quot; &quot;Calb2_tdTpositive_cell_19&quot; &quot;Calb2_tdTpositive_cell_20&quot;</span></span>
<span id="cb231-179"><a href="scrna-seq-data-analysis-overview.html#cb231-179" tabindex="-1"></a><span class="co">#&gt; [21] &quot;Calb2_tdTpositive_cell_21&quot; &quot;Calb2_tdTpositive_cell_22&quot; &quot;Calb2_tdTpositive_cell_23&quot; &quot;Calb2_tdTpositive_cell_24&quot;</span></span>
<span id="cb231-180"><a href="scrna-seq-data-analysis-overview.html#cb231-180" tabindex="-1"></a><span class="co">#&gt; [25] &quot;Calb2_tdTpositive_cell_25&quot; &quot;Calb2_tdTpositive_cell_26&quot; &quot;Calb2_tdTpositive_cell_27&quot; &quot;Calb2_tdTpositive_cell_29&quot;</span></span>
<span id="cb231-181"><a href="scrna-seq-data-analysis-overview.html#cb231-181" tabindex="-1"></a><span class="co">#&gt; [29] &quot;Calb2_tdTpositive_cell_30&quot; &quot;Calb2_tdTpositive_cell_31&quot; &quot;Calb2_tdTpositive_cell_32&quot; &quot;Calb2_tdTpositive_cell_33&quot;</span></span>
<span id="cb231-182"><a href="scrna-seq-data-analysis-overview.html#cb231-182" tabindex="-1"></a><span class="co">#&gt; [33] &quot;Calb2_tdTpositive_cell_34&quot; &quot;Calb2_tdTpositive_cell_35&quot; &quot;Calb2_tdTpositive_cell_36&quot; &quot;Calb2_tdTpositive_cell_37&quot;</span></span>
<span id="cb231-183"><a href="scrna-seq-data-analysis-overview.html#cb231-183" tabindex="-1"></a><span class="co">#&gt; [37] &quot;Calb2_tdTpositive_cell_38&quot; &quot;Calb2_tdTpositive_cell_39&quot; &quot;Calb2_tdTpositive_cell_40&quot; &quot;Calb2_tdTpositive_cell_41&quot;</span></span>
<span id="cb231-184"><a href="scrna-seq-data-analysis-overview.html#cb231-184" tabindex="-1"></a><span class="co">#&gt; [41] &quot;Calb2_tdTpositive_cell_42&quot; &quot;Calb2_tdTpositive_cell_43&quot; &quot;Calb2_tdTpositive_cell_44&quot; &quot;Calb2_tdTpositive_cell_45&quot;</span></span>
<span id="cb231-185"><a href="scrna-seq-data-analysis-overview.html#cb231-185" tabindex="-1"></a><span class="co">#&gt; [45] &quot;Calb2_tdTpositive_cell_47&quot; &quot;Calb2_tdTpositive_cell_49&quot; &quot;Calb2_tdTpositive_cell_51&quot; &quot;Calb2_tdTpositive_cell_52&quot;</span></span>
<span id="cb231-186"><a href="scrna-seq-data-analysis-overview.html#cb231-186" tabindex="-1"></a><span class="co">#&gt; [49] &quot;Calb2_tdTpositive_cell_54&quot; &quot;Calb2_tdTpositive_cell_55&quot;</span></span>
<span id="cb231-187"><a href="scrna-seq-data-analysis-overview.html#cb231-187" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 1599 entries ]</span></span>
<span id="cb231-188"><a href="scrna-seq-data-analysis-overview.html#cb231-188" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-189"><a href="scrna-seq-data-analysis-overview.html#cb231-189" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-190"><a href="scrna-seq-data-analysis-overview.html#cb231-190" tabindex="-1"></a><span class="co">#&gt; $`pyramidal SS`</span></span>
<span id="cb231-191"><a href="scrna-seq-data-analysis-overview.html#cb231-191" tabindex="-1"></a><span class="co">#&gt; $`pyramidal SS`$aucThr</span></span>
<span id="cb231-192"><a href="scrna-seq-data-analysis-overview.html#cb231-192" tabindex="-1"></a><span class="co">#&gt; $`pyramidal SS`$aucThr$selected</span></span>
<span id="cb231-193"><a href="scrna-seq-data-analysis-overview.html#cb231-193" tabindex="-1"></a><span class="co">#&gt; minimumDens </span></span>
<span id="cb231-194"><a href="scrna-seq-data-analysis-overview.html#cb231-194" tabindex="-1"></a><span class="co">#&gt;   0.1829744 </span></span>
<span id="cb231-195"><a href="scrna-seq-data-analysis-overview.html#cb231-195" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-196"><a href="scrna-seq-data-analysis-overview.html#cb231-196" tabindex="-1"></a><span class="co">#&gt; $`pyramidal SS`$aucThr$thresholds</span></span>
<span id="cb231-197"><a href="scrna-seq-data-analysis-overview.html#cb231-197" tabindex="-1"></a><span class="co">#&gt;             threshold nCells</span></span>
<span id="cb231-198"><a href="scrna-seq-data-analysis-overview.html#cb231-198" tabindex="-1"></a><span class="co">#&gt; Global_k1   0.4960449    630</span></span>
<span id="cb231-199"><a href="scrna-seq-data-analysis-overview.html#cb231-199" tabindex="-1"></a><span class="co">#&gt; L_k2        0.8889189      0</span></span>
<span id="cb231-200"><a href="scrna-seq-data-analysis-overview.html#cb231-200" tabindex="-1"></a><span class="co">#&gt; R_k3        0.4359221    835</span></span>
<span id="cb231-201"><a href="scrna-seq-data-analysis-overview.html#cb231-201" tabindex="-1"></a><span class="co">#&gt; minimumDens 0.1829744   1649</span></span>
<span id="cb231-202"><a href="scrna-seq-data-analysis-overview.html#cb231-202" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-203"><a href="scrna-seq-data-analysis-overview.html#cb231-203" tabindex="-1"></a><span class="co">#&gt; $`pyramidal SS`$aucThr$comment</span></span>
<span id="cb231-204"><a href="scrna-seq-data-analysis-overview.html#cb231-204" tabindex="-1"></a><span class="co">#&gt; [1] &quot;The global distribution overlaps the partial distributions. &quot;</span></span>
<span id="cb231-205"><a href="scrna-seq-data-analysis-overview.html#cb231-205" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-206"><a href="scrna-seq-data-analysis-overview.html#cb231-206" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb231-207"><a href="scrna-seq-data-analysis-overview.html#cb231-207" tabindex="-1"></a><span class="co">#&gt; $`pyramidal SS`$assignment</span></span>
<span id="cb231-208"><a href="scrna-seq-data-analysis-overview.html#cb231-208" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;Calb2_tdTpositive_cell_1&quot;  &quot;Calb2_tdTpositive_cell_2&quot;  &quot;Calb2_tdTpositive_cell_3&quot;  &quot;Calb2_tdTpositive_cell_4&quot; </span></span>
<span id="cb231-209"><a href="scrna-seq-data-analysis-overview.html#cb231-209" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;Calb2_tdTpositive_cell_5&quot;  &quot;Calb2_tdTpositive_cell_6&quot;  &quot;Calb2_tdTpositive_cell_7&quot;  &quot;Calb2_tdTpositive_cell_8&quot; </span></span>
<span id="cb231-210"><a href="scrna-seq-data-analysis-overview.html#cb231-210" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;Calb2_tdTpositive_cell_9&quot;  &quot;Calb2_tdTpositive_cell_10&quot; &quot;Calb2_tdTpositive_cell_11&quot; &quot;Calb2_tdTpositive_cell_12&quot;</span></span>
<span id="cb231-211"><a href="scrna-seq-data-analysis-overview.html#cb231-211" tabindex="-1"></a><span class="co">#&gt; [13] &quot;Calb2_tdTpositive_cell_13&quot; &quot;Calb2_tdTpositive_cell_14&quot; &quot;Calb2_tdTpositive_cell_15&quot; &quot;Calb2_tdTpositive_cell_16&quot;</span></span>
<span id="cb231-212"><a href="scrna-seq-data-analysis-overview.html#cb231-212" tabindex="-1"></a><span class="co">#&gt; [17] &quot;Calb2_tdTpositive_cell_17&quot; &quot;Calb2_tdTpositive_cell_18&quot; &quot;Calb2_tdTpositive_cell_19&quot; &quot;Calb2_tdTpositive_cell_20&quot;</span></span>
<span id="cb231-213"><a href="scrna-seq-data-analysis-overview.html#cb231-213" tabindex="-1"></a><span class="co">#&gt; [21] &quot;Calb2_tdTpositive_cell_21&quot; &quot;Calb2_tdTpositive_cell_22&quot; &quot;Calb2_tdTpositive_cell_23&quot; &quot;Calb2_tdTpositive_cell_24&quot;</span></span>
<span id="cb231-214"><a href="scrna-seq-data-analysis-overview.html#cb231-214" tabindex="-1"></a><span class="co">#&gt; [25] &quot;Calb2_tdTpositive_cell_25&quot; &quot;Calb2_tdTpositive_cell_26&quot; &quot;Calb2_tdTpositive_cell_27&quot; &quot;Calb2_tdTpositive_cell_29&quot;</span></span>
<span id="cb231-215"><a href="scrna-seq-data-analysis-overview.html#cb231-215" tabindex="-1"></a><span class="co">#&gt; [29] &quot;Calb2_tdTpositive_cell_30&quot; &quot;Calb2_tdTpositive_cell_31&quot; &quot;Calb2_tdTpositive_cell_32&quot; &quot;Calb2_tdTpositive_cell_33&quot;</span></span>
<span id="cb231-216"><a href="scrna-seq-data-analysis-overview.html#cb231-216" tabindex="-1"></a><span class="co">#&gt; [33] &quot;Calb2_tdTpositive_cell_34&quot; &quot;Calb2_tdTpositive_cell_35&quot; &quot;Calb2_tdTpositive_cell_36&quot; &quot;Calb2_tdTpositive_cell_37&quot;</span></span>
<span id="cb231-217"><a href="scrna-seq-data-analysis-overview.html#cb231-217" tabindex="-1"></a><span class="co">#&gt; [37] &quot;Calb2_tdTpositive_cell_38&quot; &quot;Calb2_tdTpositive_cell_39&quot; &quot;Calb2_tdTpositive_cell_40&quot; &quot;Calb2_tdTpositive_cell_41&quot;</span></span>
<span id="cb231-218"><a href="scrna-seq-data-analysis-overview.html#cb231-218" tabindex="-1"></a><span class="co">#&gt; [41] &quot;Calb2_tdTpositive_cell_42&quot; &quot;Calb2_tdTpositive_cell_43&quot; &quot;Calb2_tdTpositive_cell_44&quot; &quot;Calb2_tdTpositive_cell_45&quot;</span></span>
<span id="cb231-219"><a href="scrna-seq-data-analysis-overview.html#cb231-219" tabindex="-1"></a><span class="co">#&gt; [45] &quot;Calb2_tdTpositive_cell_47&quot; &quot;Calb2_tdTpositive_cell_49&quot; &quot;Calb2_tdTpositive_cell_51&quot; &quot;Calb2_tdTpositive_cell_52&quot;</span></span>
<span id="cb231-220"><a href="scrna-seq-data-analysis-overview.html#cb231-220" tabindex="-1"></a><span class="co">#&gt; [49] &quot;Calb2_tdTpositive_cell_54&quot; &quot;Calb2_tdTpositive_cell_55&quot;</span></span>
<span id="cb231-221"><a href="scrna-seq-data-analysis-overview.html#cb231-221" tabindex="-1"></a><span class="co">#&gt;  [ reached getOption(&quot;max.print&quot;) -- omitted 1599 entries ]</span></span></code></pre></div>
<p><img src="_main_files/figure-html/auc_explore_plots-1.png" width="672" /></p>
<p>Interpretation of the AUCell results is most straightforward when the marker sets are mutually exclusive, as shown above for the cell type markers.</p>
<p>In other applications, one might consider computing AUCs for gene sets associated with signalling or metabolic pathways. It is likely that multiple pathways will be active in any given cell, and it is tempting to use the AUCs to quantify this activity for comparison across cells.</p>
<p>However, such comparisons must be interpreted with much caution as the AUCs are competitive values: any increase in one pathway’s activity will naturally reduce the AUCs for all other pathways, potentially resulting in spurious differences across the population.</p>
<p>the advantage of the AUCell approach is that it does not require reference expression values. This is particularly useful when dealing with gene sets derived from the literature or other qualitative forms of biological knowledge.</p>
</div>
</div>
<div id="references-4" class="section level2 hasAnchor" number="11.11">
<h2><span class="header-section-number">11.11</span> References<a href="scrna-seq-data-analysis-overview.html#references-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Amezquita, R. A., Lun, A. T., Becht, E., Carey, V. J., Carpp, L. N., Geistlinger, L., … &amp; Hicks, S. C. (2020). Orchestrating single-cell analysis with Bioconductor. Nature methods, 17(2), 137-145.</p>
<p>Aran, D., A. P. Looney, L. Liu, E. Wu, V. Fong, A. Hsu, S. Chak, et al. 2019. “Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage.” Nat. Immunol. 20 (2): 163–72.</p>
<p>Bach, K., S. Pensa, M. Grzelak, J. Hadfield, D. J. Adams, J. C. Marioni, and W. T. Khaled. 2017. “Differentiation dynamics of mammary epithelial cells revealed by single-cell RNA sequencing.” Nat Commun 8 (1): 2128.</p>
<p>Martens, J. H., and H. G. Stunnenberg. 2013. “BLUEPRINT: mapping human blood cell epigenomes.” Haematologica 98 (10): 1487–9.</p>
<p>Muraro, M. J., G. Dharmadhikari, D. Grun, N. Groen, T. Dielen, E. Jansen, L. van Gurp, et al. 2016. “A Single-Cell Transcriptome Atlas of the Human Pancreas.” Cell Syst 3 (4): 385–94.</p>
<p>Segerstolpe, A., A. Palasantza, P. Eliasson, E. M. Andersson, A. C. Andreasson, X. Sun, S. Picelli, et al. 2016. “Single-Cell Transcriptome Profiling of Human Pancreatic Islets in Health and Type 2 Diabetes.” Cell Metab. 24 (4): 593–607.</p>
<p>Tasic, B., V. Menon, T. N. Nguyen, T. K. Kim, T. Jarsky, Z. Yao, B. Levi, et al. 2016. “Adult mouse cortical cell taxonomy revealed by single cell transcriptomics.” Nat. Neurosci. 19 (2): 335–46.</p>
<p>The ENCODE Project Consortium. 2012. “An integrated encyclopedia of DNA elements in the human genome.” Nature 489 (7414): 57–74.</p>
<p>Zeisel, A., A. B. Munoz-Manchado, S. Codeluppi, P. Lonnerberg, G. La Manno, A. Jureus, S. Marques, et al. 2015. “Brain structure. Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq.” Science 347 (6226): 1138–42.</p>

</div>
</div>
<div class="container">
    <footer class="site-footer">

      <center>
<p class="powered-by">
© 2011-2023. All thoughts and opinions here are my own. The icon was designed by <a href="https://www.linkedin.com/in/mauricio-guzman-6529b551/">Mauricio Guzmán</a> and is inspired by <a href="https://en.wikipedia.org/wiki/Huichol">Huichol culture</a>; it represents my community building interests.
</p>

<p class="powered-by copyright-license-text">
This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">CC BY NC SA 4.0</a>
</p>

<p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0" rel="noopener noreferrer" target="_blank">
      <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="CC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="CC by icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg" alt="CC NC icon" width="32px">
      <img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg" alt="CC SA icon" width="32px">
    </a>
</p>

<div id="clustrmaps-widget"></div><script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=300&t=m&d=Zo-deincaJGsqhqjIWsujtdoNOMJsnnZLefKmxDKVv8&co=124b73&cmo=dd53ff&cmn=4ec724'></script>

<p class="powered-by">
Published with <a href="https://bookdown.org/" target="_blank" rel="noopener">Bookdown</a>
</p>

</center>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45299226-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45299226-1');
</script>

</footer>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="biocthis-introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-spatial-transcriptomics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
